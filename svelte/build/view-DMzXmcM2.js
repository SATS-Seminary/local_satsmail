import{n as E,i as Hl,a as wn,l as $n,d as yn,c as Mn,S as ae,b as oe,e as re,f as y,g as M,h as _e,j as h,k as m,s as ge,m as et,o as R,r as qe,p as _,t as P,q as Lt,u as Cn,v as Me,w as L,x as He,y as C,z as Ie,A as Sn,B as Dn,C as Tn,D as W,E as ze,F as De,G as it,H as j,I as mt,J as ht,K as Se,L as ne,M as ie,N as H,O,P as J,Q as V,R as ft,T as jt,U as ue,V as Le,W as je,X as dt,Y as Ae,Z as he,_ as Fe,$ as Ol,a0 as We,a1 as Je,a2 as kt,a3 as Oe,a4 as Jl,a5 as Kl,a6 as gt,a7 as nt,a8 as Ee,a9 as zt,aa as ut,ab as Nt,ac as Vl,ad as Wl,ae as Ge,af as Ue,ag as tt,ah as bt,ai as Xl,aj as qt,ak as Ln,al as jn,am as Yl,an as zn,ao as Ql,ap as Nn,aq as qn,ar as _t,as as In}from"./global-CUTJa-Jf.js";const rt=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function Zl(l,e,t,s){if(!e)return E;const n=l.getBoundingClientRect();if(e.left===n.left&&e.right===n.right&&e.top===n.top&&e.bottom===n.bottom)return E;const{delay:i=0,duration:r=300,easing:a=Hl,start:o=wn()+i,end:f=o+r,tick:c=E,css:u}=t(l,{from:e,to:n},s);let d=!0,g=!1,p;function b(){u&&(p=Mn(l,0,1,r,i,a,u)),i||(g=!0)}function $(){u&&yn(l,p),d=!1}return $n(w=>{if(!g&&w>=o&&(g=!0),g&&w>=f&&(c(1,0),$()),!d)return!1;if(g){const v=w-o,S=0+1*a(v/r);c(S,1-S)}return!0}),b(),c(0,1),$}function xl(l){const e=getComputedStyle(l);if(e.position!=="absolute"&&e.position!=="fixed"){const{width:t,height:s}=e,n=l.getBoundingClientRect();l.style.position="absolute",l.style.width=t,l.style.height=s,vt(l,n)}}function vt(l,e){const t=l.getBoundingClientRect();if(e.left!==t.left||e.top!==t.top){const s=getComputedStyle(l),n=s.transform==="none"?"":s.transform;l.style.transform=`${n} translate(${e.left-t.left}px, ${e.top-t.top}px)`}}var Ve=(l=>(l[l.NotDeleted=0]="NotDeleted",l[l.Deleted=1]="Deleted",l[l.DeletedForever=2]="DeletedForever",l))(Ve||{}),en=(l=>(l[l.No=0]="No",l[l.Separate=1]="Separate",l[l.Visible=2]="Visible",l))(en||{}),Be=(l=>(l.TO="to",l.CC="cc",l.BCC="bcc",l))(Be||{}),fe=(l=>(l[l.SM=576]="SM",l[l.MD=768]="MD",l[l.LG=992]="LG",l[l.XL=1200]="XL",l))(fe||{});function It(l){let e;function t(i,r){return i[2]?Bn:An}let s=t(l),n=s(l);return{c(){e=h("div"),n.c(),m(e,"class","local-mail-course-link mb-3 mb-lg-4 svelte-15m33nm")},m(i,r){M(i,e,r),n.m(e,null)},p(i,r){s===(s=t(i))&&n?n.p(i,r):(n.d(1),n=s(i),n&&(n.c(),n.m(e,null)))},d(i){i&&y(e),n.d()}}}function An(l){let e;return{c(){e=P("Â ")},m(t,s){M(t,e,s)},p:E,d(t){t&&y(e)}}}function Bn(l){let e,t,s=et(l[2],l[1].settings.courselink)+"",n,i,r;return{c(){e=h("nav"),t=h("a"),n=P(s),m(t,"class","text-truncate"),m(t,"href",i=window.M.cfg.wwwroot+"/course/view.php?id="+l[1].params.courseid),m(t,"title",r=qe(l[1].strings.gotocourse,et(l[2],"fullname"))),m(e,"class","d-flex align-items-center")},m(a,o){M(a,e,o),_(e,t),_(t,n)},p(a,o){o&6&&s!==(s=et(a[2],a[1].settings.courselink)+"")&&R(n,s),o&2&&i!==(i=window.M.cfg.wwwroot+"/course/view.php?id="+a[1].params.courseid)&&m(t,"href",i),o&6&&r!==(r=qe(a[1].strings.gotocourse,et(a[2],"fullname")))&&m(t,"title",r)},d(a){a&&y(e)}}}function Pn(l){let e=["shortname","fullname"].includes(l[1].settings.courselink),t,s=e&&It(l);return{c(){s&&s.c(),t=_e()},m(n,i){s&&s.m(n,i),M(n,t,i)},p(n,[i]){i&2&&(e=["shortname","fullname"].includes(n[1].settings.courselink)),e?s?s.p(n,i):(s=It(n),s.c(),s.m(t.parentNode,t)):s&&(s.d(1),s=null)},i:E,o:E,d(n){n&&y(t),s&&s.d(n)}}}function En(l,e,t){let s,n,i=E,r=()=>(i(),i=ge(a,o=>t(1,n=o)),a);l.$$.on_destroy.push(()=>i());let{store:a}=e;return r(),l.$$set=o=>{"store"in o&&r(t(0,a=o.store))},l.$$.update=()=>{l.$$.dirty&2&&t(2,s=n.courses.find(o=>o.id==n.params.courseid))},[a,n,s]}class Rn extends ae{constructor(e){super(),oe(this,e,En,Pn,re,{store:0})}}function tn(l){const e=l-1;return e*e*e+1}function Pe(l,{delay:e=0,duration:t=400,easing:s=Hl}={}){const n=+getComputedStyle(l).opacity;return{delay:e,duration:t,easing:s,css:i=>`opacity: ${i*n}`}}function ct(l,{delay:e=0,duration:t=400,easing:s=tn,x:n=0,y:i=0,opacity:r=0}={}){const a=getComputedStyle(l),o=+a.opacity,f=a.transform==="none"?"":a.transform,c=o*(1-r),[u,d]=Lt(n),[g,p]=Lt(i);return{delay:e,duration:t,easing:s,css:(b,$)=>`
			transform: ${f} translate(${(1-b)*u}${d}, ${(1-b)*g}${p});
			opacity: ${o-c*$}`}}const{document:Fn}=rt;function At(l){let e,t,s=l[1]&&Bt(l),n=l[2]&&l[4]&&Pt(l);return{c(){e=h("div"),s&&s.c(),t=j(),n&&n.c(),m(e,"class","modal-footer")},m(i,r){M(i,e,r),s&&s.m(e,null),_(e,t),n&&n.m(e,null)},p(i,r){i[1]?s?s.p(i,r):(s=Bt(i),s.c(),s.m(e,t)):s&&(s.d(1),s=null),i[2]&&i[4]?n?n.p(i,r):(n=Pt(i),n.c(),n.m(e,null)):n&&(n.d(1),n=null)},d(i){i&&y(e),s&&s.d(),n&&n.d()}}}function Bt(l){let e,t,s,n;return{c(){e=h("button"),t=P(l[1]),m(e,"type","button"),m(e,"class","btn btn-secondary")},m(i,r){M(i,e,r),_(e,t),s||(n=W(e,"click",function(){De(l[3])&&l[3].apply(this,arguments)}),s=!0)},p(i,r){l=i,r&2&&R(t,l[1])},d(i){i&&y(e),s=!1,n()}}}function Pt(l){let e,t,s,n,i;return{c(){e=h("button"),t=P(l[2]),m(e,"type","button"),m(e,"class",s="btn "+l[5]),e.disabled=l[6]},m(r,a){M(r,e,a),_(e,t),n||(i=W(e,"click",function(){De(l[4])&&l[4].apply(this,arguments)}),n=!0)},p(r,a){l=r,a&4&&R(t,l[2]),a&32&&s!==(s="btn "+l[5])&&m(e,"class",s),a&64&&(e.disabled=l[6])},d(r){r&&y(e),n=!1,i()}}}function Gn(l){let e,t,s,n,i,r,a,o,f,c,u,d,g,p,b,$,w,v,S,k,T;const q=l[10].default,D=Cn(q,l,l[9],null);let A=(l[1]||l[2]&&l[4])&&At(l);return{c(){e=j(),t=h("div"),s=h("div"),n=h("div"),i=h("div"),r=h("h5"),a=P(l[0]),o=j(),f=h("button"),c=h("span"),u=j(),d=h("div"),D&&D.c(),g=j(),A&&A.c(),$=j(),w=h("div"),m(r,"class","modal-title"),m(c,"aria-hidden","true"),m(c,"class","fa fa-times"),m(f,"type","button"),m(f,"class","close d-flex align-items-center justify-content ml-auto"),m(f,"aria-label",l[1]),m(i,"class","modal-header align-items-center"),m(d,"class","modal-body"),m(n,"class","modal-content"),m(s,"class","modal-dialog"),m(t,"class","modal show"),m(t,"tabindex","-1"),m(t,"role","dialog"),m(t,"aria-label",l[0]),m(t,"aria-modal","true"),m(w,"class","modal-backdrop show")},m(z,K){M(z,e,K),M(z,t,K),_(t,s),_(s,n),_(n,i),_(i,r),_(r,a),_(i,o),_(i,f),_(f,c),_(n,u),_(n,d),D&&D.m(d,null),_(n,g),A&&A.m(n,null),l[11](t),M(z,$,K),M(z,w,K),S=!0,k||(T=[W(Fn.body,"keyup",l[8]),W(f,"click",function(){De(l[3])&&l[3].apply(this,arguments)}),ze(p=it.call(null,t,l[3]))],k=!0)},p(z,[K]){l=z,(!S||K&1)&&R(a,l[0]),(!S||K&2)&&m(f,"aria-label",l[1]),D&&D.p&&(!S||K&512)&&Sn(D,q,l,l[9],S?Tn(q,l[9],K,null):Dn(l[9]),null),l[1]||l[2]&&l[4]?A?A.p(l,K):(A=At(l),A.c(),A.m(n,null)):A&&(A.d(1),A=null),(!S||K&1)&&m(t,"aria-label",l[0]),p&&De(p.update)&&K&8&&p.update.call(null,l[3])},i(z){S||(C(D,z),Ie(()=>{S&&(b||(b=He(t,ct,{y:-100},!0)),b.run(1))}),Ie(()=>{S&&(v||(v=He(w,Pe,{},!0)),v.run(1))}),S=!0)},o(z){L(D,z),b||(b=He(t,ct,{y:-100},!1)),b.run(0),v||(v=He(w,Pe,{},!1)),v.run(0),S=!1},d(z){z&&(y(e),y(t),y($),y(w)),D&&D.d(z),A&&A.d(),l[11](null),z&&b&&b.end(),z&&v&&v.end(),k=!1,Me(T)}}}function Un(l,e,t){let{$$slots:s={},$$scope:n}=e,{title:i}=e,{cancelText:r=""}=e,{confirmText:a=""}=e,{onCancel:o}=e,{onConfirm:f=void 0}=e,{confirmClass:c="btn-primary"}=e,{confirmDisabled:u=!1}=e,d;mt(()=>{document.body.classList.add("modal-open"),d.focus()}),ht(()=>{document.body.classList.remove("modal-open")});const g=b=>{b.key=="Escape"&&o()};function p(b){Se[b?"unshift":"push"](()=>{d=b,t(7,d)})}return l.$$set=b=>{"title"in b&&t(0,i=b.title),"cancelText"in b&&t(1,r=b.cancelText),"confirmText"in b&&t(2,a=b.confirmText),"onCancel"in b&&t(3,o=b.onCancel),"onConfirm"in b&&t(4,f=b.onConfirm),"confirmClass"in b&&t(5,c=b.confirmClass),"confirmDisabled"in b&&t(6,u=b.confirmDisabled),"$$scope"in b&&t(9,n=b.$$scope)},[i,r,a,o,f,c,u,d,g,n,s,p]}class Xe extends ae{constructor(e){super(),oe(this,e,Un,Gn,re,{title:0,cancelText:1,confirmText:2,onCancel:3,onConfirm:4,confirmClass:5,confirmDisabled:6})}}function Et(l){let e,t;return e=new Xe({props:{title:l[1].strings.error,onCancel:l[2],$$slots:{default:[Hn]},$$scope:{ctx:l}}}),{c(){J(e.$$.fragment)},m(s,n){O(e,s,n),t=!0},p(s,n){const i={};n&2&&(i.title=s[1].strings.error),n&1&&(i.onCancel=s[2]),n&10&&(i.$$scope={dirty:n,ctx:s}),e.$set(i)},i(s){t||(C(e.$$.fragment,s),t=!0)},o(s){L(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function Rt(l){var n;let e,t=((n=l[1].error)==null?void 0:n.debuginfo)+"",s;return{c(){e=h("p"),s=P(t)},m(i,r){M(i,e,r),_(e,s)},p(i,r){var a;r&2&&t!==(t=((a=i[1].error)==null?void 0:a.debuginfo)+"")&&R(s,t)},d(i){i&&y(e)}}}function Ft(l){var n,i;let e,t=(((n=l[1].error)==null?void 0:n.backtrace)||((i=l[1].error)==null?void 0:i.stacktrace))+"",s;return{c(){e=h("pre"),s=P(t)},m(r,a){M(r,e,a),_(e,s)},p(r,a){var o,f;a&2&&t!==(t=(((o=r[1].error)==null?void 0:o.backtrace)||((f=r[1].error)==null?void 0:f.stacktrace))+"")&&R(s,t)},d(r){r&&y(e)}}}function Hn(l){var f,c,u,d;let e,t=((f=l[1].error)==null?void 0:f.message)+"",s,n,i,r,a=((c=l[1].error)==null?void 0:c.debuginfo)&&Rt(l),o=(((u=l[1].error)==null?void 0:u.backtrace)||((d=l[1].error)==null?void 0:d.stacktrace))&&Ft(l);return{c(){e=h("p"),s=P(t),n=j(),a&&a.c(),i=j(),o&&o.c(),r=_e()},m(g,p){M(g,e,p),_(e,s),M(g,n,p),a&&a.m(g,p),M(g,i,p),o&&o.m(g,p),M(g,r,p)},p(g,p){var b,$,w,v;p&2&&t!==(t=((b=g[1].error)==null?void 0:b.message)+"")&&R(s,t),($=g[1].error)!=null&&$.debuginfo?a?a.p(g,p):(a=Rt(g),a.c(),a.m(i.parentNode,i)):a&&(a.d(1),a=null),(w=g[1].error)!=null&&w.backtrace||(v=g[1].error)!=null&&v.stacktrace?o?o.p(g,p):(o=Ft(g),o.c(),o.m(r.parentNode,r)):o&&(o.d(1),o=null)},d(g){g&&(y(e),y(n),y(i),y(r)),a&&a.d(g),o&&o.d(g)}}}function On(l){let e,t,s=l[1].error&&Et(l);return{c(){s&&s.c(),e=_e()},m(n,i){s&&s.m(n,i),M(n,e,i),t=!0},p(n,[i]){n[1].error?s?(s.p(n,i),i&2&&C(s,1)):(s=Et(n),s.c(),C(s,1),s.m(e.parentNode,e)):s&&(ne(),L(s,1,1,()=>{s=null}),ie())},i(n){t||(C(s),t=!0)},o(n){L(s),t=!1},d(n){n&&y(e),s&&s.d(n)}}}function Jn(l,e,t){let s,n=E,i=()=>(n(),n=ge(r,o=>t(1,s=o)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();const a=()=>r.setError();return l.$$set=o=>{"store"in o&&i(t(0,r=o.store))},[r,s,a]}class Kn extends ae{constructor(e){super(),oe(this,e,Jn,On,re,{store:0})}}function Vn(l){let e,t,s,n,i,r;return{c(){e=h("button"),t=h("i"),m(t,"class","fa fa-fw fa-trash"),m(e,"type","button"),m(e,"class","local-mail-delete-button btn"),e.disabled=s=!l[2].selectedMessages.size,m(e,"title",n=l[2].strings.movetotrash),V(e,"btn-secondary",!l[1]),V(e,"btn-light",l[1]),V(e,"disabled",!l[2].selectedMessages.size)},m(a,o){M(a,e,o),_(e,t),i||(r=W(e,"click",l[3]),i=!0)},p(a,[o]){o&4&&s!==(s=!a[2].selectedMessages.size)&&(e.disabled=s),o&4&&n!==(n=a[2].strings.movetotrash)&&m(e,"title",n),o&2&&V(e,"btn-secondary",!a[1]),o&2&&V(e,"btn-light",a[1]),o&4&&V(e,"disabled",!a[2].selectedMessages.size)},i:E,o:E,d(a){a&&y(e),i=!1,r()}}}function Wn(l,e,t){let s,n=E,i=()=>(n(),n=ge(r,f=>t(2,s=f)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{bottom:a=!1}=e;const o=()=>r.setDeleted(Array.from(s.selectedMessages.keys()),Ve.Deleted,!0);return l.$$set=f=>{"store"in f&&i(t(0,r=f.store)),"bottom"in f&&t(1,a=f.bottom)},[r,a,s,o]}class sn extends ae{constructor(e){super(),oe(this,e,Wn,Vn,re,{store:0,bottom:1})}}function Gt(l){let e,t;return e=new Xe({props:{title:l[2].strings.deleteforever,cancelText:l[2].strings.cancel,confirmText:l[2].strings.deleteforever,confirmClass:"btn-danger",onCancel:l[5],onConfirm:l[3],$$slots:{default:[Xn]},$$scope:{ctx:l}}}),{c(){J(e.$$.fragment)},m(s,n){O(e,s,n),t=!0},p(s,n){const i={};n&4&&(i.title=s[2].strings.deleteforever),n&4&&(i.cancelText=s[2].strings.cancel),n&4&&(i.confirmText=s[2].strings.deleteforever),n&1&&(i.onCancel=s[5]),n&68&&(i.$$scope={dirty:n,ctx:s}),e.$set(i)},i(s){t||(C(e.$$.fragment,s),t=!0)},o(s){L(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function Xn(l){let e=l[2].strings[l[2].selectedMessages.size==1?"deleteforevermessageconfirm":"deleteforeverselectedconfirm"]+"",t;return{c(){t=P(e)},m(s,n){M(s,t,n)},p(s,n){n&4&&e!==(e=s[2].strings[s[2].selectedMessages.size==1?"deleteforevermessageconfirm":"deleteforeverselectedconfirm"]+"")&&R(t,e)},d(s){s&&y(t)}}}function Yn(l){let e,t,s,n,i,r,a,o,f,c=l[2].params.dialog=="deleteforever"&&Gt(l);return{c(){e=h("button"),t=h("i"),i=j(),c&&c.c(),r=_e(),m(t,"class","fa fa-fw fa-trash"),m(e,"type","button"),m(e,"class","local-mail-delete-forever-button btn"),e.disabled=s=!l[2].selectedMessages.size,m(e,"title",n=l[2].strings.deleteforever),V(e,"btn-secondary",!l[1]),V(e,"btn-light",l[1])},m(u,d){M(u,e,d),_(e,t),M(u,i,d),c&&c.m(u,d),M(u,r,d),a=!0,o||(f=W(e,"click",l[4]),o=!0)},p(u,[d]){(!a||d&4&&s!==(s=!u[2].selectedMessages.size))&&(e.disabled=s),(!a||d&4&&n!==(n=u[2].strings.deleteforever))&&m(e,"title",n),(!a||d&2)&&V(e,"btn-secondary",!u[1]),(!a||d&2)&&V(e,"btn-light",u[1]),u[2].params.dialog=="deleteforever"?c?(c.p(u,d),d&4&&C(c,1)):(c=Gt(u),c.c(),C(c,1),c.m(r.parentNode,r)):c&&(ne(),L(c,1,1,()=>{c=null}),ie())},i(u){a||(C(c),a=!0)},o(u){L(c),a=!1},d(u){u&&(y(e),y(i),y(r)),c&&c.d(u),o=!1,f()}}}function Qn(l,e,t){let s,n=E,i=()=>(n(),n=ge(r,u=>t(2,s=u)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{bottom:a=!1}=e;const o=()=>{r.hideDialog(),r.setDeleted(Array.from(s.selectedMessages.keys()),Ve.DeletedForever,!0)},f=()=>r.showDialog("deleteforever"),c=()=>r.hideDialog();return l.$$set=u=>{"store"in u&&i(t(0,r=u.store)),"bottom"in u&&t(1,a=u.bottom)},[r,a,s,o,f,c]}class ln extends ae{constructor(e){super(),oe(this,e,Qn,Yn,re,{store:0,bottom:1})}}function Ut(l,e,t){const s=l.slice();return s[16]=e[t],s}function Zn(l){let e;return{c(){e=P("Â ")},m(t,s){M(t,e,s)},p:E,d(t){t&&y(e)}}}function xn(l){let e=l[5].strings.errorrepeatedlabelname+"",t;return{c(){t=P(e)},m(s,n){M(s,t,n)},p(s,n){n&32&&e!==(e=s[5].strings.errorrepeatedlabelname+"")&&R(t,e)},d(s){s&&y(t)}}}function ei(l){let e;return{c(){e=h("span"),e.textContent="a",m(e,"aria-hidden","true")},m(t,s){M(t,e,s)},d(t){t&&y(e)}}}function ti(l){let e;return{c(){e=h("i"),m(e,"class","fa fa-check local-mail-label-modal-color-option-check")},m(t,s){M(t,e,s)},d(t){t&&y(e)}}}function Ht(l,e){let t,s,n,i,r,a;function o(d,g){return d[16]==d[7]?ti:ei}let f=o(e),c=f(e);function u(){return e[15](e[16])}return{key:l,first:null,c(){t=h("button"),c.c(),s=j(),m(t,"role","radio"),m(t,"aria-checked",n=e[16]==e[7]),m(t,"tabindex","0"),m(t,"title",i=e[5].strings[`color${e[16]}`]),m(t,"class","local-mail-label-modal-color-option btn svelte-cky3j8"),m(t,"style",`color: var(--local-mail-color-${e[16]}-fg, var(--local-mail-color-gray-fg));background-color: var(--local-mail-color-${e[16]}-bg, var(--local-mail-color-gray-bg))`),this.first=t},m(d,g){M(d,t,g),c.m(t,null),_(t,s),r||(a=W(t,"click",Ae(u)),r=!0)},p(d,g){e=d,f!==(f=o(e))&&(c.d(1),c=f(e),c&&(c.c(),c.m(t,s))),g&128&&n!==(n=e[16]==e[7])&&m(t,"aria-checked",n),g&32&&i!==(i=e[5].strings[`color${e[16]}`])&&m(t,"title",i)},d(d){d&&y(t),c.d(),r=!1,a()}}}function si(l){let e,t,s,n=l[5].strings.name+"",i,r,a,o,f,c,u,d,g,p,b,$=l[5].strings.color+"",w,v,S,k,T=[],q=new Map,D,A,z;function K(Q,ee){return Q[4]?xn:Zn}let G=K(l),U=G(l),se=ue(ft);const le=Q=>Q[16];for(let Q=0;Q<se.length;Q+=1){let ee=Ut(l,se,Q),F=le(ee);q.set(F,T[Q]=Ht(F,ee))}return{c(){e=h("form"),t=h("div"),s=h("label"),i=P(n),r=j(),a=h("input"),f=j(),c=h("div"),U.c(),u=j(),d=h("div"),d.textContent="Â ",g=j(),p=h("div"),b=h("label"),w=P($),S=j(),k=h("div");for(let Q=0;Q<T.length;Q+=1)T[Q].c();m(s,"for","local-mail-label-modal-name"),m(a,"type","text"),a.required=!0,m(a,"class","form-control is-invalid"),m(a,"id",o=l[9]+"-name"),V(a,"is-valid",l[8]),V(a,"is-invalid",!l[8]),m(c,"class","invalid-feedback"),m(d,"class","valid-feedback"),m(t,"class","form-group mb-0"),m(b,"for",v=l[9]+"-color"),m(k,"role","radiogroup"),m(k,"class","local-mail-label-modal-color svelte-cky3j8"),m(k,"id",D=l[9]+"-color"),m(p,"class","form-group")},m(Q,ee){M(Q,e,ee),_(e,t),_(t,s),_(s,i),_(t,r),_(t,a),l[13](a),Le(a,l[3]),_(t,f),_(t,c),U.m(c,null),_(t,u),_(t,d),_(e,g),_(e,p),_(p,b),_(b,w),_(p,S),_(p,k);for(let F=0;F<T.length;F+=1)T[F]&&T[F].m(k,null);A||(z=[W(a,"input",l[14]),W(e,"submit",Ae(l[10]))],A=!0)},p(Q,ee){ee&32&&n!==(n=Q[5].strings.name+"")&&R(i,n),ee&512&&o!==(o=Q[9]+"-name")&&m(a,"id",o),ee&8&&a.value!==Q[3]&&Le(a,Q[3]),ee&256&&V(a,"is-valid",Q[8]),ee&256&&V(a,"is-invalid",!Q[8]),G===(G=K(Q))&&U?U.p(Q,ee):(U.d(1),U=G(Q),U&&(U.c(),U.m(c,null))),ee&32&&$!==($=Q[5].strings.color+"")&&R(w,$),ee&512&&v!==(v=Q[9]+"-color")&&m(b,"for",v),ee&160&&(se=ue(ft),T=je(T,ee,le,1,Q,se,q,k,dt,Ht,null,Ut)),ee&512&&D!==(D=Q[9]+"-color")&&m(k,"id",D)},d(Q){Q&&y(e),l[13](null),U.d();for(let ee=0;ee<T.length;ee+=1)T[ee].d();A=!1,Me(z)}}}function li(l){let e,t;return e=new Xe({props:{title:l[5].strings[l[1]?"editlabel":"newlabel"],cancelText:l[5].strings.cancel,onCancel:l[2],confirmText:l[5].strings[l[1]?"save":"create"],confirmDisabled:!l[8],onConfirm:l[10],$$slots:{default:[si]},$$scope:{ctx:l}}}),{c(){J(e.$$.fragment)},m(s,n){O(e,s,n),t=!0},p(s,[n]){const i={};n&34&&(i.title=s[5].strings[s[1]?"editlabel":"newlabel"]),n&32&&(i.cancelText=s[5].strings.cancel),n&4&&(i.onCancel=s[2]),n&34&&(i.confirmText=s[5].strings[s[1]?"save":"create"]),n&256&&(i.confirmDisabled=!s[8]),n&525304&&(i.$$scope={dirty:n,ctx:s}),e.$set(i)},i(s){t||(C(e.$$.fragment,s),t=!0)},o(s){L(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function ni(l,e,t){let s,n,i,r,a,o,f,c=E,u=()=>(c(),c=ge(d,T=>t(5,f=T)),d);l.$$.on_destroy.push(()=>c());let{store:d}=e;u();let{label:g=void 0}=e,{onCancel:p}=e,{onSubmit:b}=e,$;const w=async()=>{b(n,i)};mt(()=>$.focus());function v(T){Se[T?"unshift":"push"](()=>{$=T,t(6,$)})}function S(){n=this.value,t(3,n),t(1,g)}const k=T=>{t(7,i=T)};return l.$$set=T=>{"store"in T&&u(t(0,d=T.store)),"label"in T&&t(1,g=T.label),"onCancel"in T&&t(2,p=T.onCancel),"onSubmit"in T&&t(11,b=T.onSubmit)},l.$$.update=()=>{l.$$.dirty&2&&t(9,s=`local-mail-label-modal-${(g==null?void 0:g.id)||"new"}`),l.$$.dirty&2&&t(3,n=(g==null?void 0:g.name)||""),l.$$.dirty&2&&t(7,i=(g==null?void 0:g.color)||ft[0]),l.$$.dirty&8&&t(12,r=jt(n)==""),l.$$.dirty&42&&t(4,a=f.labels.some(T=>T.id!=(g==null?void 0:g.id)&&T.name==jt(n))),l.$$.dirty&4112&&t(8,o=!r&&!a)},[d,g,p,n,a,f,$,i,o,s,w,b,r,v,S,k]}class nn extends ae{constructor(e){super(),oe(this,e,ni,li,re,{store:0,label:1,onCancel:2,onSubmit:11})}}const{Map:ii}=rt;function Ot(l,e,t){const s=l.slice();return s[15]=e[t],s}function Jt(l){let e,t=[],s=new ii,n,i,r=ue(l[2].labels);const a=d=>d[15].id;for(let d=0;d<r.length;d+=1){let g=Ot(l,r,d),p=a(g);s.set(p,t[d]=Kt(p,g))}let o=l[2].labels.length>0&&Vt();function f(d,g){return d[5]?ai:ri}let c=f(l),u=c(l);return{c(){e=h("div");for(let d=0;d<t.length;d+=1)t[d].c();n=j(),o&&o.c(),i=j(),u.c(),m(e,"class","dropdown-menu show")},m(d,g){M(d,e,g);for(let p=0;p<t.length;p+=1)t[p]&&t[p].m(e,null);_(e,n),o&&o.m(e,null),_(e,i),u.m(e,null)},p(d,g){g&276&&(r=ue(d[2].labels),t=je(t,g,a,1,d,r,s,e,dt,Kt,n,Ot)),d[2].labels.length>0?o||(o=Vt(),o.c(),o.m(e,i)):o&&(o.d(1),o=null),c===(c=f(d))&&u?u.p(d,g):(u.d(1),u=c(d),u&&(u.c(),u.m(e,null)))},d(d){d&&y(e);for(let g=0;g<t.length;g+=1)t[g].d();o&&o.d(),u.d()}}}function Kt(l,e){let t,s,n,i,r=e[15].name+"",a,o,f;function c(){return e[13](e[15])}return{key:l,first:null,c(){t=h("button"),s=h("i"),i=j(),a=P(r),m(s,"class",n="fa fa-fw "+e[4](e[15].id)+" svelte-1r4iigx"),m(t,"type","button"),m(t,"class","dropdown-item local-mail-action-label-button-item"),this.first=t},m(u,d){M(u,t,d),_(t,s),_(t,i),_(t,a),o||(f=W(t,"click",c),o=!0)},p(u,d){e=u,d&20&&n!==(n="fa fa-fw "+e[4](e[15].id)+" svelte-1r4iigx")&&m(s,"class",n),d&4&&r!==(r=e[15].name+"")&&R(a,r)},d(u){u&&y(t),o=!1,f()}}}function Vt(l){let e;return{c(){e=h("div"),m(e,"class","dropdown-divider")},m(t,s){M(t,e,s)},d(t){t&&y(e)}}}function ri(l){let e,t=l[2].strings.newlabel+"",s,n,i;return{c(){e=h("button"),s=P(t),m(e,"type","button"),m(e,"class","dropdown-item local-mail-action-label-button-item")},m(r,a){M(r,e,a),_(e,s),n||(i=W(e,"click",l[10]),n=!0)},p(r,a){a&4&&t!==(t=r[2].strings.newlabel+"")&&R(s,t)},d(r){r&&y(e),n=!1,i()}}}function ai(l){let e,t=l[2].strings.apply+"",s,n,i;return{c(){e=h("button"),s=P(t),m(e,"type","button"),m(e,"class","dropdown-item local-mail-action-label-button-item")},m(r,a){M(r,e,a),_(e,s),n||(i=W(e,"click",l[9]),n=!0)},p(r,a){a&4&&t!==(t=r[2].strings.apply+"")&&R(s,t)},d(r){r&&y(e),n=!1,i()}}}function Wt(l){let e,t;return e=new nn({props:{store:l[0],onCancel:l[14],onSubmit:l[11]}}),{c(){J(e.$$.fragment)},m(s,n){O(e,s,n),t=!0},p(s,n){const i={};n&1&&(i.store=s[0]),n&1&&(i.onCancel=s[14]),e.$set(i)},i(s){t||(C(e.$$.fragment,s),t=!0)},o(s){L(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function oi(l){let e,t,s,n,i,r,a,o,f,c,u=l[3]&&Jt(l),d=l[2].params.dialog=="createlabel"&&Wt(l);return{c(){e=h("div"),t=h("button"),s=h("i"),r=j(),u&&u.c(),a=j(),d&&d.c(),m(s,"class","fa fa-fw fa-tag"),m(t,"type","button"),m(t,"class","local-mail-action-label-button btn dropdown-toggle svelte-1r4iigx"),t.disabled=n=!l[2].selectedMessages.size,m(t,"aria-expanded",l[3]),m(t,"title",i=l[2].strings.labels),V(t,"btn-secondary",!l[1]),V(t,"btn-light",l[1]),V(t,"disabled",!l[2].selectedMessages.size),m(e,"class","btn-group"),m(e,"role","group"),V(e,"dropup",l[1])},m(g,p){M(g,e,p),_(e,t),_(t,s),_(e,r),u&&u.m(e,null),_(e,a),d&&d.m(e,null),o=!0,f||(c=[W(t,"click",l[7]),ze(it.call(null,e,l[6]))],f=!0)},p(g,[p]){(!o||p&4&&n!==(n=!g[2].selectedMessages.size))&&(t.disabled=n),(!o||p&8)&&m(t,"aria-expanded",g[3]),(!o||p&4&&i!==(i=g[2].strings.labels))&&m(t,"title",i),(!o||p&2)&&V(t,"btn-secondary",!g[1]),(!o||p&2)&&V(t,"btn-light",g[1]),(!o||p&4)&&V(t,"disabled",!g[2].selectedMessages.size),g[3]?u?u.p(g,p):(u=Jt(g),u.c(),u.m(e,a)):u&&(u.d(1),u=null),g[2].params.dialog=="createlabel"?d?(d.p(g,p),p&4&&C(d,1)):(d=Wt(g),d.c(),C(d,1),d.m(e,null)):d&&(ne(),L(d,1,1,()=>{d=null}),ie()),(!o||p&2)&&V(e,"dropup",g[1])},i(g){o||(C(d),o=!0)},o(g){L(d),o=!1},d(g){g&&y(e),u&&u.d(),d&&d.d(),f=!1,Me(c)}}}function fi(l,e,t){let s,n,i,r=E,a=()=>(r(),r=ge(o,k=>t(2,i=k)),o);l.$$.on_destroy.push(()=>r());let{store:o}=e;a();let{bottom:f=!1}=e,c=!1,u=new Map;const d=()=>{t(3,c=!1)},g=()=>{t(3,c=!c)},p=k=>{t(12,u=new Map(Array.from(u.entries()).map(([T,q])=>[T,T==k?q=="true"?"false":"true":q])))},b=()=>{t(3,c=!1),o.setLabels(Array.from(u.keys()).filter(k=>u.get(k)=="true"),Array.from(u.keys()).filter(k=>u.get(k)=="false"))},$=()=>{d(),o.showDialog("createlabel")},w=async(k,T)=>{o.hideDialog(),o.createLabel(k,T)},v=k=>p(k.id),S=()=>o.hideDialog();return l.$$set=k=>{"store"in k&&a(t(0,o=k.store)),"bottom"in k&&t(1,f=k.bottom)},l.$$.update=()=>{l.$$.dirty&4&&t(12,u=new Map(i.labels.map(k=>{const T=Array.from(i.selectedMessages.values()).filter(q=>q.labels.some(D=>D.id==k.id));return[k.id,T.length==0?"false":T.length<i.selectedMessages.size?"mixed":"true"]}))),l.$$.dirty&4100&&t(5,s=Array.from(u.entries()).some(([k,T])=>Array.from(i.selectedMessages.values()).some(q=>T=="true"&&q.labels.every(D=>D.id!=k)||T=="false"&&q.labels.some(D=>D.id==k)))),l.$$.dirty&4096&&t(4,n=k=>u.get(k)=="false"?"fa-square-o":u.get(k)=="mixed"?"fa-minus-square-o":"fa-check-square-o")},[o,f,i,c,n,s,d,g,p,b,$,w,u,v,S]}class rn extends ae{constructor(e){super(),oe(this,e,fi,oi,re,{store:0,bottom:1})}}function Xt(l){let e;function t(i,r){return i[7].params.tray=="trash"?ci:ui}let s=t(l),n=s(l);return{c(){e=h("div"),n.c(),m(e,"class","dropdown-menu show")},m(i,r){M(i,e,r),n.m(e,null)},p(i,r){s===(s=t(i))&&n?n.p(i,r):(n.d(1),n=s(i),n&&(n.c(),n.m(e,null)))},d(i){i&&y(e),n.d()}}}function ui(l){let e,t,s,n,i,r=l[5]&&Yt(l),a=l[6]&&Qt(l),o=l[3]&&Zt(l),f=l[4]&&xt(l),c=l[2]&&es(l);return{c(){r&&r.c(),e=j(),a&&a.c(),t=j(),o&&o.c(),s=j(),f&&f.c(),n=j(),c&&c.c(),i=_e()},m(u,d){r&&r.m(u,d),M(u,e,d),a&&a.m(u,d),M(u,t,d),o&&o.m(u,d),M(u,s,d),f&&f.m(u,d),M(u,n,d),c&&c.m(u,d),M(u,i,d)},p(u,d){u[5]?r?r.p(u,d):(r=Yt(u),r.c(),r.m(e.parentNode,e)):r&&(r.d(1),r=null),u[6]?a?a.p(u,d):(a=Qt(u),a.c(),a.m(t.parentNode,t)):a&&(a.d(1),a=null),u[3]?o?o.p(u,d):(o=Zt(u),o.c(),o.m(s.parentNode,s)):o&&(o.d(1),o=null),u[4]?f?f.p(u,d):(f=xt(u),f.c(),f.m(n.parentNode,n)):f&&(f.d(1),f=null),u[2]?c?c.p(u,d):(c=es(u),c.c(),c.m(i.parentNode,i)):c&&(c.d(1),c=null)},d(u){u&&(y(e),y(t),y(s),y(n),y(i)),r&&r.d(u),a&&a.d(u),o&&o.d(u),f&&f.d(u),c&&c.d(u)}}}function ci(l){let e,t=l[7].strings.emptytrash+"",s,n,i;return{c(){e=h("button"),s=P(t),m(e,"type","button"),m(e,"class","dropdown-item")},m(r,a){M(r,e,a),_(e,s),n||(i=W(e,"click",l[18]),n=!0)},p(r,a){a&128&&t!==(t=r[7].strings.emptytrash+"")&&R(s,t)},d(r){r&&y(e),n=!1,i()}}}function Yt(l){let e,t=l[7].strings.markasread+"",s,n,i;return{c(){e=h("button"),s=P(t),m(e,"type","button"),m(e,"class","dropdown-item")},m(r,a){M(r,e,a),_(e,s),n||(i=W(e,"click",l[21]),n=!0)},p(r,a){a&128&&t!==(t=r[7].strings.markasread+"")&&R(s,t)},d(r){r&&y(e),n=!1,i()}}}function Qt(l){let e,t=l[7].strings.markasunread+"",s,n,i;return{c(){e=h("button"),s=P(t),m(e,"type","button"),m(e,"class","dropdown-item")},m(r,a){M(r,e,a),_(e,s),n||(i=W(e,"click",l[22]),n=!0)},p(r,a){a&128&&t!==(t=r[7].strings.markasunread+"")&&R(s,t)},d(r){r&&y(e),n=!1,i()}}}function Zt(l){let e,t=l[7].strings.markasstarred+"",s,n,i;return{c(){e=h("button"),s=P(t),m(e,"type","button"),m(e,"class","dropdown-item")},m(r,a){M(r,e,a),_(e,s),n||(i=W(e,"click",l[23]),n=!0)},p(r,a){a&128&&t!==(t=r[7].strings.markasstarred+"")&&R(s,t)},d(r){r&&y(e),n=!1,i()}}}function xt(l){let e,t=l[7].strings.markasunstarred+"",s,n,i;return{c(){e=h("button"),s=P(t),m(e,"type","button"),m(e,"class","dropdown-item")},m(r,a){M(r,e,a),_(e,s),n||(i=W(e,"click",l[24]),n=!0)},p(r,a){a&128&&t!==(t=r[7].strings.markasunstarred+"")&&R(s,t)},d(r){r&&y(e),n=!1,i()}}}function es(l){let e,t,s=l[7].strings.editlabel+"",n,i,r,a=l[7].strings.deletelabel+"",o,f,c,u=(l[5]||l[6]||l[3]||l[4])&&ts();return{c(){u&&u.c(),e=j(),t=h("button"),n=P(s),i=j(),r=h("button"),o=P(a),m(t,"type","button"),m(t,"class","dropdown-item"),m(r,"type","button"),m(r,"class","dropdown-item")},m(d,g){u&&u.m(d,g),M(d,e,g),M(d,t,g),_(t,n),M(d,i,g),M(d,r,g),_(r,o),f||(c=[W(t,"click",l[14]),W(r,"click",l[16])],f=!0)},p(d,g){d[5]||d[6]||d[3]||d[4]?u||(u=ts(),u.c(),u.m(e.parentNode,e)):u&&(u.d(1),u=null),g&128&&s!==(s=d[7].strings.editlabel+"")&&R(n,s),g&128&&a!==(a=d[7].strings.deletelabel+"")&&R(o,a)},d(d){d&&(y(e),y(t),y(i),y(r)),u&&u.d(d),f=!1,Me(c)}}}function ts(l){let e;return{c(){e=h("div"),m(e,"class","dropdown-divider")},m(t,s){M(t,e,s)},d(t){t&&y(e)}}}function mi(l){let e,t,s,n;const i=[_i,gi],r=[];function a(o,f){return o[7].params.dialog=="editlabel"?0:o[7].params.dialog=="deletelabel"?1:-1}return~(e=a(l))&&(t=r[e]=i[e](l)),{c(){t&&t.c(),s=_e()},m(o,f){~e&&r[e].m(o,f),M(o,s,f),n=!0},p(o,f){let c=e;e=a(o),e===c?~e&&r[e].p(o,f):(t&&(ne(),L(r[c],1,1,()=>{r[c]=null}),ie()),~e?(t=r[e],t?t.p(o,f):(t=r[e]=i[e](o),t.c()),C(t,1),t.m(s.parentNode,s)):t=null)},i(o){n||(C(t),n=!0)},o(o){L(t),n=!1},d(o){o&&y(s),~e&&r[e].d(o)}}}function di(l){let e,t,s=l[7].params.dialog=="emptytrash"&&ss(l);return{c(){s&&s.c(),e=_e()},m(n,i){s&&s.m(n,i),M(n,e,i),t=!0},p(n,i){n[7].params.dialog=="emptytrash"?s?(s.p(n,i),i&128&&C(s,1)):(s=ss(n),s.c(),C(s,1),s.m(e.parentNode,e)):s&&(ne(),L(s,1,1,()=>{s=null}),ie())},i(n){t||(C(s),t=!0)},o(n){L(s),t=!1},d(n){n&&y(e),s&&s.d(n)}}}function gi(l){let e,t;return e=new Xe({props:{title:l[7].strings.deletelabel,cancelText:l[7].strings.cancel,confirmText:l[7].strings.deletelabel,confirmClass:"btn-danger",onCancel:l[27],onConfirm:l[17],$$slots:{default:[pi]},$$scope:{ctx:l}}}),{c(){J(e.$$.fragment)},m(s,n){O(e,s,n),t=!0},p(s,n){const i={};n&128&&(i.title=s[7].strings.deletelabel),n&128&&(i.cancelText=s[7].strings.cancel),n&128&&(i.confirmText=s[7].strings.deletelabel),n&1&&(i.onCancel=s[27]),n&268435588&&(i.$$scope={dirty:n,ctx:s}),e.$set(i)},i(s){t||(C(e.$$.fragment,s),t=!0)},o(s){L(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function _i(l){let e,t;return e=new nn({props:{store:l[0],label:l[2],onCancel:l[26],onSubmit:l[15]}}),{c(){J(e.$$.fragment)},m(s,n){O(e,s,n),t=!0},p(s,n){const i={};n&1&&(i.store=s[0]),n&4&&(i.label=s[2]),n&1&&(i.onCancel=s[26]),e.$set(i)},i(s){t||(C(e.$$.fragment,s),t=!0)},o(s){L(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function pi(l){let e=qe(l[7].strings.deletelabelconfirm,l[2].name)+"",t;return{c(){t=P(e)},m(s,n){M(s,t,n)},p(s,n){n&132&&e!==(e=qe(s[7].strings.deletelabelconfirm,s[2].name)+"")&&R(t,e)},d(s){s&&y(t)}}}function ss(l){let e,t;return e=new Xe({props:{title:l[7].strings.emptytrash,cancelText:l[7].strings.cancel,confirmText:l[7].strings.emptytrash,confirmClass:"btn-danger",onCancel:l[25],onConfirm:l[19],$$slots:{default:[bi]},$$scope:{ctx:l}}}),{c(){J(e.$$.fragment)},m(s,n){O(e,s,n),t=!0},p(s,n){const i={};n&128&&(i.title=s[7].strings.emptytrash),n&128&&(i.cancelText=s[7].strings.cancel),n&128&&(i.confirmText=s[7].strings.emptytrash),n&1&&(i.onCancel=s[25]),n&268435584&&(i.$$scope={dirty:n,ctx:s}),e.$set(i)},i(s){t||(C(e.$$.fragment,s),t=!0)},o(s){L(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function bi(l){let e=l[7].strings.emptytrashconfirm+"",t;return{c(){t=P(e)},m(s,n){M(s,t,n)},p(s,n){n&128&&e!==(e=s[7].strings.emptytrashconfirm+"")&&R(t,e)},d(s){s&&y(t)}}}function hi(l){let e,t,s,n,i,r,a,o,f,c,u,d,g=l[8]&&Xt(l);const p=[di,mi],b=[];function $(w,v){return w[7].params.tray=="trash"?0:w[2]?1:-1}return~(a=$(l))&&(o=b[a]=p[a](l)),{c(){e=h("div"),t=h("button"),s=h("i"),i=j(),g&&g.c(),r=j(),o&&o.c(),f=_e(),m(s,"class","fa fa-fw fa-ellipsis-v"),m(t,"type","button"),m(t,"class","local-mail-action-more-button btn dropdown-toggle svelte-14se2dy"),t.disabled=l[9],m(t,"aria-expanded",l[8]),m(t,"title",n=l[7].strings.more),V(t,"btn-secondary",!l[1]),V(t,"btn-light",l[1]),V(t,"disabled",l[9]),m(e,"class","btn-group"),V(e,"dropup",l[1])},m(w,v){M(w,e,v),_(e,t),_(t,s),_(e,i),g&&g.m(e,null),M(w,r,v),~a&&b[a].m(w,v),M(w,f,v),c=!0,u||(d=[W(t,"click",l[11]),ze(it.call(null,e,l[10]))],u=!0)},p(w,[v]){(!c||v&512)&&(t.disabled=w[9]),(!c||v&256)&&m(t,"aria-expanded",w[8]),(!c||v&128&&n!==(n=w[7].strings.more))&&m(t,"title",n),(!c||v&2)&&V(t,"btn-secondary",!w[1]),(!c||v&2)&&V(t,"btn-light",w[1]),(!c||v&512)&&V(t,"disabled",w[9]),w[8]?g?g.p(w,v):(g=Xt(w),g.c(),g.m(e,null)):g&&(g.d(1),g=null),(!c||v&2)&&V(e,"dropup",w[1]);let S=a;a=$(w),a===S?~a&&b[a].p(w,v):(o&&(ne(),L(b[S],1,1,()=>{b[S]=null}),ie()),~a?(o=b[a],o?o.p(w,v):(o=b[a]=p[a](w),o.c()),C(o,1),o.m(f.parentNode,f)):o=null)},i(w){c||(C(o),c=!0)},o(w){L(o),c=!1},d(w){w&&(y(e),y(r),y(f)),g&&g.d(),~a&&b[a].d(w),u=!1,Me(d)}}}function ki(l,e,t){let s,n,i,r,a,o,f,c,u=E,d=()=>(u(),u=ge(g,F=>t(7,c=F)),g);l.$$.on_destroy.push(()=>u());let{store:g}=e;d();let{bottom:p=!1}=e,b=!1;const $=()=>{t(8,b=!1)},w=()=>{t(8,b=!b)},v=F=>{$(),g.setUnread(n.filter(te=>!te.draft).map(te=>te.id),F)},S=F=>{$(),g.setStarred(n.map(te=>te.id),F)},k=()=>{$(),g.showDialog("editlabel")},T=(F,te)=>{g.hideDialog(),s&&g.updateLabel(s.id,F,te)},q=()=>{$(),g.showDialog("deletelabel")},D=()=>{g.hideDialog(),g.deleteLabel(c.params.labelid||0)},A=()=>{$(),g.showDialog("emptytrash")},z=()=>{g.hideDialog(),g.emptyTrash(c.params.courseid)},K=()=>v(!1),G=()=>v(!0),U=()=>S(!0),se=()=>S(!1),le=()=>g.hideDialog(),Q=()=>g.hideDialog(),ee=()=>g.hideDialog();return l.$$set=F=>{"store"in F&&d(t(0,g=F.store)),"bottom"in F&&t(1,p=F.bottom)},l.$$.update=()=>{l.$$.dirty&128&&t(2,s=c.params.tray=="label"&&c.message==null?c.labels.find(F=>F.id==c.params.labelid):null),l.$$.dirty&128&&t(20,n=Array.from(c.selectedMessages.values())),l.$$.dirty&1048576&&t(6,i=n.some(F=>!F.draft&&!F.unread)),l.$$.dirty&1048576&&t(5,r=n.some(F=>!F.draft&&F.unread)),l.$$.dirty&1048576&&t(4,a=n.some(F=>F.starred)),l.$$.dirty&1048576&&t(3,o=n.some(F=>!F.starred)),l.$$.dirty&252&&t(9,f=c.params.tray=="trash"?!c.totalCount:!s&&!i&&!r&&!a&&!o)},[g,p,s,o,a,r,i,c,b,f,$,w,v,S,k,T,q,D,A,z,n,K,G,U,se,le,Q,ee]}class an extends ae{constructor(e){super(),oe(this,e,ki,hi,re,{store:0,bottom:1})}}function ls(l){let e,t;return{c(){e=h("div"),t=P(l[3]),m(e,"class","align-self-center text-nowrap")},m(s,n){M(s,e,n),_(e,t)},p(s,n){n&8&&R(t,s[3])},d(s){s&&y(e)}}}function ns(l){let e,t;return{c(){e=h("div"),t=P(l[3]),m(e,"class","text-truncate align-self-center flex-shrink-1 mx-2"),he(e,"min-width","0")},m(s,n){M(s,e,n),_(e,t)},p(s,n){n&8&&R(t,s[3])},d(s){s&&y(e)}}}function vi(l){let e,t,s,n,i,r,a,o,f,c,u,d,g,p,b,$,w,v=!l[1]&&ls(l),S=l[1]&&ns(l);return{c(){e=h("div"),v&&v.c(),t=j(),s=h("div"),n=h("button"),i=h("i"),f=j(),S&&S.c(),c=j(),u=h("button"),d=h("i"),m(i,"class","fa fa-fw fa-chevron-left"),m(i,"aria-label",r=l[2].strings.previouspage),m(n,"type","button"),m(n,"class","btn btn-secondary"),n.disabled=a=!l[4],m(n,"title",o=l[2].strings[l[2].message?"previousmessage":"previouspage"]),V(n,"btn-secondary",!l[1]),V(n,"btn-light",l[1]),m(d,"class","fa fa-fw fa-chevron-right"),m(d,"aria-label",g=l[2].strings.nextpage),m(u,"type","button"),m(u,"class","btn"),u.disabled=p=!l[5],m(u,"title",b=l[2].strings[l[2].message?"nextmessage":"nextpage"]),V(u,"btn-secondary",!l[1]),V(u,"btn-light",l[1]),m(s,"class","btn-group d-flex"),m(s,"role","group"),he(s,"min-width","0"),V(s,"btn-group",!l[1]),m(e,"class","local-mail-paging-buttons d-flex svelte-nbwrye"),V(e,"ml-auto",!l[1])},m(k,T){M(k,e,T),v&&v.m(e,null),_(e,t),_(e,s),_(s,n),_(n,i),_(s,f),S&&S.m(s,null),_(s,c),_(s,u),_(u,d),$||(w=[W(n,"click",Ae(l[8])),W(u,"click",Ae(l[9]))],$=!0)},p(k,[T]){k[1]?v&&(v.d(1),v=null):v?v.p(k,T):(v=ls(k),v.c(),v.m(e,t)),T&4&&r!==(r=k[2].strings.previouspage)&&m(i,"aria-label",r),T&16&&a!==(a=!k[4])&&(n.disabled=a),T&4&&o!==(o=k[2].strings[k[2].message?"previousmessage":"previouspage"])&&m(n,"title",o),T&2&&V(n,"btn-secondary",!k[1]),T&2&&V(n,"btn-light",k[1]),k[1]?S?S.p(k,T):(S=ns(k),S.c(),S.m(s,c)):S&&(S.d(1),S=null),T&4&&g!==(g=k[2].strings.nextpage)&&m(d,"aria-label",g),T&32&&p!==(p=!k[5])&&(u.disabled=p),T&4&&b!==(b=k[2].strings[k[2].message?"nextmessage":"nextpage"])&&m(u,"title",b),T&2&&V(u,"btn-secondary",!k[1]),T&2&&V(u,"btn-light",k[1]),T&2&&V(s,"btn-group",!k[1]),T&2&&V(e,"ml-auto",!k[1])},i:E,o:E,d(k){k&&y(e),v&&v.d(),S&&S.d(),$=!1,Me(w)}}}function wi(l,e,t){let s,n,i,r,a,o,f=E,c=()=>(f(),f=ge(u,b=>t(2,o=b)),u);l.$$.on_destroy.push(()=>f());let{store:u}=e;c();let{bottom:d=!1}=e;const g=()=>u.navigate(r),p=()=>u.navigate(i);return l.$$set=b=>{"store"in b&&c(t(0,u=b.store)),"bottom"in b&&t(1,d=b.bottom)},l.$$.update=()=>{var b;l.$$.dirty&4&&t(7,s=o.nextMessageId||!o.params.search&&(o.params.offset||0)+o.preferences.perpage<o.totalCount),l.$$.dirty&4&&t(6,n=o.prevMessageId||!o.params.search&&(o.params.offset||0)),l.$$.dirty&132&&t(5,i=s?o.message?{...o.params,messageid:o.nextMessageId,offset:(o.params.offset||0)+1}:{...o.params,messageid:void 0,offset:(o.params.offset||0)+o.preferences.perpage,search:o.params.search?{...o.params.search,startid:(b=o.listMessages[o.listMessages.length-1])==null?void 0:b.id,reverse:!1}:void 0}:void 0),l.$$.dirty&68&&t(4,r=n?o.message?{...o.params,messageid:o.prevMessageId,offset:Math.max(0,(o.params.offset||0)-1)}:{...o.params,messageid:void 0,offset:Math.max(0,(o.params.offset||0)-o.preferences.perpage),search:o.params.search?{...o.params.search,startid:o.listMessages[0].id,reverse:!0}:void 0}:void 0),l.$$.dirty&4&&t(3,a=o.message?o.params.search||o.viewportSize<fe.SM?Fe((o.params.offset||0)+1):qe(o.strings.pagingsingle,{index:Fe((o.messageOffset||0)+1),total:Fe(o.totalCount)}):o.listMessages.length==0?"":o.params.search||o.viewportSize<fe.SM?qe(o.strings.pagingrange,{first:Fe((o.params.offset||0)+1),last:Fe((o.params.offset||0)+o.listMessages.length)}):qe(o.strings.pagingrangetotal,{first:Fe((o.params.offset||0)+1),last:Fe((o.params.offset||0)+o.listMessages.length),total:Fe(o.totalCount)}))},[u,d,o,a,r,i,n,s,g,p]}class on extends ae{constructor(e){super(),oe(this,e,wi,vi,re,{store:0,bottom:1})}}function is(l){let e,t;return e=new Xe({props:{title:l[2].strings.restore,cancelText:l[2].strings.cancel,confirmText:l[2].strings.restore,onCancel:l[5],onConfirm:l[3],$$slots:{default:[$i]},$$scope:{ctx:l}}}),{c(){J(e.$$.fragment)},m(s,n){O(e,s,n),t=!0},p(s,n){const i={};n&4&&(i.title=s[2].strings.restore),n&4&&(i.cancelText=s[2].strings.cancel),n&4&&(i.confirmText=s[2].strings.restore),n&1&&(i.onCancel=s[5]),n&68&&(i.$$scope={dirty:n,ctx:s}),e.$set(i)},i(s){t||(C(e.$$.fragment,s),t=!0)},o(s){L(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function $i(l){let e=l[2].strings.restoremessageconfirm+"",t;return{c(){t=P(e)},m(s,n){M(s,t,n)},p(s,n){n&4&&e!==(e=s[2].strings.restoremessageconfirm+"")&&R(t,e)},d(s){s&&y(t)}}}function yi(l){let e,t,s,n,i,r,a,o,f,c=l[2].params.dialog=="restore"&&is(l);return{c(){e=h("button"),t=h("i"),i=j(),c&&c.c(),r=_e(),m(t,"class","fa fa-fw fa-undo"),m(e,"type","button"),m(e,"class","local-mail-action-delete btn"),e.disabled=s=!l[2].selectedMessages.size,m(e,"title",n=l[2].strings.restore),V(e,"btn-secondary",!l[1]),V(e,"btn-light",l[1])},m(u,d){M(u,e,d),_(e,t),M(u,i,d),c&&c.m(u,d),M(u,r,d),a=!0,o||(f=W(e,"click",l[4]),o=!0)},p(u,[d]){(!a||d&4&&s!==(s=!u[2].selectedMessages.size))&&(e.disabled=s),(!a||d&4&&n!==(n=u[2].strings.restore))&&m(e,"title",n),(!a||d&2)&&V(e,"btn-secondary",!u[1]),(!a||d&2)&&V(e,"btn-light",u[1]),u[2].params.dialog=="restore"?c?(c.p(u,d),d&4&&C(c,1)):(c=is(u),c.c(),C(c,1),c.m(r.parentNode,r)):c&&(ne(),L(c,1,1,()=>{c=null}),ie())},i(u){a||(C(c),a=!0)},o(u){L(c),a=!1},d(u){u&&(y(e),y(i),y(r)),c&&c.d(u),o=!1,f()}}}function Mi(l,e,t){let s,n=E,i=()=>(n(),n=ge(r,u=>t(2,s=u)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{bottom:a=!1}=e;const o=()=>{r.hideDialog(),r.setDeleted(Array.from(s.selectedMessages.keys()),Ve.NotDeleted,!0)},f=()=>r.showDialog("restore"),c=()=>r.hideDialog();return l.$$set=u=>{"store"in u&&i(t(0,r=u.store)),"bottom"in u&&t(1,a=u.bottom)},[r,a,s,o,f,c]}class fn extends ae{constructor(e){super(),oe(this,e,Mi,yi,re,{store:0,bottom:1})}}function Ci(l){let e,t,s,n;return e=new rn({props:{store:l[0],bottom:!0}}),s=new sn({props:{store:l[0],bottom:!0}}),{c(){J(e.$$.fragment),t=j(),J(s.$$.fragment)},m(i,r){O(e,i,r),M(i,t,r),O(s,i,r),n=!0},p(i,r){const a={};r&1&&(a.store=i[0]),e.$set(a);const o={};r&1&&(o.store=i[0]),s.$set(o)},i(i){n||(C(e.$$.fragment,i),C(s.$$.fragment,i),n=!0)},o(i){L(e.$$.fragment,i),L(s.$$.fragment,i),n=!1},d(i){i&&y(t),H(e,i),H(s,i)}}}function Si(l){let e,t,s,n;return e=new fn({props:{store:l[0],bottom:!0}}),s=new ln({props:{store:l[0],bottom:!0}}),{c(){J(e.$$.fragment),t=j(),J(s.$$.fragment)},m(i,r){O(e,i,r),M(i,t,r),O(s,i,r),n=!0},p(i,r){const a={};r&1&&(a.store=i[0]),e.$set(a);const o={};r&1&&(o.store=i[0]),s.$set(o)},i(i){n||(C(e.$$.fragment,i),C(s.$$.fragment,i),n=!0)},o(i){L(e.$$.fragment,i),L(s.$$.fragment,i),n=!1},d(i){i&&y(t),H(e,i),H(s,i)}}}function Di(l){let e,t,s,n,i,r,a,o,f;const c=[Si,Ci],u=[];function d(g,p){return g[1].params.tray=="trash"?0:1}return s=d(l),n=u[s]=c[s](l),r=new an({props:{store:l[0],bottom:!0}}),o=new on({props:{store:l[0],bottom:!0}}),{c(){e=h("div"),t=h("div"),n.c(),i=j(),J(r.$$.fragment),a=j(),J(o.$$.fragment),m(t,"class","d-flex justify-content-around"),m(t,"role","group"),m(e,"role","toolbar"),m(e,"class","local-mail-toolbar px-2 py-3 bg-light border-top border-bottom svelte-fc3ty8")},m(g,p){M(g,e,p),_(e,t),u[s].m(t,null),_(t,i),O(r,t,null),_(t,a),O(o,t,null),f=!0},p(g,[p]){let b=s;s=d(g),s===b?u[s].p(g,p):(ne(),L(u[b],1,1,()=>{u[b]=null}),ie(),n=u[s],n?n.p(g,p):(n=u[s]=c[s](g),n.c()),C(n,1),n.m(t,i));const $={};p&1&&($.store=g[0]),r.$set($);const w={};p&1&&(w.store=g[0]),o.$set(w)},i(g){f||(C(n),C(r.$$.fragment,g),C(o.$$.fragment,g),f=!0)},o(g){L(n),L(r.$$.fragment,g),L(o.$$.fragment,g),f=!1},d(g){g&&y(e),u[s].d(),H(r),H(o)}}}function Ti(l,e,t){let s,n=E,i=()=>(n(),n=ge(r,a=>t(1,s=a)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;return i(),l.$$set=a=>{"store"in a&&i(t(0,r=a.store))},[r,s]}class Li extends ae{constructor(e){super(),oe(this,e,Ti,Di,re,{store:0})}}function un(l,{from:e,to:t},s={}){const n=getComputedStyle(l),i=n.transform==="none"?"":n.transform,[r,a]=n.transformOrigin.split(" ").map(parseFloat),o=e.left+e.width*r/t.width-(t.left+r),f=e.top+e.height*a/t.height-(t.top+a),{delay:c=0,duration:u=g=>Math.sqrt(g)*120,easing:d=tn}=s;return{delay:c,duration:De(u)?u(Math.sqrt(o*o+f*f)):u,easing:d,css:(g,p)=>{const b=p*o,$=p*f,w=g+p*e.width/t.width,v=g+p*e.height/t.height;return`transform: ${i} translate(${b}px, ${$}px) scale(${w}, ${v});`}}}function ji(l){let e,t,s,n,i,r,a;return{c(){e=h("button"),t=h("i"),m(t,"class",s="fa "+l[3]),m(e,"type","button"),m(e,"class","btn px-2 d-flex align-items-center border-0"),m(e,"role","checkbox"),m(e,"aria-checked",n=!!l[2].selectedMessages.has(l[1].id)),m(e,"title",i=l[2].strings.select)},m(o,f){M(o,e,f),_(e,t),r||(a=W(e,"click",Ol(Ae(l[4]))),r=!0)},p(o,[f]){f&8&&s!==(s="fa "+o[3])&&m(t,"class",s),f&6&&n!==(n=!!o[2].selectedMessages.has(o[1].id))&&m(e,"aria-checked",n),f&4&&i!==(i=o[2].strings.select)&&m(e,"title",i)},i:E,o:E,d(o){o&&y(e),r=!1,a()}}}function zi(l,e,t){let s,n,i=E,r=()=>(i(),i=ge(a,c=>t(2,n=c)),a);l.$$.on_destroy.push(()=>i());let{store:a}=e;r();let{message:o}=e;const f=()=>a.toggleSelected(o.id);return l.$$set=c=>{"store"in c&&r(t(0,a=c.store)),"message"in c&&t(1,o=c.message)},l.$$.update=()=>{l.$$.dirty&6&&t(3,s=n.selectedMessages.has(o.id)?"fa-check-square-o":"fa-square-o")},[a,o,n,s,f]}class cn extends ae{constructor(e){super(),oe(this,e,zi,ji,re,{store:0,message:1})}}function Ni(l){let e,t,s,n,i,r,a,o;return{c(){e=h("button"),t=h("i"),m(t,"class",s="fa "+l[2]),m(e,"type","button"),m(e,"class","btn px-2 border-0"),m(e,"role","checkbox"),m(e,"aria-checked",n=l[1].starred),e.disabled=i=l[1].deleted,m(e,"title",r=l[1].deleted?l[3].strings[l[1].starred?"starred":"unstarred"]:l[3].strings[l[1].starred?"markasunstarred":"markasstarred"])},m(f,c){M(f,e,c),_(e,t),a||(o=W(e,"click",Ol(Ae(l[4]))),a=!0)},p(f,[c]){c&4&&s!==(s="fa "+f[2])&&m(t,"class",s),c&2&&n!==(n=f[1].starred)&&m(e,"aria-checked",n),c&2&&i!==(i=f[1].deleted)&&(e.disabled=i),c&10&&r!==(r=f[1].deleted?f[3].strings[f[1].starred?"starred":"unstarred"]:f[3].strings[f[1].starred?"markasunstarred":"markasstarred"])&&m(e,"title",r)},i:E,o:E,d(f){f&&y(e),a=!1,o()}}}function qi(l,e,t){let s,n,i=E,r=()=>(i(),i=ge(a,c=>t(3,n=c)),a);l.$$.on_destroy.push(()=>i());let{store:a}=e;r();let{message:o}=e;const f=()=>a.setStarred([o.id],!o.starred);return l.$$set=c=>{"store"in c&&r(t(0,a=c.store)),"message"in c&&t(1,o=c.message)},l.$$.update=()=>{l.$$.dirty&2&&t(2,s=o.starred?"fa-star text-warning":"fa-star-o")},[a,o,s,n,f]}class mn extends ae{constructor(e){super(),oe(this,e,qi,Ni,re,{store:0,message:1})}}function Ii(l){let e,t=l[1].join(", ")+"",s,n,i,r;return{c(){e=h("div"),s=P(t)},m(a,o){M(a,e,o),_(e,s),i||(r=ze(n=We.call(null,e,l[1].join(`
`))),i=!0)},p(a,[o]){o&2&&t!==(t=a[1].join(", ")+"")&&R(s,t),n&&De(n.update)&&o&2&&n.update.call(null,a[1].join(`
`))},i:E,o:E,d(a){a&&y(e),i=!1,r()}}}function Ai(l,e,t){let s,n,i=E,r=()=>(i(),i=ge(a,f=>t(3,n=f)),a);l.$$.on_destroy.push(()=>i());let{store:a}=e;r();let{message:o}=e;return l.$$set=f=>{"store"in f&&r(t(0,a=f.store)),"message"in f&&t(2,o=f.message)},l.$$.update=()=>{l.$$.dirty&12&&t(1,s=n.params.tray=="sent"||n.params.tray=="drafts"?o.recipients.length>0?o.recipients.map(f=>f.fullname):[n.strings.norecipient]:[o.sender.fullname])},[a,s,o,n]}class wt extends ae{constructor(e){super(),oe(this,e,Ai,Ii,re,{store:0,message:2})}}function rs(l){let e,t=l[2].strings.draft+"",s;return{c(){e=h("span"),s=P(t),m(e,"class","mr-2 text-danger")},m(n,i){M(n,e,i),_(e,s)},p(n,i){i&4&&t!==(t=n[2].strings.draft+"")&&R(s,t)},d(n){n&&y(e)}}}function Bi(l){let e,t,s=(l[1].subject||l[2].strings.nosubject)+"",n,i,r,a,o=l[1].draft&&rs(l);return{c(){e=h("div"),o&&o.c(),t=j(),n=P(s)},m(f,c){M(f,e,c),o&&o.m(e,null),_(e,t),_(e,n),r||(a=ze(i=We.call(null,e,l[1].subject||l[2].strings.nosubject)),r=!0)},p(f,[c]){f[1].draft?o?o.p(f,c):(o=rs(f),o.c(),o.m(e,t)):o&&(o.d(1),o=null),c&6&&s!==(s=(f[1].subject||f[2].strings.nosubject)+"")&&R(n,s),i&&De(i.update)&&c&6&&i.update.call(null,f[1].subject||f[2].strings.nosubject)},i:E,o:E,d(f){f&&y(e),o&&o.d(),r=!1,a()}}}function Pi(l,e,t){let s,n=E,i=()=>(n(),n=ge(r,o=>t(2,s=o)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{message:a}=e;return l.$$set=o=>{"store"in o&&i(t(0,r=o.store)),"message"in o&&t(1,a=o.message)},[r,a,s]}class $t extends ae{constructor(e){super(),oe(this,e,Pi,Bi,re,{store:0,message:1})}}function as(l){let e,t,s,n,i;return{c(){e=h("span"),t=P(l[2]),m(e,"class","local-mail-course-badge badge px-2 mr-2 mb-2 svelte-5ccbek"),he(e,"min-width","3rem"),he(e,"max-width","calc("+l[1]+"ch + 1.5rem)")},m(r,a){M(r,e,a),_(e,t),n||(i=ze(s=We.call(null,e,l[2])),n=!0)},p(r,a){a&4&&R(t,r[2]),a&2&&he(e,"max-width","calc("+r[1]+"ch + 1.5rem)"),s&&De(s.update)&&a&4&&s.update.call(null,r[2])},d(r){r&&y(e),n=!1,i()}}}function Ei(l){let e=["shortname","fullname"].includes(l[0].coursebadges),t,s=e&&as(l);return{c(){s&&s.c(),t=_e()},m(n,i){s&&s.m(n,i),M(n,t,i)},p(n,[i]){i&1&&(e=["shortname","fullname"].includes(n[0].coursebadges)),e?s?s.p(n,i):(s=as(n),s.c(),s.m(t.parentNode,t)):s&&(s.d(1),s=null)},i:E,o:E,d(n){n&&y(t),s&&s.d(n)}}}function Ri(l,e,t){let s,n,{course:i}=e,{settings:r}=e;return l.$$set=a=>{"course"in a&&t(3,i=a.course),"settings"in a&&t(0,r=a.settings)},l.$$.update=()=>{l.$$.dirty&9&&t(2,s=et(i,r.coursebadges)),l.$$.dirty&1&&t(1,n=r.coursebadgeslength||20)},[r,n,s,i]}class yt extends ae{constructor(e){super(),oe(this,e,Ri,Ei,re,{course:3,settings:0})}}function Fi(l){let e,t=l[0].name+"",s,n;return{c(){e=h("span"),s=P(t),m(e,"class","local-mail-label-badge badge flex-shrink-0 px-2 mr-2 mb-2 svelte-dxzll7"),m(e,"style",n=`color: var(--local-mail-color-${l[1]}-fg, var(--local-mail-color-gray-fg));background-color: var(--local-mail-color-${l[1]}-bg, var(--local-mail-color-gray-bg))`)},m(i,r){M(i,e,r),_(e,s)},p(i,[r]){r&1&&t!==(t=i[0].name+"")&&R(s,t),r&2&&n!==(n=`color: var(--local-mail-color-${i[1]}-fg, var(--local-mail-color-gray-fg));background-color: var(--local-mail-color-${i[1]}-bg, var(--local-mail-color-gray-bg))`)&&m(e,"style",n)},i:E,o:E,d(i){i&&y(e)}}}function Gi(l,e,t){let s,{label:n}=e;return l.$$set=i=>{"label"in i&&t(0,n=i.label)},l.$$.update=()=>{l.$$.dirty&1&&t(1,s=ft.includes(n.color)?n.color:"gray")},[n,s]}class Mt extends ae{constructor(e){super(),oe(this,e,Gi,Fi,re,{label:0})}}function os(l,e,t){const s=l.slice();return s[3]=e[t],s}function fs(l){let e,t,s=l[2].params.courseid!=l[1].course.id&&us(l);return{c(){s&&s.c(),e=_e()},m(n,i){s&&s.m(n,i),M(n,e,i),t=!0},p(n,i){n[2].params.courseid!=n[1].course.id?s?(s.p(n,i),i&6&&C(s,1)):(s=us(n),s.c(),C(s,1),s.m(e.parentNode,e)):s&&(ne(),L(s,1,1,()=>{s=null}),ie())},i(n){t||(C(s),t=!0)},o(n){L(s),t=!1},d(n){n&&y(e),s&&s.d(n)}}}function us(l){let e,t;return e=new yt({props:{course:l[1].course,settings:l[2].settings}}),{c(){J(e.$$.fragment)},m(s,n){O(e,s,n),t=!0},p(s,n){const i={};n&2&&(i.course=s[1].course),n&4&&(i.settings=s[2].settings),e.$set(i)},i(s){t||(C(e.$$.fragment,s),t=!0)},o(s){L(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function cs(l){let e,t;return e=new Mt({props:{label:l[3]}}),{c(){J(e.$$.fragment)},m(s,n){O(e,s,n),t=!0},p(s,n){const i={};n&2&&(i.label=s[3]),e.$set(i)},i(s){t||(C(e.$$.fragment,s),t=!0)},o(s){L(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function ms(l,e){let t,s,n,i=(e[2].params.tray!="label"||e[2].params.labelid!=e[3].id)&&cs(e);return{key:l,first:null,c(){t=_e(),i&&i.c(),s=_e(),this.first=t},m(r,a){M(r,t,a),i&&i.m(r,a),M(r,s,a),n=!0},p(r,a){e=r,e[2].params.tray!="label"||e[2].params.labelid!=e[3].id?i?(i.p(e,a),a&6&&C(i,1)):(i=cs(e),i.c(),C(i,1),i.m(s.parentNode,s)):i&&(ne(),L(i,1,1,()=>{i=null}),ie())},i(r){n||(C(i),n=!0)},o(r){L(i),n=!1},d(r){r&&(y(t),y(s)),i&&i.d(r)}}}function ds(l){let e,t,s=l[2].params.courseid!=l[1].course.id&&gs(l);return{c(){s&&s.c(),e=_e()},m(n,i){s&&s.m(n,i),M(n,e,i),t=!0},p(n,i){n[2].params.courseid!=n[1].course.id?s?(s.p(n,i),i&6&&C(s,1)):(s=gs(n),s.c(),C(s,1),s.m(e.parentNode,e)):s&&(ne(),L(s,1,1,()=>{s=null}),ie())},i(n){t||(C(s),t=!0)},o(n){L(s),t=!1},d(n){n&&y(e),s&&s.d(n)}}}function gs(l){let e,t;return e=new yt({props:{course:l[1].course,settings:l[2].settings}}),{c(){J(e.$$.fragment)},m(s,n){O(e,s,n),t=!0},p(s,n){const i={};n&2&&(i.course=s[1].course),n&4&&(i.settings=s[2].settings),e.$set(i)},i(s){t||(C(e.$$.fragment,s),t=!0)},o(s){L(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function Ui(l){let e,t=[],s=new Map,n,i,r,a=l[2].viewportSize<fe.MD&&fs(l),o=ue(l[1].labels);const f=u=>u[3].id;for(let u=0;u<o.length;u+=1){let d=os(l,o,u),g=f(d);s.set(g,t[u]=ms(g,d))}let c=l[2].viewportSize>=fe.MD&&ds(l);return{c(){a&&a.c(),e=j();for(let u=0;u<t.length;u+=1)t[u].c();n=j(),c&&c.c(),i=_e()},m(u,d){a&&a.m(u,d),M(u,e,d);for(let g=0;g<t.length;g+=1)t[g]&&t[g].m(u,d);M(u,n,d),c&&c.m(u,d),M(u,i,d),r=!0},p(u,[d]){u[2].viewportSize<fe.MD?a?(a.p(u,d),d&4&&C(a,1)):(a=fs(u),a.c(),C(a,1),a.m(e.parentNode,e)):a&&(ne(),L(a,1,1,()=>{a=null}),ie()),d&6&&(o=ue(u[1].labels),ne(),t=je(t,d,f,1,u,o,s,n.parentNode,Je,ms,n,os),ie()),u[2].viewportSize>=fe.MD?c?(c.p(u,d),d&4&&C(c,1)):(c=ds(u),c.c(),C(c,1),c.m(i.parentNode,i)):c&&(ne(),L(c,1,1,()=>{c=null}),ie())},i(u){if(!r){C(a);for(let d=0;d<o.length;d+=1)C(t[d]);C(c),r=!0}},o(u){L(a);for(let d=0;d<t.length;d+=1)L(t[d]);L(c),r=!1},d(u){u&&(y(e),y(n),y(i)),a&&a.d(u);for(let d=0;d<t.length;d+=1)t[d].d(u);c&&c.d(u)}}}function Hi(l,e,t){let s,n=E,i=()=>(n(),n=ge(r,o=>t(2,s=o)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{message:a}=e;return l.$$set=o=>{"store"in o&&i(t(0,r=o.store)),"message"in o&&t(1,a=o.message)},[r,a,s]}class dn extends ae{constructor(e){super(),oe(this,e,Hi,Ui,re,{store:0,message:1})}}function _s(l){let e,t,s,n,i;return{c(){e=h("span"),t=h("i"),m(t,"class",s="fa fa-fw "+(l[1].numattachments>0?"fa-paperclip":"")),m(t,"aria-hidden",!0),m(e,"class","-shrink-0 mr-2"),m(e,"aria-hidden",n=l[1].numattachments==0),m(e,"title",i=l[1].numattachments>0?l[2].strings.hasattachments:void 0)},m(r,a){M(r,e,a),_(e,t)},p(r,a){a&2&&s!==(s="fa fa-fw "+(r[1].numattachments>0?"fa-paperclip":""))&&m(t,"class",s),a&2&&n!==(n=r[1].numattachments==0)&&m(e,"aria-hidden",n),a&6&&i!==(i=r[1].numattachments>0?r[2].strings.hasattachments:void 0)&&m(e,"title",i)},d(r){r&&y(e)}}}function Oi(l){let e,t=(l[1].numattachments>0||l[2].viewportSize>=fe.MD)&&_s(l);return{c(){t&&t.c(),e=_e()},m(s,n){t&&t.m(s,n),M(s,e,n)},p(s,[n]){s[1].numattachments>0||s[2].viewportSize>=fe.MD?t?t.p(s,n):(t=_s(s),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:E,o:E,d(s){s&&y(e),t&&t.d(s)}}}function Ji(l,e,t){let s,n=E,i=()=>(n(),n=ge(r,o=>t(2,s=o)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{message:a}=e;return l.$$set=o=>{"store"in o&&i(t(0,r=o.store)),"message"in o&&t(1,a=o.message)},[r,a,s]}class gn extends ae{constructor(e){super(),oe(this,e,Ji,Oi,re,{store:0,message:1})}}function Ki(l){let e,t=l[0].shorttime+"",s,n;return{c(){e=h("span"),s=P(t),m(e,"class","local-mail-list-message-time d-shrink-0 text-nowrap text-right svelte-phmq8k"),m(e,"title",n=l[0].fulltime),V(e,"local-mail-list-message-time-md",l[2].viewportSize>=fe.MD)},m(i,r){M(i,e,r),_(e,s)},p(i,[r]){r&1&&t!==(t=i[0].shorttime+"")&&R(s,t),r&1&&n!==(n=i[0].fulltime)&&m(e,"title",n),r&4&&V(e,"local-mail-list-message-time-md",i[2].viewportSize>=fe.MD)},i:E,o:E,d(i){i&&y(e)}}}function Vi(l,e,t){let s,n=E,i=()=>(n(),n=ge(a,o=>t(2,s=o)),a);l.$$.on_destroy.push(()=>n());let{message:r}=e,{store:a}=e;return i(),l.$$set=o=>{"message"in o&&t(0,r=o.message),"store"in o&&i(t(1,a=o.store))},[r,a,s]}class _n extends ae{constructor(e){super(),oe(this,e,Vi,Ki,re,{message:0,store:1})}}function ps(l){let e,t,s=l[1].strings.nomessagesfound+"",n,i,r,a=l[1].totalCount>0&&bs(l);return{c(){e=h("div"),t=h("div"),n=P(s),i=j(),a&&a.c(),m(e,"class","alert alert-info")},m(o,f){M(o,e,f),_(e,t),_(t,n),_(e,i),a&&a.m(e,null)},p(o,f){f&2&&s!==(s=o[1].strings.nomessagesfound+"")&&R(n,s),o[1].totalCount>0?a?a.p(o,f):(a=bs(o),a.c(),a.m(e,null)):a&&(a.d(1),a=null)},i(o){o&&(r||Ie(()=>{r=kt(e,Pe,{delay:400}),r.start()}))},o:E,d(o){o&&y(e),a&&a.d()}}}function bs(l){let e,t=l[1].strings.showrecentmessages+"",s,n,i,r;return{c(){e=h("a"),s=P(t),m(e,"class","btn btn-info text-white mt-3"),m(e,"href",n=Oe(l[2]))},m(a,o){M(a,e,o),_(e,s),i||(r=W(e,"click",Ae(l[3])),i=!0)},p(a,o){o&2&&t!==(t=a[1].strings.showrecentmessages+"")&&R(s,t),o&4&&n!==(n=Oe(a[2]))&&m(e,"href",n)},d(a){a&&y(e),i=!1,r()}}}function Wi(l){let e,t=!l[1].listMessages.length&&ps(l);return{c(){t&&t.c(),e=_e()},m(s,n){t&&t.m(s,n),M(s,e,n)},p(s,[n]){s[1].listMessages.length?t&&(t.d(1),t=null):t?(t.p(s,n),n&2&&C(t,1)):(t=ps(s),t.c(),C(t,1),t.m(e.parentNode,e))},i(s){C(t)},o:E,d(s){s&&y(e),t&&t.d(s)}}}function Xi(l,e,t){let s,n,i=E,r=()=>(i(),i=ge(a,f=>t(1,n=f)),a);l.$$.on_destroy.push(()=>i());let{store:a}=e;r();const o=()=>a.navigate(s);return l.$$set=f=>{"store"in f&&r(t(0,a=f.store))},l.$$.update=()=>{l.$$.dirty&2&&t(2,s={tray:n.params.tray,courseid:n.params.courseid,labelid:n.params.labelid})},[a,n,s,o]}class Yi extends ae{constructor(e){super(),oe(this,e,Xi,Wi,re,{store:0})}}function hs(l,e,t){const s=l.slice();return s[4]=e[t],s[6]=t,s}function Qi(l){let e,t,s,n,i,r,a,o,f,c,u,d,g,p,b,$,w,v,S,k,T;return t=new cn({props:{store:l[0],message:l[4]}}),r=new wt({props:{store:l[0],message:l[4]}}),o=new gn({props:{store:l[0],message:l[4]}}),u=new _n({props:{store:l[0],message:l[4]}}),b=new $t({props:{store:l[0],message:l[4]}}),w=new mn({props:{store:l[0],message:l[4]}}),k=new dn({props:{store:l[0],message:l[4]}}),{c(){e=h("div"),J(t.$$.fragment),s=j(),n=h("div"),i=h("div"),J(r.$$.fragment),a=j(),J(o.$$.fragment),f=j(),c=h("div"),J(u.$$.fragment),d=j(),g=h("div"),p=h("div"),J(b.$$.fragment),$=j(),J(w.$$.fragment),v=j(),S=h("div"),J(k.$$.fragment),m(c,"class","ml-auto mr-2"),m(i,"class","d-flex mt-2"),m(p,"class","d-flex w-100 my-2 mr-2"),he(p,"min-width","0"),m(g,"class","d-flex"),m(S,"class","local-mail-list-message-labels d-flex flex-wrap mr-2 svelte-nhh0yr"),m(n,"class","w-100 ml-1"),he(n,"min-width","0"),m(e,"class","d-flex align-items-start pt-1 pb-2 pl-1 pr-2")},m(q,D){M(q,e,D),O(t,e,null),_(e,s),_(e,n),_(n,i),O(r,i,null),_(i,a),O(o,i,null),_(i,f),_(i,c),O(u,c,null),_(n,d),_(n,g),_(g,p),O(b,p,null),_(g,$),O(w,g,null),_(n,v),_(n,S),O(k,S,null),T=!0},p(q,D){const A={};D&1&&(A.store=q[0]),D&2&&(A.message=q[4]),t.$set(A);const z={};D&1&&(z.store=q[0]),D&2&&(z.message=q[4]),r.$set(z);const K={};D&1&&(K.store=q[0]),D&2&&(K.message=q[4]),o.$set(K);const G={};D&1&&(G.store=q[0]),D&2&&(G.message=q[4]),u.$set(G);const U={};D&1&&(U.store=q[0]),D&2&&(U.message=q[4]),b.$set(U);const se={};D&1&&(se.store=q[0]),D&2&&(se.message=q[4]),w.$set(se);const le={};D&1&&(le.store=q[0]),D&2&&(le.message=q[4]),k.$set(le)},i(q){T||(C(t.$$.fragment,q),C(r.$$.fragment,q),C(o.$$.fragment,q),C(u.$$.fragment,q),C(b.$$.fragment,q),C(w.$$.fragment,q),C(k.$$.fragment,q),T=!0)},o(q){L(t.$$.fragment,q),L(r.$$.fragment,q),L(o.$$.fragment,q),L(u.$$.fragment,q),L(b.$$.fragment,q),L(w.$$.fragment,q),L(k.$$.fragment,q),T=!1},d(q){q&&y(e),H(t),H(r),H(o),H(u),H(b),H(w),H(k)}}}function Zi(l){let e,t,s,n,i,r,a,o,f,c,u,d,g,p,b,$,w,v,S;return t=new cn({props:{store:l[0],message:l[4]}}),n=new mn({props:{store:l[0],message:l[4]}}),o=new wt({props:{store:l[0],message:l[4]}}),u=new $t({props:{store:l[0],message:l[4]}}),p=new dn({props:{store:l[0],message:l[4]}}),$=new gn({props:{store:l[0],message:l[4]}}),v=new _n({props:{store:l[0],message:l[4]}}),{c(){e=h("div"),J(t.$$.fragment),s=j(),J(n.$$.fragment),i=j(),r=h("div"),a=h("div"),J(o.$$.fragment),f=j(),c=h("div"),J(u.$$.fragment),d=j(),g=h("div"),J(p.$$.fragment),b=j(),J($.$$.fragment),w=j(),J(v.$$.fragment),m(a,"class","flex-grow-1 mx-2"),he(a,"width","25%"),he(a,"min-width","0"),m(g,"class","local-mail-list-message-labels-md d-flex text-truncate flex-shrink-0 justify-content-end svelte-nhh0yr"),he(g,"max-width","80%"),m(c,"class","flex-grow-1 d-flex my-2 mx-2"),he(c,"width","75%"),he(c,"min-width","0"),m(r,"class","d-flex w-100 flex-grow-1 align-items-center"),he(r,"min-width","0"),m(e,"class","d-flex align-items-center pl-1 pr-3")},m(k,T){M(k,e,T),O(t,e,null),_(e,s),O(n,e,null),_(e,i),_(e,r),_(r,a),O(o,a,null),_(r,f),_(r,c),O(u,c,null),_(c,d),_(c,g),O(p,g,null),_(e,b),O($,e,null),_(e,w),O(v,e,null),S=!0},p(k,T){const q={};T&1&&(q.store=k[0]),T&2&&(q.message=k[4]),t.$set(q);const D={};T&1&&(D.store=k[0]),T&2&&(D.message=k[4]),n.$set(D);const A={};T&1&&(A.store=k[0]),T&2&&(A.message=k[4]),o.$set(A);const z={};T&1&&(z.store=k[0]),T&2&&(z.message=k[4]),u.$set(z);const K={};T&1&&(K.store=k[0]),T&2&&(K.message=k[4]),p.$set(K);const G={};T&1&&(G.store=k[0]),T&2&&(G.message=k[4]),$.$set(G);const U={};T&1&&(U.store=k[0]),T&2&&(U.message=k[4]),v.$set(U)},i(k){S||(C(t.$$.fragment,k),C(n.$$.fragment,k),C(o.$$.fragment,k),C(u.$$.fragment,k),C(p.$$.fragment,k),C($.$$.fragment,k),C(v.$$.fragment,k),S=!0)},o(k){L(t.$$.fragment,k),L(n.$$.fragment,k),L(o.$$.fragment,k),L(u.$$.fragment,k),L(p.$$.fragment,k),L($.$$.fragment,k),L(v.$$.fragment,k),S=!1},d(k){k&&y(e),H(t),H(n),H(o),H(u),H(p),H($),H(v)}}}function ks(l,e){let t,s,n,i,r,a,o,f=E,c,u,d;const g=[Zi,Qi],p=[];function b(w,v){return w[1].viewportSize>=fe.MD?0:1}s=b(e),n=p[s]=g[s](e);function $(){return e[3](e[4],e[6])}return{key:l,first:null,c(){t=h("a"),n.c(),m(t,"class","local-mail-list-message list-group-item list-group-item-action p-0 svelte-nhh0yr"),m(t,"href",i=Oe(e[2](e[4],e[6]))),V(t,"list-group-item-primary",e[1].selectedMessages.has(e[4].id)),V(t,"list-group-item-secondary",!e[4].unread&&!e[1].selectedMessages.has(e[4].id)),V(t,"font-weight-bold",e[4].unread),this.first=t},m(w,v){M(w,t,v),p[s].m(t,null),c=!0,u||(d=W(t,"click",Ae($)),u=!0)},p(w,v){e=w;let S=s;s=b(e),s===S?p[s].p(e,v):(ne(),L(p[S],1,1,()=>{p[S]=null}),ie(),n=p[s],n?n.p(e,v):(n=p[s]=g[s](e),n.c()),C(n,1),n.m(t,null)),(!c||v&2&&i!==(i=Oe(e[2](e[4],e[6]))))&&m(t,"href",i),(!c||v&2)&&V(t,"list-group-item-primary",e[1].selectedMessages.has(e[4].id)),(!c||v&2)&&V(t,"list-group-item-secondary",!e[4].unread&&!e[1].selectedMessages.has(e[4].id)),(!c||v&2)&&V(t,"font-weight-bold",e[4].unread)},r(){o=t.getBoundingClientRect()},f(){xl(t),f(),vt(t,o)},a(){f(),f=Zl(t,o,un,{delay:400,duration:400})},i(w){c||(C(n),w&&Ie(()=>{c&&(a&&a.end(1),r=kt(t,Pe,{delay:400}),r.start())}),c=!0)},o(w){L(n),r&&r.invalidate(),w&&(a=Kl(t,Pe,{duration:400})),c=!1},d(w){w&&y(t),p[s].d(),w&&a&&a.end(),u=!1,d()}}}function vs(l){let e,t=[],s=new Map,n,i,r,a=ue(l[1].listMessages);const o=f=>f[4].id;for(let f=0;f<a.length;f+=1){let c=hs(l,a,f),u=o(c);s.set(u,t[f]=ks(u,c))}return i=new Yi({props:{store:l[0]}}),{c(){e=h("div");for(let f=0;f<t.length;f+=1)t[f].c();n=j(),J(i.$$.fragment),m(e,"class","list-group")},m(f,c){M(f,e,c);for(let u=0;u<t.length;u+=1)t[u]&&t[u].m(e,null);_(e,n),O(i,e,null),r=!0},p(f,c){if(c&7){a=ue(f[1].listMessages),ne();for(let d=0;d<t.length;d+=1)t[d].r();t=je(t,c,o,1,f,a,s,e,Jl,ks,n,hs);for(let d=0;d<t.length;d+=1)t[d].a();ie()}const u={};c&1&&(u.store=f[0]),i.$set(u)},i(f){if(!r){for(let c=0;c<a.length;c+=1)C(t[c]);C(i.$$.fragment,f),r=!0}},o(f){for(let c=0;c<t.length;c+=1)L(t[c]);L(i.$$.fragment,f),r=!1},d(f){f&&y(e);for(let c=0;c<t.length;c+=1)t[c].d();H(i)}}}function xi(l){let e=l[1].navigationId,t,s,n=vs(l);return{c(){n.c(),t=_e()},m(i,r){n.m(i,r),M(i,t,r),s=!0},p(i,[r]){r&2&&re(e,e=i[1].navigationId)?(ne(),L(n,1,1,E),ie(),n=vs(i),n.c(),C(n,1),n.m(t.parentNode,t)):n.p(i,r)},i(i){s||(C(n),s=!0)},o(i){L(n),s=!1},d(i){i&&y(t),n.d(i)}}}function er(l,e,t){let s,n=E,i=()=>(n(),n=ge(r,f=>t(1,s=f)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();const a=(f,c)=>({...s.params,messageid:f.id,offset:(s.params.offset||0)+c}),o=(f,c)=>r.navigate(a(f,c));return l.$$set=f=>{"store"in f&&i(t(0,r=f.store))},[r,s,a,o]}class tr extends ae{constructor(e){super(),oe(this,e,er,xi,re,{store:0})}}function sr(l,e,t){let{javascript:s}=e,n;const i=async r=>{const a=await gt("core/fragment");n==null||n.remove(),n=void 0,await nt(),n=document.createElement("script"),n.setAttribute("type","text/javascript"),n.innerHTML=a.processCollectedJavascript(r),document.head.append(n)};return ht(()=>{n==null||n.remove()}),l.$$set=r=>{"javascript"in r&&t(0,s=r.javascript)},l.$$.update=()=>{l.$$.dirty&1&&i(s||"")},[s]}class pn extends ae{constructor(e){super(),oe(this,e,sr,null,re,{javascript:0})}}function ws(l){let e,t,s,n,i,r,a,o=l[3]&&$s(l);return{c(){e=h("div"),t=h("button"),s=h("i"),i=j(),o&&o.c(),m(s,"class","fa fa-fw fa-ellipsis-v align-middle"),m(t,"type","button"),m(t,"class","btn"),m(t,"aria-expanded",l[3]),m(t,"title",n=l[5].strings.more),m(e,"class","dropdown")},m(f,c){M(f,e,c),_(e,t),_(t,s),_(e,i),o&&o.m(e,null),r||(a=[W(t,"click",l[6]),ze(it.call(null,e,l[7]))],r=!0)},p(f,c){c&8&&m(t,"aria-expanded",f[3]),c&32&&n!==(n=f[5].strings.more)&&m(t,"title",n),f[3]?o?o.p(f,c):(o=$s(f),o.c(),o.m(e,null)):o&&(o.d(1),o=null)},d(f){f&&y(e),o&&o.d(),r=!1,Me(a)}}}function $s(l){let e,t,s,n,i=l[5].strings.reply+"",r,a,o,f,c,u=l[5].strings.replyall+"",d,g,p,b,$,w,v=l[5].strings.forward+"",S,k,T;return{c(){e=h("div"),t=h("button"),s=h("i"),n=j(),r=P(i),a=j(),o=h("button"),f=h("i"),c=j(),d=P(u),p=j(),b=h("button"),$=h("i"),w=j(),S=P(v),m(s,"class","fa fa-fw fa-reply"),m(s,"aria-hidden","true"),m(t,"type","button"),m(t,"class","dropdown-item"),m(f,"class","fa fa-fw fa-reply-all"),m(f,"aria-hidden","true"),m(o,"type","button"),o.disabled=g=!l[2],m(o,"class","dropdown-item"),V(o,"disabled",!l[2]),m($,"class","fa fa-fw fa-share"),m($,"aria-hidden","true"),m(b,"type","button"),m(b,"class","dropdown-item"),m(e,"class","dropdown-menu dropdown-menu-right show")},m(q,D){M(q,e,D),_(e,t),_(t,s),_(t,n),_(t,r),_(e,a),_(e,o),_(o,f),_(o,c),_(o,d),_(e,p),_(e,b),_(b,$),_(b,w),_(b,S),k||(T=[W(t,"click",l[9]),W(o,"click",l[10]),W(b,"click",l[11])],k=!0)},p(q,D){D&32&&i!==(i=q[5].strings.reply+"")&&R(r,i),D&32&&u!==(u=q[5].strings.replyall+"")&&R(d,u),D&4&&g!==(g=!q[2])&&(o.disabled=g),D&4&&V(o,"disabled",!q[2]),D&32&&v!==(v=q[5].strings.forward+"")&&R(S,v)},d(q){q&&y(e),k=!1,Me(T)}}}function ys(l){let e,t,s,n,i,r,a,o,f,c,u,d,g,p;return{c(){e=h("button"),t=h("i"),n=j(),i=h("button"),r=h("i"),f=j(),c=h("button"),u=h("i"),m(t,"class","fa fa-fw fa-reply"),m(t,"aria-hidden","true"),m(e,"type","button"),m(e,"title",s=l[5].strings.reply),m(e,"class","btn py-2 border-0"),m(r,"class","fa fa-fw fa-reply-all"),m(r,"aria-hidden","true"),m(i,"type","button"),i.disabled=a=!l[2],m(i,"title",o=l[5].strings.replyall),m(i,"class","btn py-2 border-0"),V(i,"disabled",!l[2]),m(u,"class","fa fa-fw fa-share"),m(u,"aria-hidden","true"),m(c,"type","button"),m(c,"title",d=l[5].strings.forward),m(c,"class","btn py-2 border-0")},m(b,$){M(b,e,$),_(e,t),M(b,n,$),M(b,i,$),_(i,r),M(b,f,$),M(b,c,$),_(c,u),g||(p=[W(e,"click",l[12]),W(i,"click",l[13]),W(c,"click",l[14])],g=!0)},p(b,$){$&32&&s!==(s=b[5].strings.reply)&&m(e,"title",s),$&4&&a!==(a=!b[2])&&(i.disabled=a),$&32&&o!==(o=b[5].strings.replyall)&&m(i,"title",o),$&4&&V(i,"disabled",!b[2]),$&32&&d!==(d=b[5].strings.forward)&&m(c,"title",d)},d(b){b&&(y(e),y(n),y(i),y(f),y(c)),g=!1,Me(p)}}}function lr(l){let e,t,s,n,i,r,a,o,f,c,u,d=l[5].viewportSize<fe.SM&&ws(l),g=l[5].viewportSize>=fe.SM&&ys(l);return{c(){e=h("button"),t=h("i"),a=j(),d&&d.c(),o=j(),g&&g.c(),f=_e(),m(t,"class",s="fa "+l[4]),m(e,"type","button"),m(e,"class","btn py-2 border-0"),m(e,"role","checkbox"),m(e,"aria-checked",n=l[1].starred),e.disabled=i=l[1].deleted,m(e,"title",r=l[1].starred?l[5].strings.markasunstarred:l[5].strings.markasstarred)},m(p,b){M(p,e,b),_(e,t),M(p,a,b),d&&d.m(p,b),M(p,o,b),g&&g.m(p,b),M(p,f,b),c||(u=W(e,"click",l[8]),c=!0)},p(p,[b]){b&16&&s!==(s="fa "+p[4])&&m(t,"class",s),b&2&&n!==(n=p[1].starred)&&m(e,"aria-checked",n),b&2&&i!==(i=p[1].deleted)&&(e.disabled=i),b&34&&r!==(r=p[1].starred?p[5].strings.markasunstarred:p[5].strings.markasstarred)&&m(e,"title",r),p[5].viewportSize<fe.SM?d?d.p(p,b):(d=ws(p),d.c(),d.m(o.parentNode,o)):d&&(d.d(1),d=null),p[5].viewportSize>=fe.SM?g?g.p(p,b):(g=ys(p),g.c(),g.m(f.parentNode,f)):g&&(g.d(1),g=null)},i:E,o:E,d(p){p&&(y(e),y(a),y(o),y(f)),d&&d.d(p),g&&g.d(p),c=!1,u()}}}function nr(l,e,t){let s,n,i=E,r=()=>(i(),i=ge(a,k=>t(5,n=k)),a);l.$$.on_destroy.push(()=>i());let{store:a}=e;r();let{message:o}=e,{canReplyAll:f}=e,c=!1;const u=()=>{t(3,c=!c)},d=()=>{t(3,c=!1)},g=()=>a.setStarred([o.id],!o.starred),p=()=>a.reply(o,!1),b=()=>a.reply(o,!0),$=()=>a.forward(o),w=()=>a.reply(o,!1),v=()=>a.reply(o,!0),S=()=>a.forward(o);return l.$$set=k=>{"store"in k&&r(t(0,a=k.store)),"message"in k&&t(1,o=k.message),"canReplyAll"in k&&t(2,f=k.canReplyAll)},l.$$.update=()=>{l.$$.dirty&2&&t(4,s=o.starred?"fa-star text-warning":"fa-star-o")},[a,o,f,c,s,n,u,d,g,p,b,$,w,v,S]}class ir extends ae{constructor(e){super(),oe(this,e,nr,lr,re,{store:0,message:1,canReplyAll:2})}}function Ms(l,e,t){const s=l.slice();return s[3]=e[t],s}function Cs(l){let e,t,s,n,i,r,a,o,f,c=l[2](l[3])+"",u,d,g,p,b=zt(l[3].filesize)+"",$,w,v,S;return{c(){e=h("a"),t=h("img"),i=j(),r=h("i"),a=j(),o=h("div"),f=h("div"),u=P(c),g=j(),p=h("div"),$=P(b),m(t,"aria-hidden","true"),m(t,"alt",s=l[3].filename),ut(t.src,n=l[3].iconurl)||m(t,"src",n),m(t,"width","24"),m(t,"height","24"),m(t,"class","flex-shrink-0 svelte-1ktidv1"),m(r,"class","fa fa-download d-flex justify-content-center align-items-center flex-shrink-0 svelte-1ktidv1"),m(r,"aria-hidden","true"),he(r,"width","24px"),he(r,"height","24px"),m(p,"class","text-left text-muted"),m(o,"class","ml-2 mr-1"),he(o,"min-width","0"),m(e,"href",w=l[3].fileurl),m(e,"class","local-mail-message-attachments-file btn btn-light d-flex align-items-center px-2 py-1 mr-3 mb-3 svelte-1ktidv1")},m(k,T){M(k,e,T),_(e,t),_(e,i),_(e,r),_(e,a),_(e,o),_(o,f),_(f,u),_(o,g),_(o,p),_(p,$),v||(S=ze(d=We.call(null,f,l[2](l[3]))),v=!0)},p(k,T){l=k,T&2&&s!==(s=l[3].filename)&&m(t,"alt",s),T&2&&!ut(t.src,n=l[3].iconurl)&&m(t,"src",n),T&2&&c!==(c=l[2](l[3])+"")&&R(u,c),d&&De(d.update)&&T&2&&d.update.call(null,l[2](l[3])),T&2&&b!==(b=zt(l[3].filesize)+"")&&R($,b),T&2&&w!==(w=l[3].fileurl)&&m(e,"href",w)},d(k){k&&y(e),v=!1,S()}}}function Ss(l){let e,t,s,n,i=l[0].downloadall+"",r,a;return{c(){e=h("a"),t=h("i"),s=j(),n=h("div"),r=P(i),m(t,"class","fa fa-download d-flex justify-content-center align-items-center flex-shrink-0"),m(t,"aria-hidden","true"),he(t,"width","24px"),he(t,"height","24px"),m(n,"class","text-truncate ml-2"),m(e,"href",a=Nt(l[1].id)),m(e,"class","btn btn-light d-flex align-items-center p-2 mr-3 mb-3 svelte-1ktidv1")},m(o,f){M(o,e,f),_(e,t),_(e,s),_(e,n),_(n,r)},p(o,f){f&1&&i!==(i=o[0].downloadall+"")&&R(r,i),f&2&&a!==(a=Nt(o[1].id))&&m(e,"href",a)},d(o){o&&y(e)}}}function rr(l){let e,t,s=ue(l[1].attachments),n=[];for(let r=0;r<s.length;r+=1)n[r]=Cs(Ms(l,s,r));let i=l[1].attachments.length>1&&Ss(l);return{c(){e=h("div");for(let r=0;r<n.length;r+=1)n[r].c();t=j(),i&&i.c(),m(e,"class","local-mail-message-attachments d-sm-flex flex-wrap svelte-1ktidv1")},m(r,a){M(r,e,a);for(let o=0;o<n.length;o+=1)n[o]&&n[o].m(e,null);_(e,t),i&&i.m(e,null)},p(r,[a]){if(a&6){s=ue(r[1].attachments);let o;for(o=0;o<s.length;o+=1){const f=Ms(r,s,o);n[o]?n[o].p(f,a):(n[o]=Cs(f),n[o].c(),n[o].m(e,t))}for(;o<n.length;o+=1)n[o].d(1);n.length=s.length}r[1].attachments.length>1?i?i.p(r,a):(i=Ss(r),i.c(),i.m(e,null)):i&&(i.d(1),i=null)},i:E,o:E,d(r){r&&y(e),Ee(n,r),i&&i.d()}}}function ar(l,e,t){let{strings:s}=e,{message:n}=e;const i=r=>(r.filepath+r.filename).replace(/^\//,"");return l.$$set=r=>{"strings"in r&&t(0,s=r.strings),"message"in r&&t(1,n=r.message)},[s,n,i]}class bn extends ae{constructor(e){super(),oe(this,e,ar,rr,re,{strings:0,message:1})}}function or(l){let e,t,s,n=l[3].strings.reply+"",i,r,a,o,f,c=l[3].strings.replyall+"",u,d,g,p,b,$,w=l[3].strings.forward+"",v,S,k;return{c(){e=h("button"),t=h("i"),s=j(),i=P(n),r=j(),a=h("button"),o=h("i"),f=j(),u=P(c),g=j(),p=h("button"),b=h("i"),$=j(),v=P(w),m(t,"class","fa fa-fw fa-reply mr-2"),m(e,"type","button"),m(e,"class","btn btn-primary mr-3 mb-3"),m(o,"class","fa fa-fw fa-reply-all mr-2"),m(a,"type","button"),a.disabled=d=!l[2],m(a,"class","btn mr-3 mb-3"),V(a,"disabled",!l[2]),V(a,"btn-primary",l[2]),V(a,"btn-secondary",!l[2]),m(b,"class","fa fa-fw fa-share mr-2"),m(p,"type","button"),m(p,"class","btn btn-primary mr-3 mb-3")},m(T,q){M(T,e,q),_(e,t),_(e,s),_(e,i),M(T,r,q),M(T,a,q),_(a,o),_(a,f),_(a,u),M(T,g,q),M(T,p,q),_(p,b),_(p,$),_(p,v),S||(k=[W(e,"click",l[4]),W(a,"click",l[5]),W(p,"click",l[6])],S=!0)},p(T,[q]){q&8&&n!==(n=T[3].strings.reply+"")&&R(i,n),q&8&&c!==(c=T[3].strings.replyall+"")&&R(u,c),q&4&&d!==(d=!T[2])&&(a.disabled=d),q&4&&V(a,"disabled",!T[2]),q&4&&V(a,"btn-primary",T[2]),q&4&&V(a,"btn-secondary",!T[2]),q&8&&w!==(w=T[3].strings.forward+"")&&R(v,w)},i:E,o:E,d(T){T&&(y(e),y(r),y(a),y(g),y(p)),S=!1,Me(k)}}}function fr(l,e,t){let s,n=E,i=()=>(n(),n=ge(r,d=>t(3,s=d)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{message:a}=e,{canReplyAll:o}=e;const f=()=>r.reply(a,!1),c=()=>r.reply(a,!0),u=()=>r.forward(a);return l.$$set=d=>{"store"in d&&i(t(0,r=d.store)),"message"in d&&t(1,a=d.message),"canReplyAll"in d&&t(2,o=d.canReplyAll)},[r,a,o,s,f,c,u]}class ur extends ae{constructor(e){super(),oe(this,e,fr,or,re,{store:0,message:1,canReplyAll:2})}}function cr(l){let e;return{c(){e=h("div"),m(e,"class","local-mail-message-content svelte-18ecame")},m(t,s){M(t,e,s),e.innerHTML=l[0],l[2](e)},p(t,[s]){s&1&&(e.innerHTML=t[0])},i:E,o:E,d(t){t&&y(e),l[2](null)}}}function mr(l,e,t){let{content:s}=e,n;Vl(async()=>{(await gt("core_filters/events")).notifyFilterContentUpdated([n])});function i(r){Se[r?"unshift":"push"](()=>{n=r,t(1,n)})}return l.$$set=r=>{"content"in r&&t(0,s=r.content)},[s,n,i]}class hn extends ae{constructor(e){super(),oe(this,e,mr,cr,re,{content:0})}}function Ds(l,e,t){const s=l.slice();return s[3]=e[t],s}function Ts(l){let e,t;return e=new yt({props:{course:l[1].course,settings:l[2].settings}}),{c(){J(e.$$.fragment)},m(s,n){O(e,s,n),t=!0},p(s,n){const i={};n&2&&(i.course=s[1].course),n&4&&(i.settings=s[2].settings),e.$set(i)},i(s){t||(C(e.$$.fragment,s),t=!0)},o(s){L(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function Ls(l,e){let t,s,n;return s=new Mt({props:{label:e[3]}}),{key:l,first:null,c(){t=_e(),J(s.$$.fragment),this.first=t},m(i,r){M(i,t,r),O(s,i,r),n=!0},p(i,r){e=i;const a={};r&2&&(a.label=e[3]),s.$set(a)},i(i){n||(C(s.$$.fragment,i),n=!0)},o(i){L(s.$$.fragment,i),n=!1},d(i){i&&y(t),H(s,i)}}}function dr(l){let e,t=[],s=new Map,n,i,r=l[1].course.id!=l[2].params.courseid&&Ts(l),a=ue(l[1].labels);const o=f=>f[3].id;for(let f=0;f<a.length;f+=1){let c=Ds(l,a,f),u=o(c);s.set(u,t[f]=Ls(u,c))}return{c(){r&&r.c(),e=j();for(let f=0;f<t.length;f+=1)t[f].c();n=_e()},m(f,c){r&&r.m(f,c),M(f,e,c);for(let u=0;u<t.length;u+=1)t[u]&&t[u].m(f,c);M(f,n,c),i=!0},p(f,[c]){f[1].course.id!=f[2].params.courseid?r?(r.p(f,c),c&6&&C(r,1)):(r=Ts(f),r.c(),C(r,1),r.m(e.parentNode,e)):r&&(ne(),L(r,1,1,()=>{r=null}),ie()),c&2&&(a=ue(f[1].labels),ne(),t=je(t,c,o,1,f,a,s,n.parentNode,Je,Ls,n,Ds),ie())},i(f){if(!i){C(r);for(let c=0;c<a.length;c+=1)C(t[c]);i=!0}},o(f){L(r);for(let c=0;c<t.length;c+=1)L(t[c]);i=!1},d(f){f&&(y(e),y(n)),r&&r.d(f);for(let c=0;c<t.length;c+=1)t[c].d(f)}}}function gr(l,e,t){let s,n=E,i=()=>(n(),n=ge(r,o=>t(2,s=o)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{message:a}=e;return l.$$set=o=>{"store"in o&&i(t(0,r=o.store)),"message"in o&&t(1,a=o.message)},[r,a,s]}class _r extends ae{constructor(e){super(),oe(this,e,gr,dr,re,{store:0,message:1})}}function pr(l){let e,t=l[0].fullname+"",s;return{c(){e=h("span"),s=P(t)},m(n,i){M(n,e,i),_(e,s)},p(n,i){i&1&&t!==(t=n[0].fullname+"")&&R(s,t)},d(n){n&&y(e)}}}function br(l){let e,t=l[0].fullname+"",s,n;return{c(){e=h("a"),s=P(t),m(e,"href",n=l[0].profileurl)},m(i,r){M(i,e,r),_(e,s)},p(i,r){r&1&&t!==(t=i[0].fullname+"")&&R(s,t),r&1&&n!==(n=i[0].profileurl)&&m(e,"href",n)},d(i){i&&y(e)}}}function hr(l){let e;function t(i,r){return i[0].profileurl?br:pr}let s=t(l),n=s(l);return{c(){n.c(),e=_e()},m(i,r){n.m(i,r),M(i,e,r)},p(i,[r]){s===(s=t(i))&&n?n.p(i,r):(n.d(1),n=s(i),n&&(n.c(),n.m(e.parentNode,e)))},i:E,o:E,d(i){i&&y(e),n.d(i)}}}function kr(l,e,t){let{user:s}=e;return l.$$set=n=>{"user"in n&&t(0,s=n.user)},[s]}class Ct extends ae{constructor(e){super(),oe(this,e,kr,hr,re,{user:0})}}function vr(l){let e;function t(i,r){var a,o;return(a=i[0])!=null&&a.firstname||(o=i[0])!=null&&o.lastname?yr:$r}let s=t(l),n=s(l);return{c(){e=h("span"),n.c(),m(e,"class","local-mail-user-picture-fallback m-0 svelte-1ebin1")},m(i,r){M(i,e,r),n.m(e,null)},p(i,r){s===(s=t(i))&&n?n.p(i,r):(n.d(1),n=s(i),n&&(n.c(),n.m(e,null)))},d(i){i&&y(e),n.d()}}}function wr(l){let e,t;return{c(){e=h("img"),ut(e.src,t=l[0].pictureurl)||m(e,"src",t),m(e,"width","35"),m(e,"height","35"),m(e,"alt",""),m(e,"aria-hidden","true"),m(e,"class","rounded-circle")},m(s,n){M(s,e,n)},p(s,n){n&1&&!ut(e.src,t=s[0].pictureurl)&&m(e,"src",t)},d(s){s&&y(e)}}}function $r(l){let e,t;return{c(){e=h("i"),m(e,"class",t="fa "+l[1]+" svelte-1ebin1")},m(s,n){M(s,e,n)},p(s,n){n&2&&t!==(t="fa "+s[1]+" svelte-1ebin1")&&m(e,"class",t)},d(s){s&&y(e)}}}function yr(l){let e=l[0].firstname.slice(0,1)+"",t,s=l[0].lastname.slice(0,1)+"",n;return{c(){t=P(e),n=P(s)},m(i,r){M(i,t,r),M(i,n,r)},p(i,r){r&1&&e!==(e=i[0].firstname.slice(0,1)+"")&&R(t,e),r&1&&s!==(s=i[0].lastname.slice(0,1)+"")&&R(n,s)},d(i){i&&(y(t),y(n))}}}function Mr(l){let e;function t(i,r){var a;return(a=i[0])!=null&&a.pictureurl?wr:vr}let s=t(l),n=s(l);return{c(){n.c(),e=_e()},m(i,r){n.m(i,r),M(i,e,r)},p(i,[r]){s===(s=t(i))&&n?n.p(i,r):(n.d(1),n=s(i),n&&(n.c(),n.m(e.parentNode,e)))},i:E,o:E,d(i){i&&y(e),n.d(i)}}}function Cr(l,e,t){let{user:s=void 0}=e,{icon:n="fa-user"}=e;return l.$$set=i=>{"user"in i&&t(0,s=i.user),"icon"in i&&t(1,n=i.icon)},[s,n]}class at extends ae{constructor(e){super(),oe(this,e,Cr,Mr,re,{user:0,icon:1})}}function js(l){let e,t,s,n;return s=new bn({props:{strings:l[0],message:l[1]}}),{c(){e=h("hr"),t=j(),J(s.$$.fragment)},m(i,r){M(i,e,r),M(i,t,r),O(s,i,r),n=!0},p(i,r){const a={};r&1&&(a.strings=i[0]),r&2&&(a.message=i[1]),s.$set(a)},i(i){n||(C(s.$$.fragment,i),n=!0)},o(i){L(s.$$.fragment,i),n=!1},d(i){i&&(y(e),y(t)),H(s,i)}}}function Sr(l){let e,t,s,n=l[1].subject+"",i,r,a,o,f,c,u,d,g,p,b,$=l[1].fulltime+"",w,v,S,k,T,q,D;c=new at({props:{user:l[1].sender}}),g=new Ct({props:{user:l[1].sender}}),T=new hn({props:{content:l[1].content}});let A=l[1].attachments.length>0&&js(l);return{c(){e=h("div"),t=h("div"),s=h("h5"),i=P(n),r=j(),a=h("div"),o=h("div"),f=h("div"),J(c.$$.fragment),u=j(),d=h("div"),J(g.$$.fragment),p=j(),b=h("div"),w=P($),v=j(),S=h("hr"),k=j(),J(T.$$.fragment),q=j(),A&&A.c(),m(s,"class","h5 card-title mb-3"),m(f,"class","mr-3"),m(d,"class","mt-1"),m(o,"class","d-flex mb-3 mb-sm-0"),m(b,"class","mt-1 ml-auto"),m(a,"class","local-mail-message-reference-user-and-date d-sm-flex svelte-piiclw"),m(t,"class","card-body p-3 px-xl-4"),m(e,"class","card mb-4")},m(z,K){M(z,e,K),_(e,t),_(t,s),_(s,i),_(t,r),_(t,a),_(a,o),_(o,f),O(c,f,null),_(o,u),_(o,d),O(g,d,null),_(a,p),_(a,b),_(b,w),_(t,v),_(t,S),_(t,k),O(T,t,null),_(t,q),A&&A.m(t,null),D=!0},p(z,[K]){(!D||K&2)&&n!==(n=z[1].subject+"")&&R(i,n);const G={};K&2&&(G.user=z[1].sender),c.$set(G);const U={};K&2&&(U.user=z[1].sender),g.$set(U),(!D||K&2)&&$!==($=z[1].fulltime+"")&&R(w,$);const se={};K&2&&(se.content=z[1].content),T.$set(se),z[1].attachments.length>0?A?(A.p(z,K),K&2&&C(A,1)):(A=js(z),A.c(),C(A,1),A.m(t,null)):A&&(ne(),L(A,1,1,()=>{A=null}),ie())},i(z){D||(C(c.$$.fragment,z),C(g.$$.fragment,z),C(T.$$.fragment,z),C(A),D=!0)},o(z){L(c.$$.fragment,z),L(g.$$.fragment,z),L(T.$$.fragment,z),L(A),D=!1},d(z){z&&y(e),H(c),H(g),H(T),A&&A.d()}}}function Dr(l,e,t){let{strings:s}=e,{reference:n}=e;return l.$$set=i=>{"strings"in i&&t(0,s=i.strings),"reference"in i&&t(1,n=i.reference)},[s,n]}class kn extends ae{constructor(e){super(),oe(this,e,Dr,Sr,re,{strings:0,reference:1})}}function zs(l,e,t){const s=l.slice();return s[4]=e[t],s}function Ns(l,e,t){const s=l.slice();return s[7]=e[t],s[9]=t,s}function qs(l){let e,t,s=l[3].strings[l[4]]+"",n,i,r,a=[],o=new Map,f,c,u=ue(l[2](l[4]));const d=g=>g[7].id;for(let g=0;g<u.length;g+=1){let p=Ns(l,u,g),b=d(p);o.set(b,a[g]=As(b,p))}return{c(){e=h("div"),t=h("span"),n=P(s),i=P(":"),r=j();for(let g=0;g<a.length;g+=1)a[g].c();f=j(),m(e,"class","mb-2")},m(g,p){M(g,e,p),_(e,t),_(t,n),_(t,i),_(e,r);for(let b=0;b<a.length;b+=1)a[b]&&a[b].m(e,null);_(e,f),c=!0},p(g,p){(!c||p&8)&&s!==(s=g[3].strings[g[4]]+"")&&R(n,s),p&4&&(u=ue(g[2](g[4])),ne(),a=je(a,p,d,1,g,u,o,e,Je,As,f,Ns),ie())},i(g){if(!c){for(let p=0;p<u.length;p+=1)C(a[p]);c=!0}},o(g){for(let p=0;p<a.length;p+=1)L(a[p]);c=!1},d(g){g&&y(e);for(let p=0;p<a.length;p+=1)a[p].d()}}}function Is(l){let e;return{c(){e=P(",")},m(t,s){M(t,e,s)},d(t){t&&y(e)}}}function As(l,e){let t,s,n,i,r=e[9]>0&&Is();return n=new Ct({props:{user:e[7]}}),{key:l,first:null,c(){t=_e(),r&&r.c(),s=j(),J(n.$$.fragment),this.first=t},m(a,o){M(a,t,o),r&&r.m(a,o),M(a,s,o),O(n,a,o),i=!0},p(a,o){e=a,e[9]>0?r||(r=Is(),r.c(),r.m(s.parentNode,s)):r&&(r.d(1),r=null);const f={};o&4&&(f.user=e[7]),n.$set(f)},i(a){i||(C(n.$$.fragment,a),i=!0)},o(a){L(n.$$.fragment,a),i=!1},d(a){a&&(y(t),y(s)),r&&r.d(a),H(n,a)}}}function Bs(l){let e=l[2](l[4]).length>0,t,s,n=e&&qs(l);return{c(){n&&n.c(),t=_e()},m(i,r){n&&n.m(i,r),M(i,t,r),s=!0},p(i,r){r&4&&(e=i[2](i[4]).length>0),e?n?(n.p(i,r),r&4&&C(n,1)):(n=qs(i),n.c(),C(n,1),n.m(t.parentNode,t)):n&&(ne(),L(n,1,1,()=>{n=null}),ie())},i(i){s||(C(n),s=!0)},o(i){L(n),s=!1},d(i){i&&y(t),n&&n.d(i)}}}function Tr(l){let e,t,s,n,i,r,a,o,f;s=new at({props:{user:l[1].sender}}),a=new Ct({props:{user:l[1].sender}});let c=ue(Object.values(Be)),u=[];for(let g=0;g<c.length;g+=1)u[g]=Bs(zs(l,c,g));const d=g=>L(u[g],1,1,()=>{u[g]=null});return{c(){e=h("div"),t=h("div"),J(s.$$.fragment),n=j(),i=h("div"),r=h("div"),J(a.$$.fragment),o=j();for(let g=0;g<u.length;g+=1)u[g].c();m(t,"class","mr-3"),m(r,"class","mt-1 mb-2"),m(i,"class","d-flex flex-column"),m(e,"class","local-mail-message-users d-flex svelte-18jlkm0")},m(g,p){M(g,e,p),_(e,t),O(s,t,null),_(e,n),_(e,i),_(i,r),O(a,r,null),_(i,o);for(let b=0;b<u.length;b+=1)u[b]&&u[b].m(i,null);f=!0},p(g,[p]){const b={};p&2&&(b.user=g[1].sender),s.$set(b);const $={};if(p&2&&($.user=g[1].sender),a.$set($),p&12){c=ue(Object.values(Be));let w;for(w=0;w<c.length;w+=1){const v=zs(g,c,w);u[w]?(u[w].p(v,p),C(u[w],1)):(u[w]=Bs(v),u[w].c(),C(u[w],1),u[w].m(i,null))}for(ne(),w=c.length;w<u.length;w+=1)d(w);ie()}},i(g){if(!f){C(s.$$.fragment,g),C(a.$$.fragment,g);for(let p=0;p<c.length;p+=1)C(u[p]);f=!0}},o(g){L(s.$$.fragment,g),L(a.$$.fragment,g),u=u.filter(Boolean);for(let p=0;p<u.length;p+=1)L(u[p]);f=!1},d(g){g&&y(e),H(s),H(a),Ee(u,g)}}}function Lr(l,e,t){let s,n,i=E,r=()=>(i(),i=ge(a,f=>t(3,n=f)),a);l.$$.on_destroy.push(()=>i());let{store:a}=e;r();let{message:o}=e;return l.$$set=f=>{"store"in f&&r(t(0,a=f.store)),"message"in f&&t(1,o=f.message)},l.$$.update=()=>{l.$$.dirty&2&&t(2,s=f=>o.recipients.filter(c=>c.type==f))},[a,o,s,n]}class jr extends ae{constructor(e){super(),oe(this,e,Lr,Tr,re,{store:0,message:1})}}function Ps(l,e,t){const s=l.slice();return s[4]=e[t],s}function Es(l){let e,t,s,n;return s=new bn({props:{strings:l[2].strings,message:l[1]}}),{c(){e=h("hr"),t=j(),J(s.$$.fragment)},m(i,r){M(i,e,r),M(i,t,r),O(s,i,r),n=!0},p(i,r){const a={};r&4&&(a.strings=i[2].strings),r&2&&(a.message=i[1]),s.$set(a)},i(i){n||(C(s.$$.fragment,i),n=!0)},o(i){L(s.$$.fragment,i),n=!1},d(i){i&&(y(e),y(t)),H(s,i)}}}function Rs(l){let e,t=l[2].strings.references+"",s,n,i=[],r=new Map,a,o,f=ue(l[1].references);const c=u=>u[4].id;for(let u=0;u<f.length;u+=1){let d=Ps(l,f,u),g=c(d);r.set(g,i[u]=Fs(g,d))}return{c(){e=h("div"),s=P(t),n=j();for(let u=0;u<i.length;u+=1)i[u].c();a=_e(),m(e,"class","alert alert-secondary mt-4 mb-4 text-center")},m(u,d){M(u,e,d),_(e,s),M(u,n,d);for(let g=0;g<i.length;g+=1)i[g]&&i[g].m(u,d);M(u,a,d),o=!0},p(u,d){(!o||d&4)&&t!==(t=u[2].strings.references+"")&&R(s,t),d&6&&(f=ue(u[1].references),ne(),i=je(i,d,c,1,u,f,r,a.parentNode,Je,Fs,a,Ps),ie())},i(u){if(!o){for(let d=0;d<f.length;d+=1)C(i[d]);o=!0}},o(u){for(let d=0;d<i.length;d+=1)L(i[d]);o=!1},d(u){u&&(y(e),y(n),y(a));for(let d=0;d<i.length;d+=1)i[d].d(u)}}}function Fs(l,e){let t,s,n;return s=new kn({props:{strings:e[2].strings,reference:e[4]}}),{key:l,first:null,c(){t=_e(),J(s.$$.fragment),this.first=t},m(i,r){M(i,t,r),O(s,i,r),n=!0},p(i,r){e=i;const a={};r&4&&(a.strings=e[2].strings),r&2&&(a.reference=e[4]),s.$set(a)},i(i){n||(C(s.$$.fragment,i),n=!0)},o(i){L(s.$$.fragment,i),n=!1},d(i){i&&y(t),H(s,i)}}}function zr(l){let e,t,s,n,i,r=l[1].subject+"",a,o,f,c,u,d,g,p,b=l[1].fulltime+"",$,w,v,S,k,T,q,D,A,z,K,G,U,se,le,Q,ee,F,te;e=new pn({props:{javascript:l[1].javascript}}),u=new _r({props:{store:l[0],message:l[1]}}),S=new ir({props:{store:l[0],message:l[1],canReplyAll:l[3]}}),T=new jr({props:{store:l[0],message:l[1]}}),z=new hn({props:{content:l[1].content}});let x=l[1].attachments.length>0&&Es(l);Q=new ur({props:{store:l[0],message:l[1],canReplyAll:l[3]}});let I=l[1].references.length>0&&Rs(l);return{c(){J(e.$$.fragment),t=j(),s=h("div"),n=h("div"),i=h("h3"),a=P(r),o=j(),f=h("div"),c=h("div"),J(u.$$.fragment),d=j(),g=h("div"),p=h("div"),$=P(b),w=j(),v=h("div"),J(S.$$.fragment),k=j(),J(T.$$.fragment),q=j(),D=h("hr"),A=j(),J(z.$$.fragment),K=j(),x&&x.c(),G=j(),U=h("hr"),se=j(),le=h("div"),J(Q.$$.fragment),ee=j(),I&&I.c(),F=_e(),m(i,"class","h4 card-title mb-3 mb-md-2"),m(c,"class","local-mail-message-labels d-flex flex-wrap svelte-8213ss"),he(c,"min-width","0"),m(p,"class","my-2 text-truncate"),m(v,"class","local-mail-message-actions d-flex flex-shrink-0 svelte-8213ss"),m(g,"class","d-flex justify-content-between flex-shrink-0 ml-auto"),m(f,"class","d-md-flex align-items-start mb-2"),m(le,"class","local-mail-message-buttons d-flex flex-column flex-sm-row justify-content-end svelte-8213ss"),m(n,"class","card-body p-3 px-xl-4"),m(s,"class","card")},m(N,X){O(e,N,X),M(N,t,X),M(N,s,X),_(s,n),_(n,i),_(i,a),_(n,o),_(n,f),_(f,c),O(u,c,null),_(f,d),_(f,g),_(g,p),_(p,$),_(g,w),_(g,v),O(S,v,null),_(n,k),O(T,n,null),_(n,q),_(n,D),_(n,A),O(z,n,null),_(n,K),x&&x.m(n,null),_(n,G),_(n,U),_(n,se),_(n,le),O(Q,le,null),M(N,ee,X),I&&I.m(N,X),M(N,F,X),te=!0},p(N,[X]){const B={};X&2&&(B.javascript=N[1].javascript),e.$set(B),(!te||X&2)&&r!==(r=N[1].subject+"")&&R(a,r);const de={};X&1&&(de.store=N[0]),X&2&&(de.message=N[1]),u.$set(de),(!te||X&2)&&b!==(b=N[1].fulltime+"")&&R($,b);const Z={};X&1&&(Z.store=N[0]),X&2&&(Z.message=N[1]),X&8&&(Z.canReplyAll=N[3]),S.$set(Z);const ke={};X&1&&(ke.store=N[0]),X&2&&(ke.message=N[1]),T.$set(ke);const we={};X&2&&(we.content=N[1].content),z.$set(we),N[1].attachments.length>0?x?(x.p(N,X),X&2&&C(x,1)):(x=Es(N),x.c(),C(x,1),x.m(n,G)):x&&(ne(),L(x,1,1,()=>{x=null}),ie());const ve={};X&1&&(ve.store=N[0]),X&2&&(ve.message=N[1]),X&8&&(ve.canReplyAll=N[3]),Q.$set(ve),N[1].references.length>0?I?(I.p(N,X),X&2&&C(I,1)):(I=Rs(N),I.c(),C(I,1),I.m(F.parentNode,F)):I&&(ne(),L(I,1,1,()=>{I=null}),ie())},i(N){te||(C(e.$$.fragment,N),C(u.$$.fragment,N),C(S.$$.fragment,N),C(T.$$.fragment,N),C(z.$$.fragment,N),C(x),C(Q.$$.fragment,N),C(I),te=!0)},o(N){L(e.$$.fragment,N),L(u.$$.fragment,N),L(S.$$.fragment,N),L(T.$$.fragment,N),L(z.$$.fragment,N),L(x),L(Q.$$.fragment,N),L(I),te=!1},d(N){N&&(y(t),y(s),y(ee),y(F)),H(e,N),H(u),H(S),H(T),H(z),x&&x.d(),H(Q),I&&I.d(N)}}}function Nr(l,e,t){let s,n,i=E,r=()=>(i(),i=ge(a,f=>t(2,n=f)),a);l.$$.on_destroy.push(()=>i());let{store:a}=e;r();let{message:o}=e;return l.$$set=f=>{"store"in f&&r(t(0,a=f.store)),"message"in f&&t(1,o=f.message)},l.$$.update=()=>{l.$$.dirty&6&&t(3,s=o.sender.id==n.userid?o.recipients.filter(f=>f.type=="cc").length>0:o.recipients.filter(f=>["to","cc"].includes(f.type)&&f.id!=n.userid).length>0)},[a,o,n,s]}class qr extends ae{constructor(e){super(),oe(this,e,Nr,zr,re,{store:0,message:1})}}function Gs(l,e,t){const s=l.slice();s[6]=e[t];const n=Array.from(s[1].values()).filter(function(...r){return l[5](s[6],...r)});return s[7]=n,s}function Us(l,e,t){const s=l.slice();return s[10]=e[t],s}function Hs(l){let e,t,s=l[3].strings[l[6]]+"",n,i,r,a,o=[],f=new Map,c,u,d,g=ue(l[7]);const p=b=>b[10].id;for(let b=0;b<g.length;b+=1){let $=Us(l,g,b),w=p($);f.set(w,o[b]=Os(w,$))}return{c(){e=h("div"),t=h("div"),n=P(s),i=P(":"),r=j(),a=h("div");for(let b=0;b<o.length;b+=1)o[b].c();c=j(),m(t,"class","local-mail-draft-form-recipients-type flex-shrink-0 py-2 mr-2 svelte-orcw73"),m(a,"class","d-flex flex-wrap"),he(a,"min-width","0"),m(e,"class","d-flex mb-2")},m(b,$){M(b,e,$),_(e,t),_(t,n),_(t,i),_(e,r),_(e,a);for(let w=0;w<o.length;w+=1)o[w]&&o[w].m(a,null);_(e,c),d=!0},p(b,$){(!d||$&8)&&s!==(s=b[3].strings[b[6]]+"")&&R(n,s),$&14&&(g=ue(b[7]),ne(),o=je(o,$,p,1,b,g,f,a,Je,Os,null,Us),ie())},i(b){if(!d){for(let $=0;$<g.length;$+=1)C(o[$]);b&&Ie(()=>{d&&(u||(u=He(e,Pe,{},!0)),u.run(1))}),d=!0}},o(b){for(let $=0;$<o.length;$+=1)L(o[$]);b&&(u||(u=He(e,Pe,{},!1)),u.run(0)),d=!1},d(b){b&&y(e);for(let $=0;$<o.length;$+=1)o[$].d();b&&u&&u.end()}}}function Ir(l){let e,t,s;return{c(){e=h("div"),t=h("i"),m(t,"class","fa fa-exclamation-circle"),m(e,"class","m-0 d-flex justify-content-center align-items-center"),he(e,"width","35px"),he(e,"height","35px"),m(e,"title",s=l[3].strings.cannotsendmailtouser)},m(n,i){M(n,e,i),_(e,t)},p(n,i){i&8&&s!==(s=n[3].strings.cannotsendmailtouser)&&m(e,"title",s)},i:E,o:E,d(n){n&&y(e)}}}function Ar(l){let e,t;return e=new at({props:{user:l[10]}}),{c(){J(e.$$.fragment)},m(s,n){O(e,s,n),t=!0},p(s,n){const i={};n&2&&(i.user=s[10]),e.$set(i)},i(s){t||(C(e.$$.fragment,s),t=!0)},o(s){L(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function Os(l,e){let t,s,n,i,r,a,o=e[10].fullname+"",f,c,u,d,g,p,b,$,w,v,S,k;const T=[Ar,Ir],q=[];function D(z,K){return z[10].isvalid?0:1}n=D(e),i=q[n]=T[n](e);function A(){return e[4](e[10])}return{key:l,first:null,c(){t=h("div"),s=h("div"),i.c(),r=j(),a=h("div"),f=P(o),u=j(),d=h("button"),g=h("i"),b=j(),m(s,"class","d-flex m-1 mr-2"),m(a,"class","py-2"),m(g,"class","fa fa-fw fa-times"),m(d,"type","button"),m(d,"class","btn align-self-middle p-2 align-bottom svelte-orcw73"),m(d,"title",p=e[3].strings.delete),m(t,"class","local-mail-draft-form-recipients-user alert d-flex flex-shrink align-items-center border-0 p-0 mr-2 mb-2 svelte-orcw73"),V(t,"alert-danger",!e[10].isvalid),this.first=t},m(z,K){M(z,t,K),_(t,s),q[n].m(s,null),_(t,r),_(t,a),_(a,f),_(t,u),_(t,d),_(d,g),_(t,b),v=!0,S||(k=[ze(c=We.call(null,a,e[10].fullname)),W(d,"click",A),ze($=We.call(null,t,e[10].fullname))],S=!0)},p(z,K){e=z;let G=n;n=D(e),n===G?q[n].p(e,K):(ne(),L(q[G],1,1,()=>{q[G]=null}),ie(),i=q[n],i?i.p(e,K):(i=q[n]=T[n](e),i.c()),C(i,1),i.m(s,null)),(!v||K&2)&&o!==(o=e[10].fullname+"")&&R(f,o),c&&De(c.update)&&K&2&&c.update.call(null,e[10].fullname),(!v||K&8&&p!==(p=e[3].strings.delete))&&m(d,"title",p),$&&De($.update)&&K&2&&$.update.call(null,e[10].fullname),(!v||K&2)&&V(t,"alert-danger",!e[10].isvalid)},i(z){v||(C(i),z&&Ie(()=>{v&&(w||(w=He(t,Pe,{},!0)),w.run(1))}),v=!0)},o(z){L(i),z&&(w||(w=He(t,Pe,{},!1)),w.run(0)),v=!1},d(z){z&&y(t),q[n].d(),z&&w&&w.end(),S=!1,Me(k)}}}function Js(l){let e,t,s=l[7].length&&Hs(l);return{c(){s&&s.c(),e=_e()},m(n,i){s&&s.m(n,i),M(n,e,i),t=!0},p(n,i){n[7].length?s?(s.p(n,i),i&2&&C(s,1)):(s=Hs(n),s.c(),C(s,1),s.m(e.parentNode,e)):s&&(ne(),L(s,1,1,()=>{s=null}),ie())},i(n){t||(C(s),t=!0)},o(n){L(s),t=!1},d(n){n&&y(e),s&&s.d(n)}}}function Br(l){let e,t,s=ue(Object.values(Be)),n=[];for(let r=0;r<s.length;r+=1)n[r]=Js(Gs(l,s,r));const i=r=>L(n[r],1,1,()=>{n[r]=null});return{c(){for(let r=0;r<n.length;r+=1)n[r].c();e=_e()},m(r,a){for(let o=0;o<n.length;o+=1)n[o]&&n[o].m(r,a);M(r,e,a),t=!0},p(r,[a]){if(a&14){s=ue(Object.values(Be));let o;for(o=0;o<s.length;o+=1){const f=Gs(r,s,o);n[o]?(n[o].p(f,a),C(n[o],1)):(n[o]=Js(f),n[o].c(),C(n[o],1),n[o].m(e.parentNode,e))}for(ne(),o=s.length;o<n.length;o+=1)i(o);ie()}},i(r){if(!t){for(let a=0;a<s.length;a+=1)C(n[a]);t=!0}},o(r){n=n.filter(Boolean);for(let a=0;a<n.length;a+=1)L(n[a]);t=!1},d(r){r&&y(e),Ee(n,r)}}}function Pr(l,e,t){let s,n=E,i=()=>(n(),n=ge(r,u=>t(3,s=u)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{recipients:a}=e,{onDelete:o}=e;const f=u=>o(u),c=(u,d)=>d.type==u;return l.$$set=u=>{"store"in u&&i(t(0,r=u.store)),"recipients"in u&&t(1,a=u.recipients),"onDelete"in u&&t(2,o=u.onDelete)},[r,a,o,s,f,c]}class Er extends ae{constructor(e){super(),oe(this,e,Pr,Br,re,{store:0,recipients:1,onDelete:2})}}function Ks(l,e,t){const s=l.slice();return s[4]=e[t],s}function Rr(l){let e,t,s=l[1].shorttime+"",n;return{c(){e=h("i"),t=j(),n=P(s),m(e,"class","fa fa-clock-o mr-1"),m(e,"aria-hidden","true")},m(i,r){M(i,e,r),M(i,t,r),M(i,n,r)},p(i,r){r&2&&s!==(s=i[1].shorttime+"")&&R(n,s)},d(i){i&&(y(e),y(t),y(n))}}}function Fr(l){let e,t,s=l[2].strings.draftsaved+"",n;return{c(){e=h("i"),t=j(),n=P(s),m(e,"class","fa fa-check mr-1"),m(e,"aria-hidden","true")},m(i,r){M(i,e,r),M(i,t,r),M(i,n,r)},p(i,r){r&4&&s!==(s=i[2].strings.draftsaved+"")&&R(n,s)},d(i){i&&(y(e),y(t),y(n))}}}function Vs(l){let e,t=[],s=new Map,n,i=ue(l[1].labels);const r=a=>a[4].id;for(let a=0;a<i.length;a+=1){let o=Ks(l,i,a),f=r(o);s.set(f,t[a]=Ws(f,o))}return{c(){e=h("div");for(let a=0;a<t.length;a+=1)t[a].c();m(e,"class","d-flex flex-wrap mt-2 mr-2"),he(e,"min-width","0")},m(a,o){M(a,e,o);for(let f=0;f<t.length;f+=1)t[f]&&t[f].m(e,null);n=!0},p(a,o){o&2&&(i=ue(a[1].labels),ne(),t=je(t,o,r,1,a,i,s,e,Je,Ws,null,Ks),ie())},i(a){if(!n){for(let o=0;o<i.length;o+=1)C(t[o]);n=!0}},o(a){for(let o=0;o<t.length;o+=1)L(t[o]);n=!1},d(a){a&&y(e);for(let o=0;o<t.length;o+=1)t[o].d()}}}function Ws(l,e){let t,s,n;return s=new Mt({props:{label:e[4]}}),{key:l,first:null,c(){t=_e(),J(s.$$.fragment),this.first=t},m(i,r){M(i,t,r),O(s,i,r),n=!0},p(i,r){e=i;const a={};r&2&&(a.label=e[4]),s.$set(a)},i(i){n||(C(s.$$.fragment,i),n=!0)},o(i){L(s.$$.fragment,i),n=!1},d(i){i&&y(t),H(s,i)}}}function Gr(l){let e,t,s,n,i,r,a,o,f,c,u,d,g,p,b;function $(k,T){return k[2].draftSaved?Fr:Rr}let w=$(l),v=w(l),S=l[1].labels&&Vs(l);return{c(){e=h("div"),t=h("div"),s=h("div"),v.c(),i=j(),r=h("button"),a=h("i"),d=j(),S&&S.c(),m(s,"class","align-self-center alert alert-info m-0 px-2 py-0 text-truncate"),m(s,"title",n=l[1].fulltime),m(a,"class",o="fa "+(l[1].starred?"fa-star text-warning":"fa-star-o")),m(r,"type","button"),m(r,"class","btn border-0 py-2 ml-auto mr-2 mr-sm-0"),m(r,"role","checkbox"),m(r,"aria-checked",f=l[1].starred),r.disabled=c=l[1].deleted,m(r,"title",u=l[1].starred?l[2].strings.markasunstarred:l[2].strings.markasstarred),m(t,"class","d-flex flex-grow-1"),m(e,"class","local-mail-draft-form-time-and-labels d-sm-flex justify-content-between mb-2 svelte-7mffjm")},m(k,T){M(k,e,T),_(e,t),_(t,s),v.m(s,null),_(t,i),_(t,r),_(r,a),_(e,d),S&&S.m(e,null),g=!0,p||(b=W(r,"click",l[3]),p=!0)},p(k,[T]){w===(w=$(k))&&v?v.p(k,T):(v.d(1),v=w(k),v&&(v.c(),v.m(s,null))),(!g||T&2&&n!==(n=k[1].fulltime))&&m(s,"title",n),(!g||T&2&&o!==(o="fa "+(k[1].starred?"fa-star text-warning":"fa-star-o")))&&m(a,"class",o),(!g||T&2&&f!==(f=k[1].starred))&&m(r,"aria-checked",f),(!g||T&2&&c!==(c=k[1].deleted))&&(r.disabled=c),(!g||T&6&&u!==(u=k[1].starred?k[2].strings.markasunstarred:k[2].strings.markasstarred))&&m(r,"title",u),k[1].labels?S?(S.p(k,T),T&2&&C(S,1)):(S=Vs(k),S.c(),C(S,1),S.m(e,null)):S&&(ne(),L(S,1,1,()=>{S=null}),ie())},i(k){g||(C(S),g=!0)},o(k){L(S),g=!1},d(k){k&&y(e),v.d(),S&&S.d(),p=!1,b()}}}function Ur(l,e,t){let s,n=E,i=()=>(n(),n=ge(r,f=>t(2,s=f)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{message:a}=e;const o=()=>r.setStarred([a.id],!a.starred);return l.$$set=f=>{"store"in f&&i(t(0,r=f.store)),"message"in f&&t(1,a=f.message)},[r,a,s,o]}class Hr extends ae{constructor(e){super(),oe(this,e,Ur,Gr,re,{store:0,message:1})}}let Ke;const Or=new Set(["get_courses","get_labels","count_messages","search_messages","get_message","view_message","get_roles","get_groups","search_users","get_message_form"]);function St(l){let e=!1;const t=async()=>{const s=await gt("core/ajax"),n=l.filter(r=>!e||!Or.has(r.methodname)).map(({methodname:r,...a})=>({methodname:`local_satsmail_${r}`,args:a}));let i=[];if(n.length>0)try{i=await Promise.all(s.call(n))}catch(r){throw typeof r=="string"?{message:r}:r}return e?null:i};return Ke==null||Ke.cancel(),Ke={promise:Ke?Ke.promise.then(t,t):t(),cancel:()=>{e=!0}},Ke.promise}function Xs(l,e,t){var i;const s=l.slice();s[28]=e[t];const n=(i=s[1].get(s[28].id))==null?void 0:i.type;return s[29]=n,s}function Ys(l,e,t){const s=l.slice();return s[32]=e[t],s}function Qs(l,e,t){const s=l.slice();s[32]=e[t];const n=s[10].every(function(...r){return l[21](s[32],...r)});return s[35]=n,s}function Zs(l,e,t){const s=l.slice();return s[38]=e[t],s}function xs(l,e,t){const s=l.slice();return s[41]=e[t],s}function el(l,e){let t,s=e[41].name+"",n,i,r;return{key:l,first:null,c(){t=h("option"),n=P(s),i=j(),t.__value=r=e[41].id,Le(t,t.__value),this.first=t},m(a,o){M(a,t,o),_(t,n),_(t,i)},p(a,o){e=a,o[0]&32&&s!==(s=e[41].name+"")&&R(n,s),o[0]&32&&r!==(r=e[41].id)&&(t.__value=r,Le(t,t.__value))},d(a){a&&y(t)}}}function tl(l){let e,t,s=[],n=new Map,i,r,a,o=ue(l[5].draftGroups??[]);const f=c=>c[38].id;for(let c=0;c<o.length;c+=1){let u=Zs(l,o,c),d=f(u);n.set(d,s[c]=sl(d,u))}return{c(){e=h("div"),t=h("select");for(let c=0;c<s.length;c+=1)s[c].c();m(t,"class","form-control text-truncate"),he(t,"min-width","0"),t.disabled=i=(l[5].draftGroups??[]).length==1,l[4]===void 0&&Ie(()=>l[18].call(t)),m(e,"class","flex-grow-1 mx-2 mt-2 mt-sm-0")},m(c,u){M(c,e,u),_(e,t);for(let d=0;d<s.length;d+=1)s[d]&&s[d].m(t,null);tt(t,l[4],!0),r||(a=[W(t,"change",l[18]),W(t,"change",l[19])],r=!0)},p(c,u){u[0]&32&&(o=ue(c[5].draftGroups??[]),s=je(s,u,f,1,c,o,n,t,dt,sl,null,Zs)),u[0]&32&&i!==(i=(c[5].draftGroups??[]).length==1)&&(t.disabled=i),u[0]&48&&tt(t,c[4])},d(c){c&&y(e);for(let u=0;u<s.length;u+=1)s[u].d();r=!1,Me(a)}}}function sl(l,e){let t,s=e[38].name+"",n,i,r;return{key:l,first:null,c(){t=h("option"),n=P(s),i=j(),t.__value=r=e[38].id,Le(t,t.__value),m(t,"class","text-truncate"),this.first=t},m(a,o){M(a,t,o),_(t,n),_(t,i)},p(a,o){e=a,o[0]&32&&s!==(s=e[38].name+"")&&R(n,s),o[0]&32&&r!==(r=e[38].id)&&(t.__value=r,Le(t,t.__value))},d(a){a&&y(t)}}}function Jr(l){let e,t,s,n,i,r,a=l[5].strings.allusers+"",o,f,c,u,d,g=[],p=new Map,b,$,w,v;s=new at({props:{icon:"fa-users"}});let S=ue(Object.values(Be)),k=[];for(let D=0;D<S.length;D+=1)k[D]=ll(Qs(l,S,D));let T=ue(l[10]);const q=D=>D[28].id;for(let D=0;D<T.length;D+=1){let A=Xs(l,T,D),z=q(A);p.set(z,g[D]=il(z,A))}return{c(){e=h("div"),t=h("div"),J(s.$$.fragment),n=j(),i=h("div"),r=h("div"),o=P(a),c=j(),u=h("div");for(let D=0;D<k.length;D+=1)k[D].c();d=j();for(let D=0;D<g.length;D+=1)g[D].c();b=_e(),m(t,"class","mx-3 my-2"),m(r,"class","py-2 mr-3"),m(u,"class","d-flex ml-auto mr-2"),m(i,"class","d-sm-flex align-items-center flex-grow-1"),m(e,"class","list-group-item d-flex align-items-sm-center p-0")},m(D,A){M(D,e,A),_(e,t),O(s,t,null),_(e,n),_(e,i),_(i,r),_(r,o),_(i,c),_(i,u);for(let z=0;z<k.length;z+=1)k[z]&&k[z].m(u,null);M(D,d,A);for(let z=0;z<g.length;z+=1)g[z]&&g[z].m(D,A);M(D,b,A),$=!0,w||(v=ze(f=We.call(null,r,l[5].strings.allusers)),w=!0)},p(D,A){if((!$||A[0]&32)&&a!==(a=D[5].strings.allusers+"")&&R(o,a),f&&De(f.update)&&A[0]&32&&f.update.call(null,D[5].strings.allusers),A[0]&1062){S=ue(Object.values(Be));let z;for(z=0;z<S.length;z+=1){const K=Qs(D,S,z);k[z]?k[z].p(K,A):(k[z]=ll(K),k[z].c(),k[z].m(u,null))}for(;z<k.length;z+=1)k[z].d(1);k.length=S.length}A[0]&1062&&(T=ue(D[10]),ne(),g=je(g,A,q,1,D,T,p,b.parentNode,Je,il,b,Xs),ie())},i(D){if(!$){C(s.$$.fragment,D);for(let A=0;A<T.length;A+=1)C(g[A]);$=!0}},o(D){L(s.$$.fragment,D);for(let A=0;A<g.length;A+=1)L(g[A]);$=!1},d(D){D&&(y(e),y(d),y(b)),H(s),Ee(k,D);for(let A=0;A<g.length;A+=1)g[A].d(D);w=!1,v()}}}function Kr(l){let e,t;return{c(){e=h("div"),t=P(l[11]),m(e,"class","list-group-item text-danger")},m(s,n){M(s,e,n),_(e,t)},p(s,n){n[0]&2048&&R(t,s[11])},i:E,o:E,d(s){s&&y(e)}}}function ll(l){let e,t=l[5].strings[l[32]]+"",s,n,i,r,a;function o(){return l[20](l[35],l[32])}return{c(){e=h("button"),s=P(t),n=j(),m(e,"type","button"),m(e,"class","btn text-nowrap mr-2 mb-2 mt-sm-2"),m(e,"aria-pressed",i=l[35]),V(e,"btn-primary",l[35]),V(e,"btn-secondary",!l[35])},m(f,c){M(f,e,c),_(e,s),_(e,n),r||(a=W(e,"click",o),r=!0)},p(f,c){l=f,c[0]&32&&t!==(t=l[5].strings[l[32]]+"")&&R(s,t),c[0]&1026&&i!==(i=l[35])&&m(e,"aria-pressed",i),c[0]&1026&&V(e,"btn-primary",l[35]),c[0]&1026&&V(e,"btn-secondary",!l[35])},d(f){f&&y(e),r=!1,a()}}}function nl(l){let e,t=l[5].strings[l[32]]+"",s,n,i,r,a;function o(){return l[22](l[28],l[29],l[32])}return{c(){e=h("button"),s=P(t),n=j(),m(e,"type","button"),m(e,"class","btn text-nowrap mr-2 mb-2 mt-sm-2"),m(e,"aria-pressed",i=l[29]==l[32]),V(e,"btn-primary",l[29]==l[32]),V(e,"btn-secondary",l[29]!=l[32])},m(f,c){M(f,e,c),_(e,s),_(e,n),r||(a=W(e,"click",o),r=!0)},p(f,c){l=f,c[0]&32&&t!==(t=l[5].strings[l[32]]+"")&&R(s,t),c[0]&1026&&i!==(i=l[29]==l[32])&&m(e,"aria-pressed",i),c[0]&1026&&V(e,"btn-primary",l[29]==l[32]),c[0]&1026&&V(e,"btn-secondary",l[29]!=l[32])},d(f){f&&y(e),r=!1,a()}}}function il(l,e){let t,s,n,i,r,a,o=e[28].fullname+"",f,c,u,d,g;n=new at({props:{user:e[28]}});let p=ue(Object.values(Be)),b=[];for(let $=0;$<p.length;$+=1)b[$]=nl(Ys(e,p,$));return{key:l,first:null,c(){t=h("div"),s=h("div"),J(n.$$.fragment),i=j(),r=h("div"),a=h("div"),f=P(o),c=j(),u=h("div");for(let $=0;$<b.length;$+=1)b[$].c();d=j(),m(s,"class","mx-3 my-2"),m(a,"class","py-2 mr-3 align-self-center"),m(u,"class","d-flex ml-auto mr-2 align-self-start"),m(r,"class","d-sm-flex flex-grow-1"),m(t,"class","list-group-item d-flex p-0"),this.first=t},m($,w){M($,t,w),_(t,s),O(n,s,null),_(t,i),_(t,r),_(r,a),_(a,f),_(r,c),_(r,u);for(let v=0;v<b.length;v+=1)b[v]&&b[v].m(u,null);_(t,d),g=!0},p($,w){e=$;const v={};if(w[0]&1024&&(v.user=e[28]),n.$set(v),(!g||w[0]&1024)&&o!==(o=e[28].fullname+"")&&R(f,o),w[0]&1062){p=ue(Object.values(Be));let S;for(S=0;S<p.length;S+=1){const k=Ys(e,p,S);b[S]?b[S].p(k,w):(b[S]=nl(k),b[S].c(),b[S].m(u,null))}for(;S<b.length;S+=1)b[S].d(1);b.length=p.length}},i($){g||(C(n.$$.fragment,$),g=!0)},o($){L(n.$$.fragment,$),g=!1},d($){$&&y(t),H(n),Ee(b,$)}}}function Vr(l){let e,t,s,n,i,r=l[5].strings.allroles+"",a,o=[],f=new Map,c,u,d,g,p,b,$,w=ue(l[5].draftRoles??[]);const v=D=>D[41].id;for(let D=0;D<w.length;D+=1){let A=xs(l,w,D),z=v(A);f.set(z,o[D]=el(z,A))}let S=(l[5].draftGroups??[]).length>0&&tl(l);const k=[Kr,Jr],T=[];function q(D,A){return D[11]?0:1}return d=q(l),g=T[d]=k[d](l),{c(){e=h("div"),t=h("div"),s=h("div"),n=h("select"),i=h("option"),a=P(r);for(let D=0;D<o.length;D+=1)o[D].c();c=j(),S&&S.c(),u=j(),g.c(),i.__value=0,Le(i,i.__value),m(n,"class","form-control custom-select w-100 text-truncate bg-transparent"),l[3]===void 0&&Ie(()=>l[16].call(n)),m(s,"class","flex-grow-1 mx-2"),m(t,"class","list-group-item d-sm-flex px-2 py-2"),m(e,"class","local-mail-draft-form-user-search-dropdown dropdown-menu p-0 w-100 svelte-1tbvkt9"),he(e,"min-width","18rem"),V(e,"show",l[6])},m(D,A){M(D,e,A),_(e,t),_(t,s),_(s,n),_(n,i),_(i,a);for(let z=0;z<o.length;z+=1)o[z]&&o[z].m(n,null);tt(n,l[3],!0),_(t,c),S&&S.m(t,null),_(e,u),T[d].m(e,null),p=!0,b||($=[W(n,"change",l[16]),W(n,"change",l[17])],b=!0)},p(D,A){(!p||A[0]&32)&&r!==(r=D[5].strings.allroles+"")&&R(a,r),A[0]&32&&(w=ue(D[5].draftRoles??[]),o=je(o,A,v,1,D,w,f,n,dt,el,null,xs)),A[0]&40&&tt(n,D[3]),(D[5].draftGroups??[]).length>0?S?S.p(D,A):(S=tl(D),S.c(),S.m(t,null)):S&&(S.d(1),S=null);let z=d;d=q(D),d===z?T[d].p(D,A):(ne(),L(T[z],1,1,()=>{T[z]=null}),ie(),g=T[d],g?g.p(D,A):(g=T[d]=k[d](D),g.c()),C(g,1),g.m(e,null)),(!p||A[0]&64)&&V(e,"show",D[6])},i(D){p||(C(g),p=!0)},o(D){L(g),p=!1},d(D){D&&y(e);for(let A=0;A<o.length;A+=1)o[A].d();S&&S.d(),T[d].d(),b=!1,Me($)}}}function Wr(l){let e,t,s,n;function i(a){l[25](a)}let r={mode:"input",inputPlaceholder:l[5].strings.addrecipients,leftIconClass:l[9]?"fa-spinner fa-pulse":"fa-user",rightIconClass:l[7]?"fa-times":l[6]?"fa-caret-up":"fa-caret-down",rightIconLabel:l[5].strings.addrecipients,onRightIconClick:l[12],invalid:!l[1].size,onFocus:l[15],onBlur:l[14],onInput:l[23],$$slots:{default:[Vr]},$$scope:{ctx:l}};return l[7]!==void 0&&(r.inputText=l[7]),t=new Wl({props:r}),l[24](t),Se.push(()=>Ge(t,"inputText",i)),{c(){e=h("div"),J(t.$$.fragment),m(e,"class","local-mail-draft-form-user-search form-group svelte-1tbvkt9")},m(a,o){M(a,e,o),O(t,e,null),n=!0},p(a,o){const f={};o[0]&32&&(f.inputPlaceholder=a[5].strings.addrecipients),o[0]&512&&(f.leftIconClass=a[9]?"fa-spinner fa-pulse":"fa-user"),o[0]&192&&(f.rightIconClass=a[7]?"fa-times":a[6]?"fa-caret-up":"fa-caret-down"),o[0]&32&&(f.rightIconLabel=a[5].strings.addrecipients),o[0]&2&&(f.invalid=!a[1].size),o[0]&3198|o[1]&8192&&(f.$$scope={dirty:o,ctx:a}),!s&&o[0]&128&&(s=!0,f.inputText=a[7],Ue(()=>s=!1)),t.$set(f)},i(a){n||(C(t.$$.fragment,a),n=!0)},o(a){L(t.$$.fragment,a),n=!1},d(a){a&&y(e),l[24](null),H(t)}}}const Xr=500;function Yr(l,e,t){let s,n,i=E,r=()=>(i(),i=ge(a,F=>t(5,n=F)),a);l.$$.on_destroy.push(()=>i());let{store:a}=e;r();let{recipients:o}=e,{onChange:f}=e,c=!1,u="",d,g=!1,p,b=[],$="",w=0,v=0;const S=async()=>{c?(t(7,u=""),t(6,c=!1),window.clearTimeout(p)):(k(!1),d.focus())},k=async F=>{var x;const te=n.settings.usersearchlimit;if(t(9,g=!0),window.clearTimeout(p),(s==null?void 0:s.groupmode)!=en.No&&!((x=n.draftGroups)!=null&&x.length)){t(9,g=!1),t(6,c=!0),t(11,$=n.strings.errornogroups);return}p=window.setTimeout(async()=>{const I={methodname:"search_users",query:{courseid:(s==null?void 0:s.id)||0,fullname:u,roleid:w,groupid:v},limit:te+1};let N;try{N=await St([I])}catch(X){a.setError(X);return}N!=null&&(t(10,b=N.pop()),b.length?b.length>te?t(11,$=n.strings.toomanyusersfound):t(11,$=""):t(11,$=n.strings.nousersfound),t(10,b=b.slice(0,te)),t(9,g=!1),t(6,c=!0))},F?Xr:0)},T=()=>{t(7,u=""),t(6,c=!1)},q=()=>{c||k(!1)};function D(){w=bt(this),t(3,w),t(5,n)}const A=()=>k(!1);function z(){v=bt(this),t(4,v),t(5,n)}const K=()=>k(!1),G=(F,te)=>f(b,F?null:te),U=(F,te)=>{var x;return((x=o.get(te.id))==null?void 0:x.type)==F},se=(F,te,x)=>f([F],te==x?null:x),le=()=>k(!0);function Q(F){Se[F?"unshift":"push"](()=>{d=F,t(8,d)})}function ee(F){u=F,t(7,u)}return l.$$set=F=>{"store"in F&&r(t(0,a=F.store)),"recipients"in F&&t(1,o=F.recipients),"onChange"in F&&t(2,f=F.onChange)},l.$$.update=()=>{var F,te,x,I,N;l.$$.dirty[0]&32&&(s=(F=n.message)==null?void 0:F.course),l.$$.dirty[0]&40&&t(3,w=(te=n.draftRoles)!=null&&te.find(X=>X.id==w)?w:0),l.$$.dirty[0]&48&&t(4,v=(x=n.draftGroups)!=null&&x.find(X=>X.id==v)?v:((N=(I=n.draftGroups)==null?void 0:I[0])==null?void 0:N.id)||0)},[a,o,f,w,v,n,c,u,d,g,b,$,S,k,T,q,D,A,z,K,G,U,se,le,Q,ee]}class Qr extends ae{constructor(e){super(),oe(this,e,Yr,Wr,re,{store:0,recipients:1,onChange:2},null,[-1,-1])}}function Zr(l){let e,t,s,n=l[1].strings.send+"",i,r,a,o;return{c(){e=h("button"),t=h("i"),s=j(),i=P(n),m(t,"class","fa fa-send mr-2"),m(e,"type","button"),m(e,"class","local-mail-action-send btn btn-primary flex-shrink-0 text-nowrap px-3 text-truncate ml-auto"),m(e,"title",r=l[1].strings.send)},m(f,c){M(f,e,c),_(e,t),_(e,s),_(e,i),a||(o=W(e,"click",l[2]),a=!0)},p(f,[c]){c&2&&n!==(n=f[1].strings.send+"")&&R(i,n),c&2&&r!==(r=f[1].strings.send)&&m(e,"title",r)},i:E,o:E,d(f){f&&y(e),a=!1,o()}}}function xr(l,e,t){let s,n=E,i=()=>(n(),n=ge(r,o=>t(1,s=o)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();const a=()=>r.sendMessage();return l.$$set=o=>{"store"in o&&i(t(0,r=o.store))},[r,s,a]}class vn extends ae{constructor(e){super(),oe(this,e,xr,Zr,re,{store:0})}}const{Map:ea}=rt;function rl(l,e,t){const s=l.slice();return s[18]=e[t],s}function al(l){let e,t,s,n=l[7].strings.errorinvalidrecipients+"",i;return{c(){e=h("div"),t=h("i"),s=j(),i=P(n),m(t,"class","fa fa-exclamation-circle mr-2"),m(e,"class","alert alert-danger")},m(r,a){M(r,e,a),_(e,t),_(e,s),_(e,i)},p(r,a){a&128&&n!==(n=r[7].strings.errorinvalidrecipients+"")&&R(i,n)},d(r){r&&y(e)}}}function ta(l){let e,t,s,n=qe(l[7].strings.errortoomanyrecipients,l[7].settings.maxrecipients)+"",i;return{c(){e=h("div"),t=h("i"),s=j(),i=P(n),m(t,"class","fa fa-exclamation-circle mr-2"),m(e,"class","alert alert-danger")},m(r,a){M(r,e,a),_(e,t),_(e,s),_(e,i)},p(r,a){a&128&&n!==(n=qe(r[7].strings.errortoomanyrecipients,r[7].settings.maxrecipients)+"")&&R(i,n)},d(r){r&&y(e)}}}function sa(l){let e,t,s,n=l[7].strings.erroremptyrecipients+"",i;return{c(){e=h("div"),t=h("i"),s=j(),i=P(n),m(t,"class","fa fa-exclamation-circle mr-2"),m(e,"class","alert alert-danger")},m(r,a){M(r,e,a),_(e,t),_(e,s),_(e,i)},p(r,a){a&128&&n!==(n=r[7].strings.erroremptyrecipients+"")&&R(i,n)},d(r){r&&y(e)}}}function ol(l){let e,t,s,n=l[7].strings.erroremptysubject+"",i;return{c(){e=h("div"),t=h("i"),s=j(),i=P(n),m(t,"class","fa fa-exclamation-circle mr-2"),m(e,"class","alert alert-danger")},m(r,a){M(r,e,a),_(e,t),_(e,s),_(e,i)},p(r,a){a&128&&n!==(n=r[7].strings.erroremptysubject+"")&&R(i,n)},d(r){r&&y(e)}}}function fl(l){let e,t=l[7].strings.references+"",s,n,i=[],r=new ea,a,o,f=ue(l[1].references);const c=u=>u[18].id;for(let u=0;u<f.length;u+=1){let d=rl(l,f,u),g=c(d);r.set(g,i[u]=ul(g,d))}return{c(){e=h("div"),s=P(t),n=j();for(let u=0;u<i.length;u+=1)i[u].c();a=_e(),m(e,"class","alert alert-secondary mt-4 mb-4 text-center")},m(u,d){M(u,e,d),_(e,s),M(u,n,d);for(let g=0;g<i.length;g+=1)i[g]&&i[g].m(u,d);M(u,a,d),o=!0},p(u,d){(!o||d&128)&&t!==(t=u[7].strings.references+"")&&R(s,t),d&130&&(f=ue(u[1].references),ne(),i=je(i,d,c,1,u,f,r,a.parentNode,Je,ul,a,rl),ie())},i(u){if(!o){for(let d=0;d<f.length;d+=1)C(i[d]);o=!0}},o(u){for(let d=0;d<i.length;d+=1)L(i[d]);o=!1},d(u){u&&(y(e),y(n),y(a));for(let d=0;d<i.length;d+=1)i[d].d(u)}}}function ul(l,e){let t,s,n;return s=new kn({props:{strings:e[7].strings,reference:e[18]}}),{key:l,first:null,c(){t=_e(),J(s.$$.fragment),this.first=t},m(i,r){M(i,t,r),O(s,i,r),n=!0},p(i,r){e=i;const a={};r&128&&(a.strings=e[7].strings),r&2&&(a.reference=e[18]),s.$set(a)},i(i){n||(C(s.$$.fragment,i),n=!0)},o(i){L(s.$$.fragment,i),n=!1},d(i){i&&y(t),H(s,i)}}}function la(l){let e,t,s,n,i,r,a,o,f,c,u,d,g,p,b,$,w,v,S,k,T,q,D=l[2].editorhtml+"",A,z,K=l[2].filemanagerhtml+"",G,U=Array.from(l[5].values()).some(cl),se,le,Q=!l[4].trim(),ee,F,te,x=l[7].strings.save+"",I,N,X,B,de,Z,ke,we,ve;e=new pn({props:{javascript:l[2].javascript}}),r=new Hr({props:{store:l[0],message:l[1]}}),c=new Xl({props:{settings:l[7].settings,strings:l[7].strings,courses:l[7].courses,label:l[7].strings.course,selected:l[6],required:!0,readonly:l[1].references.length>0,onChange:l[8]}}),g=new Qr({props:{store:l[0],recipients:l[5],onChange:l[9]}}),b=new Er({props:{store:l[0],recipients:l[5],onDelete:l[10]}});let ce=U&&al(l);function Ce(Y,me){if(Y[5].size==0)return sa;if(Y[5].size>Y[7].settings.maxrecipients)return ta}let Te=Ce(l),$e=Te&&Te(l),be=Q&&ol(l);B=new vn({props:{store:l[0]}});let pe=l[1].references.length>0&&fl(l);return{c(){J(e.$$.fragment),t=j(),s=h("hr"),n=j(),i=h("form"),J(r.$$.fragment),a=j(),o=h("div"),f=h("div"),J(c.$$.fragment),u=j(),d=h("div"),J(g.$$.fragment),p=j(),J(b.$$.fragment),$=j(),w=h("div"),v=h("input"),T=j(),q=h("div"),A=j(),z=h("div"),G=j(),ce&&ce.c(),se=j(),$e&&$e.c(),le=j(),be&&be.c(),ee=j(),F=h("div"),te=h("button"),I=P(x),X=j(),J(B.$$.fragment),de=j(),pe&&pe.c(),Z=_e(),m(s,"class","d-lg-none mt-0 mb-3 mb-sm-2"),m(f,"class","form-group col-12 col-xl-5"),m(d,"class","col-12 col-xl-7"),m(o,"class","row"),m(v,"type","text"),m(v,"id","local-mail-message-form-subject"),m(v,"class","form-control"),m(v,"placeholder",S=l[7].strings.subject),m(v,"aria-label",k=l[7].strings.subject),m(v,"autocomplete","off"),m(v,"maxlength","100"),V(v,"is-invalid",!l[4].trim()),m(w,"class","form-group"),m(q,"class","form-group"),m(z,"class","form-group"),m(te,"type","submit"),m(te,"class","btn btn-secondary flex-shrink-0 text-nowrap px-3 text-truncate"),m(te,"title",N=l[7].strings.send),m(F,"class","d-flex justify-content-end align-items-center"),m(i,"class","pt-lg-2 pb-3 px-lg-4"),V(i,"card",l[7].viewportSize>=fe.LG)},m(Y,me){O(e,Y,me),M(Y,t,me),M(Y,s,me),M(Y,n,me),M(Y,i,me),O(r,i,null),_(i,a),_(i,o),_(o,f),O(c,f,null),_(o,u),_(o,d),O(g,d,null),_(i,p),O(b,i,null),_(i,$),_(i,w),_(w,v),Le(v,l[4]),_(i,T),_(i,q),q.innerHTML=D,_(i,A),_(i,z),z.innerHTML=K,_(i,G),ce&&ce.m(i,null),_(i,se),$e&&$e.m(i,null),_(i,le),be&&be.m(i,null),_(i,ee),_(i,F),_(F,te),_(te,I),_(F,X),O(B,F,null),l[16](i),M(Y,de,me),pe&&pe.m(Y,me),M(Y,Z,me),ke=!0,we||(ve=[W(v,"input",l[13]),W(v,"input",l[14]),W(q,"change",l[15]),W(i,"submit",Ae(l[11]))],we=!0)},p(Y,[me]){const st={};me&4&&(st.javascript=Y[2].javascript),e.$set(st);const Ye={};me&1&&(Ye.store=Y[0]),me&2&&(Ye.message=Y[1]),r.$set(Ye);const Ne={};me&128&&(Ne.settings=Y[7].settings),me&128&&(Ne.strings=Y[7].strings),me&128&&(Ne.courses=Y[7].courses),me&128&&(Ne.label=Y[7].strings.course),me&64&&(Ne.selected=Y[6]),me&2&&(Ne.readonly=Y[1].references.length>0),c.$set(Ne);const Qe={};me&1&&(Qe.store=Y[0]),me&32&&(Qe.recipients=Y[5]),g.$set(Qe);const Ze={};me&1&&(Ze.store=Y[0]),me&32&&(Ze.recipients=Y[5]),b.$set(Ze),(!ke||me&128&&S!==(S=Y[7].strings.subject))&&m(v,"placeholder",S),(!ke||me&128&&k!==(k=Y[7].strings.subject))&&m(v,"aria-label",k),me&16&&v.value!==Y[4]&&Le(v,Y[4]),(!ke||me&16)&&V(v,"is-invalid",!Y[4].trim()),(!ke||me&4)&&D!==(D=Y[2].editorhtml+"")&&(q.innerHTML=D),(!ke||me&4)&&K!==(K=Y[2].filemanagerhtml+"")&&(z.innerHTML=K),me&32&&(U=Array.from(Y[5].values()).some(cl)),U?ce?ce.p(Y,me):(ce=al(Y),ce.c(),ce.m(i,se)):ce&&(ce.d(1),ce=null),Te===(Te=Ce(Y))&&$e?$e.p(Y,me):($e&&$e.d(1),$e=Te&&Te(Y),$e&&($e.c(),$e.m(i,le))),me&16&&(Q=!Y[4].trim()),Q?be?be.p(Y,me):(be=ol(Y),be.c(),be.m(i,ee)):be&&(be.d(1),be=null),(!ke||me&128)&&x!==(x=Y[7].strings.save+"")&&R(I,x),(!ke||me&128&&N!==(N=Y[7].strings.send))&&m(te,"title",N);const lt={};me&1&&(lt.store=Y[0]),B.$set(lt),(!ke||me&128)&&V(i,"card",Y[7].viewportSize>=fe.LG),Y[1].references.length>0?pe?(pe.p(Y,me),me&2&&C(pe,1)):(pe=fl(Y),pe.c(),C(pe,1),pe.m(Z.parentNode,Z)):pe&&(ne(),L(pe,1,1,()=>{pe=null}),ie())},i(Y){ke||(C(e.$$.fragment,Y),C(r.$$.fragment,Y),C(c.$$.fragment,Y),C(g.$$.fragment,Y),C(b.$$.fragment,Y),C(B.$$.fragment,Y),C(pe),ke=!0)},o(Y){L(e.$$.fragment,Y),L(r.$$.fragment,Y),L(c.$$.fragment,Y),L(g.$$.fragment,Y),L(b.$$.fragment,Y),L(B.$$.fragment,Y),L(pe),ke=!1},d(Y){Y&&(y(t),y(s),y(n),y(i),y(de),y(Z)),H(e,Y),H(r),H(c),H(g),H(b),ce&&ce.d(),$e&&$e.d(),be&&be.d(),H(B),l[16](null),pe&&pe.d(Y),we=!1,Me(ve)}}}const cl=l=>!l.isvalid;function na(l,e,t){let s,n,i,r,a=E,o=()=>(a(),a=ge(f,D=>t(7,r=D)),f);l.$$.on_destroy.push(()=>a());let{store:f}=e;o();let{message:c}=e,{form:u}=e,d;mt(()=>{d==null||d.addEventListener("core_form/uploadChanged",()=>v());const D=g();return()=>{D()}});const g=()=>{let D,A;const z=()=>{A==null||A.options.set("tiny_autosave/plugin:autosaveHasReset",!0),A==null||A.save(),v()},K=U=>{U.command!="mceFocus"&&z()},G=U=>{U.editor.id==`local-mail-compose-editor-${c.id}`&&(A==null||A.off("input",z),A==null||A.off("ExecCommand",K),A=U.editor,U.editor.on("input",z),U.editor.on("ExecCommand",K))};return gt("editor_tiny/loader").then(async U=>{D=await U.getTinyMCE(),D.EditorManager.get().forEach(se=>G({editor:se})),D.EditorManager.on("SetupEditor",G)}),()=>{D==null||D.EditorManager.off("SetupEditor",G),A==null||A.off("input",z),A==null||A.off("ExecCommand",K)}},p=D=>{t(6,s=D||r.courses[0].id),v(),f.navigate({...r.params,courseid:r.params.courseid?s:void 0},!0)},b=(D,A)=>{const z=new Map(i);for(const G of D)A?z.set(G.id,{...G,type:A,isvalid:!0}):z.delete(G.id);const K=Array.from(z.values());K.sort((G,U)=>G.sortorder.localeCompare(U.sortorder)),t(5,i=new Map(K.map(G=>[G.id,G]))),v()},$=D=>{b([D],null)},w=()=>{v(),f.navigateToList()},v=()=>{var z,K,G;if(!d)return;const D=new FormData(d),A={courseid:s,to:Array.from(i.values()).filter(U=>U.type=="to").map(U=>U.id),cc:Array.from(i.values()).filter(U=>U.type=="cc").map(U=>U.id),bcc:Array.from(i.values()).filter(U=>U.type=="bcc").map(U=>U.id),subject:n,content:((z=D.get("content[text]"))==null?void 0:z.toString())||"",format:parseInt(((K=D.get("content[format]"))==null?void 0:K.toString())||"")||1,draftitemid:parseInt(((G=D.get("content[itemid]"))==null?void 0:G.toString())||"")||0};f.updateDraft(A,!1)};function S(){n=this.value,t(4,n),t(1,c)}const k=()=>v(),T=()=>v();function q(D){Se[D?"unshift":"push"](()=>{d=D,t(3,d)})}return l.$$set=D=>{"store"in D&&o(t(0,f=D.store)),"message"in D&&t(1,c=D.message),"form"in D&&t(2,u=D.form)},l.$$.update=()=>{l.$$.dirty&2&&t(6,s=c.course.id),l.$$.dirty&2&&t(4,n=c.subject),l.$$.dirty&2&&t(5,i=new Map(c.recipients.map(D=>[D.id,D])))},[f,c,u,d,n,i,s,r,p,b,$,w,v,S,k,T,q]}class ia extends ae{constructor(e){super(),oe(this,e,na,la,re,{store:0,message:1,form:2})}}function ml(l,e,t){const s=l.slice();return s[7]=e[t],s}function dl(l){let e,t=l[7]+"",s,n;return{c(){e=h("option"),s=P(t),e.__value=n=l[7],Le(e,e.__value)},m(i,r){M(i,e,r),_(e,s)},p(i,r){r&8&&t!==(t=i[7]+"")&&R(s,t),r&8&&n!==(n=i[7])&&(e.__value=n,Le(e,e.__value))},d(i){i&&y(e)}}}function ra(l){let e,t,s,n=l[1].strings.messagesperpage+"",i,r,a,o,f,c,u=ue(l[3]),d=[];for(let g=0;g<u.length;g+=1)d[g]=dl(ml(l,u,g));return{c(){e=h("div"),t=h("div"),s=h("label"),i=P(n),r=P(":"),a=j(),o=h("select");for(let g=0;g<d.length;g+=1)d[g].c();m(s,"for","local-mail-perpage-select"),m(o,"id","local-mail-perpage-select"),m(o,"class","local-mail-perpage-select-select custom-select svelte-vfj9zv"),l[2]===void 0&&Ie(()=>l[4].call(o)),m(t,"class","form-group"),m(e,"class","form-inline justify-content-end mt-3")},m(g,p){M(g,e,p),_(e,t),_(t,s),_(s,i),_(s,r),_(t,a),_(t,o);for(let b=0;b<d.length;b+=1)d[b]&&d[b].m(o,null);tt(o,l[2],!0),f||(c=[W(o,"change",l[4]),W(o,"change",l[5])],f=!0)},p(g,[p]){if(p&2&&n!==(n=g[1].strings.messagesperpage+"")&&R(i,n),p&8){u=ue(g[3]);let b;for(b=0;b<u.length;b+=1){const $=ml(g,u,b);d[b]?d[b].p($,p):(d[b]=dl($),d[b].c(),d[b].m(o,null))}for(;b<d.length;b+=1)d[b].d(1);d.length=u.length}p&12&&tt(o,g[2])},i:E,o:E,d(g){g&&y(e),Ee(d,g),f=!1,Me(c)}}}function aa(l,e,t){let s,n,i=E,r=()=>(i(),i=ge(a,d=>t(1,n=d)),a);l.$$.on_destroy.push(()=>i());let{store:a}=e;r();const o=[5,10,20,50,100];let f=n.preferences.perpage;function c(){f=bt(this),t(2,f),t(3,s),t(1,n)}const u=()=>a.savePreferences({perpage:f});return l.$$set=d=>{"store"in d&&r(t(0,a=d.store))},l.$$.update=()=>{l.$$.dirty&2&&t(3,s=o.includes(n.preferences.perpage)?o:o.concat([n.preferences.perpage]).sort((d,g)=>d-g))},[a,n,f,s,c,u]}class oa extends ae{constructor(e){super(),oe(this,e,aa,ra,re,{store:0})}}function gl(l,e,t){const s=l.slice();return s[9]=e[t],s}function _l(l){let e,t,s=l[4].strings.locked+"",n,i;return{c(){e=h("span"),t=P("("),n=P(s),i=P(")"),m(e,"class","ml-1")},m(r,a){M(r,e,a),_(e,t),_(e,n),_(e,i)},p(r,a){a&16&&s!==(s=r[4].strings.locked+"")&&R(n,s)},d(r){r&&y(e)}}}function pl(l){let e,t,s,n,i,r,a,o=l[9].displayname+"",f,c,u,d,g;function p(){return l[8](l[9])}let b=l[9].locked&&_l(l);return{c(){e=h("div"),t=h("input"),r=j(),a=h("label"),f=P(o),c=j(),b&&b.c(),m(t,"id",s="local-mail-preferences-messageprocessor-"+l[9].name),m(t,"class","custom-control-input"),m(t,"type","checkbox"),t.checked=n=l[9].locked?l[9].enabled:l[3].includes(l[9].name),t.disabled=i=l[9].locked,m(a,"for",u="local-mail-preferences-messageprocessor-"+l[9].name),m(a,"class","custom-control-label pl-1"),m(e,"class","custom-control custom-switch my-2")},m($,w){M($,e,w),_(e,t),_(e,r),_(e,a),_(a,f),_(a,c),b&&b.m(a,null),d||(g=W(t,"click",p),d=!0)},p($,w){l=$,w&16&&s!==(s="local-mail-preferences-messageprocessor-"+l[9].name)&&m(t,"id",s),w&24&&n!==(n=l[9].locked?l[9].enabled:l[3].includes(l[9].name))&&(t.checked=n),w&16&&i!==(i=l[9].locked)&&(t.disabled=i),w&16&&o!==(o=l[9].displayname+"")&&R(f,o),l[9].locked?b?b.p(l,w):(b=_l(l),b.c(),b.m(a,null)):b&&(b.d(1),b=null),w&16&&u!==(u="local-mail-preferences-messageprocessor-"+l[9].name)&&m(a,"for",u)},d($){$&&y(e),b&&b.d(),d=!1,g()}}}function fa(l){let e,t=l[4].strings.notifications+"",s,n,i,r,a,o,f,c,u,d=l[4].strings.markmessagesasread+"",g,p,b,$=ue(l[4].settings.messageprocessors),w=[];for(let v=0;v<$.length;v+=1)w[v]=pl(gl(l,$,v));return{c(){e=h("h6"),s=P(t),n=j();for(let v=0;v<w.length;v+=1)w[v].c();i=j(),r=h("div"),a=h("input"),c=j(),u=h("label"),g=P(d),m(e,"class","mb-3"),m(a,"id","local-mail-preferences-markasread"),m(a,"class","custom-control-input"),m(a,"type","checkbox"),a.checked=o=l[2]&&l[3].length>0,a.disabled=f=l[3].length==0,m(u,"for","local-mail-preferences-markasread"),m(u,"class","custom-control-label pl-1"),m(r,"class","custom-control custom-switch my-2 mt-3")},m(v,S){M(v,e,S),_(e,s),M(v,n,S);for(let k=0;k<w.length;k+=1)w[k]&&w[k].m(v,S);M(v,i,S),M(v,r,S),_(r,a),_(r,c),_(r,u),_(u,g),p||(b=W(a,"click",l[6]),p=!0)},p(v,S){if(S&16&&t!==(t=v[4].strings.notifications+"")&&R(s,t),S&152){$=ue(v[4].settings.messageprocessors);let k;for(k=0;k<$.length;k+=1){const T=gl(v,$,k);w[k]?w[k].p(T,S):(w[k]=pl(T),w[k].c(),w[k].m(i.parentNode,i))}for(;k<w.length;k+=1)w[k].d(1);w.length=$.length}S&12&&o!==(o=v[2]&&v[3].length>0)&&(a.checked=o),S&8&&f!==(f=v[3].length==0)&&(a.disabled=f),S&16&&d!==(d=v[4].strings.markmessagesasread+"")&&R(g,d)},d(v){v&&(y(e),y(n),y(i),y(r)),Ee(w,v),p=!1,b()}}}function ua(l){let e,t;return e=new Xe({props:{title:l[4].strings.preferences,confirmText:l[4].strings.save,cancelText:l[4].strings.cancel,onConfirm:l[5],onCancel:l[1],$$slots:{default:[fa]},$$scope:{ctx:l}}}),{c(){J(e.$$.fragment)},m(s,n){O(e,s,n),t=!0},p(s,[n]){const i={};n&16&&(i.title=s[4].strings.preferences),n&16&&(i.confirmText=s[4].strings.save),n&16&&(i.cancelText=s[4].strings.cancel),n&2&&(i.onCancel=s[1]),n&4124&&(i.$$scope={dirty:n,ctx:s}),e.$set(i)},i(s){t||(C(e.$$.fragment,s),t=!0)},o(s){L(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function ca(l,e,t){let s,n=E,i=()=>(n(),n=ge(r,p=>t(4,s=p)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{onCancel:a}=e,o=s.preferences.markasread,f=s.settings.messageprocessors.map(p=>p.name).filter(p=>s.preferences.notifications.includes(p));const c=()=>{a(),r.savePreferences({markasread:o,notifications:f})},u=()=>{t(2,o=!o)},d=p=>{t(3,f=f.includes(p)?f.filter(b=>b!=p):[...f,p])},g=p=>d(p.name);return l.$$set=p=>{"store"in p&&i(t(0,r=p.store)),"onCancel"in p&&t(1,a=p.onCancel)},[r,a,o,f,s,c,u,d,g]}class ma extends ae{constructor(e){super(),oe(this,e,ca,ua,re,{store:0,onCancel:1})}}function da(l){let e,t,s,n;return{c(){e=h("button"),t=h("i"),m(t,"class","fa fa-fw fa-question-circle text-info"),m(t,"role","img"),m(t,"title",s=l[2].strings.help),m(e,"type","button"),m(e,"class","btn btn-help p-0"),m(e,"data-container","body"),m(e,"data-toggle","popover"),m(e,"data-placement","top"),m(e,"data-content",l[1]),m(e,"data-trigger","focus"),m(e,"aria-label",n=l[2].strings.help)},m(i,r){M(i,e,r),_(e,t)},p(i,[r]){r&4&&s!==(s=i[2].strings.help)&&m(t,"title",s),r&2&&m(e,"data-content",i[1]),r&4&&n!==(n=i[2].strings.help)&&m(e,"aria-label",n)},i:E,o:E,d(i){i&&y(e)}}}function ga(l,e,t){let s,n=E,i=()=>(n(),n=ge(r,o=>t(2,s=o)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();let{message:a}=e;return l.$$set=o=>{"store"in o&&i(t(0,r=o.store)),"message"in o&&t(1,a=o.message)},[r,a,s]}class _a extends ae{constructor(e){super(),oe(this,e,ga,da,re,{store:0,message:1})}}function pa(l){let e,t,s,n=l[8].strings.searchfrom+"",i,r,a,o,f,c,u,d=l[8].strings.searchto+"",g,p,b,$,w,v,S,k=l[8].strings.searchdate+"",T,q,D,A,z,K,G,U,se,le,Q,ee,F=l[8].strings.searchunreadonly+"",te,x,I,N,X,B,de=l[8].strings.searchhasattachments+"",Z,ke,we,ve=l[8].strings.search+"",ce,Ce,Te,$e;return D=new _a({props:{store:l[4],message:l[8].strings.searchdatehelp}}),{c(){e=h("div"),t=h("div"),s=h("label"),i=P(n),r=j(),a=h("div"),o=h("input"),f=j(),c=h("div"),u=h("label"),g=P(d),p=j(),b=h("div"),$=h("input"),w=j(),v=h("div"),S=h("label"),T=P(k),q=j(),J(D.$$.fragment),A=j(),z=h("div"),K=h("input"),G=j(),U=h("div"),se=h("div"),le=h("input"),Q=j(),ee=h("label"),te=P(F),x=j(),I=h("div"),N=h("input"),X=j(),B=h("label"),Z=P(de),ke=j(),we=h("button"),ce=P(ve),m(s,"for","local-mail-search-input-sendername"),m(s,"class","col-4 col-form-label pr-0"),m(o,"type","text"),m(o,"class","form-control"),m(o,"id","local-mail-search-input-sendername"),m(a,"class","col-8"),m(t,"class","form-group row"),m(u,"for","local-mail-search-input-recipientname"),m(u,"class","col-4 col-form-label pr-0"),m($,"type","text"),m($,"class","form-control"),m($,"id","local-mail-search-input-recipientname"),m(b,"class","col-8 p"),m(c,"class","form-group row"),m(S,"for","local-mail-search-input-maxdate"),m(S,"class","col-4 col-form-label pr-0"),m(K,"type","date"),m(K,"class","form-control"),m(K,"id","local-mail-search-input-maxdate"),m(K,"max",l[9]),K.value=l[7],m(z,"class","col-8"),m(v,"class","form-group row"),m(le,"class","form-check-input"),m(le,"type","checkbox"),m(le,"id","local-mail-search-input-unread"),m(ee,"class","form-check-label"),m(ee,"for","local-mail-search-input-unread"),m(se,"class","form-check"),m(N,"class","form-check-input"),m(N,"type","checkbox"),m(N,"id","local-mail-search-input-withfilesonly"),m(B,"class","form-check-label"),m(B,"for","local-mail-search-input-withfilesonly"),m(I,"class","form-check"),m(we,"type","button"),m(we,"class","btn btn-primary px-3 ml-auto"),m(U,"class","d-flex flex-wrap align-items-center"),he(U,"column-gap","2rem"),he(U,"row-gap","1rem"),m(e,"class","dropdown-menu show p-3 w-100"),he(e,"min-width","18rem")},m(be,pe){M(be,e,pe),_(e,t),_(t,s),_(s,i),_(t,r),_(t,a),_(a,o),Le(o,l[0]),l[16](o),_(e,f),_(e,c),_(c,u),_(u,g),_(c,p),_(c,b),_(b,$),Le($,l[1]),_(e,w),_(e,v),_(v,S),_(S,T),_(S,q),O(D,S,null),_(v,A),_(v,z),_(z,K),_(e,G),_(e,U),_(U,se),_(se,le),le.checked=l[2],_(se,Q),_(se,ee),_(ee,te),_(U,x),_(U,I),_(I,N),N.checked=l[3],_(I,X),_(I,B),_(B,Z),_(U,ke),_(U,we),_(we,ce),Ce=!0,Te||($e=[W(o,"input",l[15]),W(o,"keyup",l[11]),W($,"input",l[17]),W($,"keyup",l[11]),W(K,"input",l[10]),W(K,"keyup",l[11]),W(le,"change",l[18]),W(le,"keyup",l[11]),W(N,"change",l[19]),W(N,"keyup",l[11]),W(we,"click",function(){De(l[5])&&l[5].apply(this,arguments)}),W(we,"keyup",l[11])],Te=!0)},p(be,[pe]){l=be,(!Ce||pe&256)&&n!==(n=l[8].strings.searchfrom+"")&&R(i,n),pe&1&&o.value!==l[0]&&Le(o,l[0]),(!Ce||pe&256)&&d!==(d=l[8].strings.searchto+"")&&R(g,d),pe&2&&$.value!==l[1]&&Le($,l[1]),(!Ce||pe&256)&&k!==(k=l[8].strings.searchdate+"")&&R(T,k);const Y={};pe&16&&(Y.store=l[4]),pe&256&&(Y.message=l[8].strings.searchdatehelp),D.$set(Y),(!Ce||pe&128)&&(K.value=l[7]),pe&4&&(le.checked=l[2]),(!Ce||pe&256)&&F!==(F=l[8].strings.searchunreadonly+"")&&R(te,F),pe&8&&(N.checked=l[3]),(!Ce||pe&256)&&de!==(de=l[8].strings.searchhasattachments+"")&&R(Z,de),(!Ce||pe&256)&&ve!==(ve=l[8].strings.search+"")&&R(ce,ve)},i(be){Ce||(C(D.$$.fragment,be),Ce=!0)},o(be){L(D.$$.fragment,be),Ce=!1},d(be){be&&y(e),l[16](null),H(D),Te=!1,Me($e)}}}function ba(l,e,t){let s,n,i=E,r=()=>(i(),i=ge(a,z=>t(8,n=z)),a);l.$$.on_destroy.push(()=>i());let{store:a}=e;r();let{sendername:o=""}=e,{recipientname:f=""}=e,{unread:c=!1}=e,{withfilesonly:u=!1}=e,{maxtime:d=0}=e,{onSubmit:g}=e,{onCancel:p}=e;function b(){$.focus()}let $,w=qt(Math.floor(new Date().getTime()/1e3));const v=z=>{t(12,d=Ln(z.target.value))},S=z=>{z.key=="Enter"?g():z.key=="Escape"&&p()};function k(){o=this.value,t(0,o)}function T(z){Se[z?"unshift":"push"](()=>{$=z,t(6,$)})}function q(){f=this.value,t(1,f)}function D(){c=this.checked,t(2,c)}function A(){u=this.checked,t(3,u)}return l.$$set=z=>{"store"in z&&r(t(4,a=z.store)),"sendername"in z&&t(0,o=z.sendername),"recipientname"in z&&t(1,f=z.recipientname),"unread"in z&&t(2,c=z.unread),"withfilesonly"in z&&t(3,u=z.withfilesonly),"maxtime"in z&&t(12,d=z.maxtime),"onSubmit"in z&&t(5,g=z.onSubmit),"onCancel"in z&&t(13,p=z.onCancel)},l.$$.update=()=>{l.$$.dirty&4096&&t(7,s=qt(d))},[o,f,c,u,a,g,$,s,n,w,v,S,d,p,b,k,T,q,D,A]}class ha extends ae{constructor(e){super(),oe(this,e,ba,pa,re,{store:4,sendername:0,recipientname:1,unread:2,withfilesonly:3,maxtime:12,onSubmit:5,onCancel:13,focus:14})}get focus(){return this.$$.ctx[14]}}const{Boolean:ka}=rt;function bl(l,e,t){const s=l.slice();return s[14]=e[t],s[16]=t,s}function hl(l){let e,t,s,n=ue(l[4]),i=[];for(let c=0;c<n.length;c+=1)i[c]=kl(bl(l,n,c));const r=c=>L(i[c],1,1,()=>{i[c]=null});function a(c,u){if(c[5])return $a;if(!c[4].length)return wa}let o=a(l),f=o&&o(l);return{c(){e=h("div");for(let c=0;c<i.length;c+=1)i[c].c();t=j(),f&&f.c(),m(e,"class","dropdown-menu overflow-hidden show p-0 w-100"),he(e,"min-width","18rem")},m(c,u){M(c,e,u);for(let d=0;d<i.length;d+=1)i[d]&&i[d].m(e,null);_(e,t),f&&f.m(e,null),s=!0},p(c,u){if(u&401){n=ue(c[4]);let d;for(d=0;d<n.length;d+=1){const g=bl(c,n,d);i[d]?(i[d].p(g,u),C(i[d],1)):(i[d]=kl(g),i[d].c(),C(i[d],1),i[d].m(e,t))}for(ne(),d=n.length;d<i.length;d+=1)r(d);ie()}o===(o=a(c))&&f?f.p(c,u):(f&&f.d(1),f=o&&o(c),f&&(f.c(),f.m(e,null)))},i(c){if(!s){for(let u=0;u<n.length;u+=1)C(i[u]);s=!0}},o(c){i=i.filter(ka);for(let u=0;u<i.length;u+=1)L(i[u]);s=!1},d(c){c&&y(e),Ee(i,c),f&&f.d()}}}function va(l){let e;return{c(){e=h("div"),m(e,"class","dropdown-divider my-0")},m(t,s){M(t,e,s)},d(t){t&&y(e)}}}function kl(l){let e,t,s,n,i,r,a,o,f=l[14].shorttime+"",c,u,d,g,p,b,$=l[16]>0&&va();return s=new $t({props:{store:l[0],message:l[14]}}),r=new wt({props:{store:l[0],message:l[14]}}),{c(){$&&$.c(),e=j(),t=h("a"),J(s.$$.fragment),n=j(),i=h("div"),J(r.$$.fragment),a=j(),o=h("div"),c=P(f),m(o,"title",u=l[14].fulltime),m(o,"class","ml-auto"),m(i,"class","local-mail-incremental-search-muted d-flex svelte-sdeam0"),m(t,"class","dropdown-item local-mail-incremental-search-item"),m(t,"href",d=Oe(l[7](l[14],l[16]))),V(t,"font-weight-bold",l[14].unread)},m(w,v){$&&$.m(w,v),M(w,e,v),M(w,t,v),O(s,t,null),_(t,n),_(t,i),O(r,i,null),_(i,a),_(i,o),_(o,c),g=!0,p||(b=W(t,"click",function(){De(l[8](l[14],l[16]))&&l[8](l[14],l[16]).apply(this,arguments)}),p=!0)},p(w,v){l=w;const S={};v&1&&(S.store=l[0]),v&16&&(S.message=l[14]),s.$set(S);const k={};v&1&&(k.store=l[0]),v&16&&(k.message=l[14]),r.$set(k),(!g||v&16)&&f!==(f=l[14].shorttime+"")&&R(c,f),(!g||v&16&&u!==(u=l[14].fulltime))&&m(o,"title",u),(!g||v&144&&d!==(d=Oe(l[7](l[14],l[16]))))&&m(t,"href",d),(!g||v&16)&&V(t,"font-weight-bold",l[14].unread)},i(w){g||(C(s.$$.fragment,w),C(r.$$.fragment,w),g=!0)},o(w){L(s.$$.fragment,w),L(r.$$.fragment,w),g=!1},d(w){w&&(y(e),y(t)),$&&$.d(w),H(s),H(r),p=!1,b()}}}function wa(l){let e,t=l[3].strings.nomessagesfound+"",s;return{c(){e=h("div"),s=P(t),m(e,"class","px-4 py-2 text-danger")},m(n,i){M(n,e,i),_(e,s)},p(n,i){i&8&&t!==(t=n[3].strings.nomessagesfound+"")&&R(s,t)},d(n){n&&y(e)}}}function $a(l){let e,t,s,n=l[3].strings.searchallmessages+"",i,r,a,o;return{c(){e=h("div"),t=j(),s=h("a"),i=P(n),m(e,"class","dropdown-divider my-0"),m(s,"class","dropdown-item py-2"),m(s,"href",r=Oe(l[6]))},m(f,c){M(f,e,c),M(f,t,c),M(f,s,c),_(s,i),a||(o=W(s,"click",Ae(l[12])),a=!0)},p(f,c){c&8&&n!==(n=f[3].strings.searchallmessages+"")&&R(i,n),c&64&&r!==(r=Oe(f[6]))&&m(s,"href",r)},d(f){f&&(y(e),y(t),y(s)),a=!1,o()}}}function ya(l){let e,t,s=l[1]&&l[4]!=null&&hl(l);return{c(){s&&s.c(),e=_e()},m(n,i){s&&s.m(n,i),M(n,e,i),t=!0},p(n,[i]){n[1]&&n[4]!=null?s?(s.p(n,i),i&18&&C(s,1)):(s=hl(n),s.c(),C(s,1),s.m(e.parentNode,e)):s&&(ne(),L(s,1,1,()=>{s=null}),ie())},i(n){t||(C(s),t=!0)},o(n){L(s),t=!1},d(n){n&&y(e),s&&s.d(n)}}}const pt=10,Ma=500;function Ca(l,e,t){let s,n,i,r=E,a=()=>(r(),r=ge(o,S=>t(3,i=S)),o);l.$$.on_destroy.push(()=>r());let{store:o}=e;a();let{enabled:f}=e,{content:c}=e,{loading:u=!1}=e,{onClick:d}=e,g,p,b=!1;const $=async S=>{t(9,u=!0),window.clearTimeout(g),t(11,g=window.setTimeout(async()=>{const k=i.params,q={methodname:"search_messages",query:{courseid:k.courseid,labelid:k.tray=="label"?k.labelid:void 0,draft:k.tray=="drafts"?!0:k.tray=="sent"?!1:void 0,roles:k.tray=="inbox"?Object.values(Be):k.tray=="sent"?["from"]:void 0,starred:k.tray=="starred"?!0:void 0,deleted:k.tray=="trash",content:S.trim(),stopid:i.incrementalSearchStopId},limit:pt+1};let D;try{D=await St([q])}catch(A){o.setError(A);return}D!=null&&(t(9,u=!1),t(4,p=D[0]),t(5,b=p.length>pt||!!i.incrementalSearchStopId),t(4,p=p.slice(0,pt)))},Ma))},w=(S,k)=>T=>{S.draft||(T.preventDefault(),d(s(S,k)))};ht(()=>{window.clearTimeout(g)});const v=()=>d(n);return l.$$set=S=>{"store"in S&&a(t(0,o=S.store)),"enabled"in S&&t(1,f=S.enabled),"content"in S&&t(10,c=S.content),"loading"in S&&t(9,u=S.loading),"onClick"in S&&t(2,d=S.onClick)},l.$$.update=()=>{l.$$.dirty&3074&&(f?$(c):(t(4,p=void 0),t(9,u=!1),window.clearTimeout(g))),l.$$.dirty&1032&&t(7,s=(S,k)=>({...i.params,messageid:S.id,offset:k,search:{content:c.trim()}})),l.$$.dirty&1032&&t(6,n={...i.params,messageid:void 0,offset:0,search:{content:c.trim()}})},[o,f,d,i,p,b,n,s,w,u,c,g,v]}class Sa extends ae{constructor(e){super(),oe(this,e,Ca,ya,re,{store:0,enabled:1,content:10,loading:9,onClick:2})}}function vl(l,e,t){const s=l.slice();return s[34]=e[t].label,s[35]=e[t].value,s[37]=t,s}function wl(l){let e,t,s,n,i,r,a;function o(p){l[25](p)}function f(p){l[26](p)}function c(p){l[27](p)}function u(p){l[28](p)}function d(p){l[29](p)}let g={store:l[0],onSubmit:l[15]?l[20]:l[19],onCancel:l[19]};return l[2]!==void 0&&(g.sendername=l[2]),l[3]!==void 0&&(g.recipientname=l[3]),l[4]!==void 0&&(g.unread=l[4]),l[5]!==void 0&&(g.withfilesonly=l[5]),l[6]!==void 0&&(g.maxtime=l[6]),e=new ha({props:g}),l[24](e),Se.push(()=>Ge(e,"sendername",o)),Se.push(()=>Ge(e,"recipientname",f)),Se.push(()=>Ge(e,"unread",c)),Se.push(()=>Ge(e,"withfilesonly",u)),Se.push(()=>Ge(e,"maxtime",d)),{c(){J(e.$$.fragment)},m(p,b){O(e,p,b),a=!0},p(p,b){const $={};b[0]&1&&($.store=p[0]),b[0]&32768&&($.onSubmit=p[15]?p[20]:p[19]),!t&&b[0]&4&&(t=!0,$.sendername=p[2],Ue(()=>t=!1)),!s&&b[0]&8&&(s=!0,$.recipientname=p[3],Ue(()=>s=!1)),!n&&b[0]&16&&(n=!0,$.unread=p[4],Ue(()=>n=!1)),!i&&b[0]&32&&(i=!0,$.withfilesonly=p[5],Ue(()=>i=!1)),!r&&b[0]&64&&(r=!0,$.maxtime=p[6],Ue(()=>r=!1)),e.$set($)},i(p){a||(C(e.$$.fragment,p),a=!0)},o(p){L(e.$$.fragment,p),a=!1},d(p){l[24](null),H(e,p)}}}function $l(l){let e,t,s;function n(r){l[30](r)}let i={store:l[0],enabled:l[8]&&!l[9]&&!!l[1].trim(),content:l[1],onClick:l[21]};return l[12]!==void 0&&(i.loading=l[12]),e=new Sa({props:i}),Se.push(()=>Ge(e,"loading",n)),{c(){J(e.$$.fragment)},m(r,a){O(e,r,a),s=!0},p(r,a){const o={};a[0]&1&&(o.store=r[0]),a[0]&770&&(o.enabled=r[8]&&!r[9]&&!!r[1].trim()),a[0]&2&&(o.content=r[1]),!t&&a[0]&4096&&(t=!0,o.loading=r[12],Ue(()=>t=!1)),e.$set(o)},i(r){s||(C(e.$$.fragment,r),s=!0)},o(r){L(e.$$.fragment,r),s=!1},d(r){H(e,r)}}}function Da(l){let e,t,s,n=l[9]&&wl(l),i=l[7].settings.incrementalsearch&&$l(l);return{c(){n&&n.c(),e=j(),i&&i.c(),t=_e()},m(r,a){n&&n.m(r,a),M(r,e,a),i&&i.m(r,a),M(r,t,a),s=!0},p(r,a){r[9]?n?(n.p(r,a),a[0]&512&&C(n,1)):(n=wl(r),n.c(),C(n,1),n.m(e.parentNode,e)):n&&(ne(),L(n,1,1,()=>{n=null}),ie()),r[7].settings.incrementalsearch?i?(i.p(r,a),a[0]&128&&C(i,1)):(i=$l(r),i.c(),C(i,1),i.m(t.parentNode,t)):i&&(ne(),L(i,1,1,()=>{i=null}),ie())},i(r){s||(C(n),C(i),s=!0)},o(r){L(n),L(i),s=!1},d(r){r&&(y(e),y(t)),n&&n.d(r),i&&i.d(r)}}}function Ta(l){let e;return{c(){e=h("span"),e.textContent=",â",m(e,"class","dimmed_text")},m(t,s){M(t,e,s)},d(t){t&&y(e)}}}function La(l){let e,t=l[35]+"",s,n=l[34]&&yl(l);return{c(){n&&n.c(),e=j(),s=P(t)},m(i,r){n&&n.m(i,r),M(i,e,r),M(i,s,r)},p(i,r){i[34]?n?n.p(i,r):(n=yl(i),n.c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null),r[0]&16384&&t!==(t=i[35]+"")&&R(s,t)},d(i){i&&(y(e),y(s)),n&&n.d(i)}}}function ja(l){let e,t=l[34]+"",s;return{c(){e=h("span"),s=P(t),m(e,"class","dimmed_text")},m(n,i){M(n,e,i),_(e,s)},p(n,i){i[0]&16384&&t!==(t=n[34]+"")&&R(s,t)},d(n){n&&y(e)}}}function yl(l){let e,t=l[34]+"",s,n;return{c(){e=h("span"),s=P(t),n=P(":"),m(e,"class","dimmed_text")},m(i,r){M(i,e,r),_(e,s),_(e,n)},p(i,r){r[0]&16384&&t!==(t=i[34]+"")&&R(s,t)},d(i){i&&y(e)}}}function Ml(l){let e,t,s=l[37]>0&&Ta();function n(a,o){return a[35]===!0?ja:La}let i=n(l),r=i(l);return{c(){s&&s.c(),e=j(),r.c(),t=_e()},m(a,o){s&&s.m(a,o),M(a,e,o),r.m(a,o),M(a,t,o)},p(a,o){i===(i=n(a))&&r?r.p(a,o):(r.d(1),r=i(a),r&&(r.c(),r.m(t.parentNode,t)))},d(a){a&&(y(e),y(t)),s&&s.d(a),r.d(a)}}}function za(l){let e,t=ue(l[14]),s=[];for(let n=0;n<t.length;n+=1)s[n]=Ml(vl(l,t,n));return{c(){e=h("span");for(let n=0;n<s.length;n+=1)s[n].c();m(e,"slot","buttonContent")},m(n,i){M(n,e,i);for(let r=0;r<s.length;r+=1)s[r]&&s[r].m(e,null)},p(n,i){if(i[0]&16384){t=ue(n[14]);let r;for(r=0;r<t.length;r+=1){const a=vl(n,t,r);s[r]?s[r].p(a,i):(s[r]=Ml(a),s[r].c(),s[r].m(e,null))}for(;r<s.length;r+=1)s[r].d(1);s.length=t.length}},d(n){n&&y(e),Ee(s,n)}}}function Na(l){let e,t,s;function n(r){l[32](r)}let i={mode:l[8]?"input":"button",inputPlaceholder:l[7].strings.search,leftIconClass:l[12]?"fa-spinner fa-pulse":"fa-search",rightIconClass:l[9]?"fa-caret-up":"fa-sliders",rightIconLabel:l[7].strings.searchoptions,middleIconClass:l[13]||l[15]?"fa-times":void 0,middleIconLabel:l[7].strings.clearsearch,buttonClass:"alert alert-primary",onBlur:l[17],onEnter:l[15]?l[20]:l[19],onRightIconClick:l[18],onMiddleIconClick:l[19],onButtonClick:l[16],$$slots:{buttonContent:[za],default:[Da]},$$scope:{ctx:l}};return l[1]!==void 0&&(i.inputText=l[1]),e=new Wl({props:i}),l[31](e),Se.push(()=>Ge(e,"inputText",n)),{c(){J(e.$$.fragment)},m(r,a){O(e,r,a),s=!0},p(r,a){const o={};a[0]&256&&(o.mode=r[8]?"input":"button"),a[0]&128&&(o.inputPlaceholder=r[7].strings.search),a[0]&4096&&(o.leftIconClass=r[12]?"fa-spinner fa-pulse":"fa-search"),a[0]&512&&(o.rightIconClass=r[9]?"fa-caret-up":"fa-sliders"),a[0]&128&&(o.rightIconLabel=r[7].strings.searchoptions),a[0]&40960&&(o.middleIconClass=r[13]||r[15]?"fa-times":void 0),a[0]&128&&(o.middleIconLabel=r[7].strings.clearsearch),a[0]&32768&&(o.onEnter=r[15]?r[20]:r[19]),a[0]&56319|a[1]&128&&(o.$$scope={dirty:a,ctx:r}),!t&&a[0]&2&&(t=!0,o.inputText=r[1],Ue(()=>t=!1)),e.$set(o)},i(r){s||(C(e.$$.fragment,r),s=!0)},o(r){L(e.$$.fragment,r),s=!1},d(r){l[31](null),H(e,r)}}}function qa(l,e,t){let s,n,i,r,a,o,f=E,c=()=>(f(),f=ge(u,B=>t(7,o=B)),u);l.$$.on_destroy.push(()=>f());let{store:u}=e;c();let d=!o.params.search,g=!1,p,b,$="",w="",v="",S=!1,k=!1,T=0,q=!1;const D=B=>{t(1,$=(B==null?void 0:B.content)||""),t(2,w=(B==null?void 0:B.sendername)||""),t(3,v=(B==null?void 0:B.recipientname)||""),t(4,S=(B==null?void 0:B.unread)||!1),t(5,k=(B==null?void 0:B.withfilesonly)||!1),t(6,T=(B==null?void 0:B.maxtime)||0)},A=async()=>{t(8,d=!0),n&&t(9,g=!0),await nt(),p.focus()},z=async()=>{t(8,d=!i),t(9,g=!1),D(s)},K=async()=>{g?(t(9,g=!1),await nt(),p.focus()):(t(8,d=!0),t(9,g=!0),await nt(),b.focus())},G=async()=>{t(8,d=!0),t(9,g=!1),D(),await u.navigate({...o.params,offset:void 0,search:void 0}),await nt(),p.focus()},U=async()=>{await u.navigate({...o.params,messageid:void 0,offset:void 0,search:g?{content:$.trim(),sendername:w.trim(),recipientname:v.trim(),unread:S,withfilesonly:k,maxtime:T}:{content:$.trim()}}),t(9,g=!1),t(8,d=!1)},se=async B=>{await u.navigate(B),t(9,g=!1),t(8,d=!1)};function le(B){Se[B?"unshift":"push"](()=>{b=B,t(11,b)})}function Q(B){w=B,t(2,w)}function ee(B){v=B,t(3,v)}function F(B){S=B,t(4,S)}function te(B){k=B,t(5,k)}function x(B){T=B,t(6,T)}function I(B){q=B,t(12,q)}function N(B){Se[B?"unshift":"push"](()=>{p=B,t(10,p)})}function X(B){$=B,t(1,$)}return l.$$set=B=>{"store"in B&&c(t(0,u=B.store))},l.$$.update=()=>{l.$$.dirty[0]&128&&t(22,s=o.params.search),l.$$.dirty[0]&4194304&&D(s),l.$$.dirty[0]&4194304&&t(23,n=!!(s!=null&&s.sendername||s!=null&&s.recipientname||s!=null&&s.unread||s!=null&&s.withfilesonly||s!=null&&s.maxtime)),l.$$.dirty[0]&12582912&&t(13,i=!!(s!=null&&s.content)||n),l.$$.dirty[0]&126&&t(15,r=!!($.trim()||w.trim()||v.trim()||S||k||T)),l.$$.dirty[0]&254&&t(14,a=[{label:"",value:$},{label:o.strings.searchfrom,value:w},{label:o.strings.searchto,value:v},{label:o.strings.searchdate,value:T>0?new Date(T*1e3).toLocaleDateString():""},{label:o.strings.searchunreadonly,value:S},{label:o.strings.searchhasattachments,value:k}].filter(({value:B})=>!!B))},[u,$,w,v,S,k,T,o,d,g,p,b,q,i,a,r,A,z,K,G,U,se,s,n,le,Q,ee,F,te,x,I,N,X]}class Ia extends ae{constructor(e){super(),oe(this,e,qa,Na,re,{store:0},null,[-1,-1])}}function Cl(l,e,t){const s=l.slice();return s[4]=e[t],s}function Sl(l){let e,t=l[1].strings.undo+"",s,n,i;function r(){return l[2](l[4])}return{c(){e=h("button"),s=P(t),m(e,"type","button"),m(e,"class","local-mail-toast-undo btn font-weight-bold px-2 py-0 ml-3 svelte-5dhscv")},m(a,o){M(a,e,o),_(e,s),n||(i=W(e,"click",r),n=!0)},p(a,o){l=a,o&2&&t!==(t=l[1].strings.undo+"")&&R(s,t)},d(a){a&&y(e),n=!1,i()}}}function Dl(l,e){let t,s,n,i=e[4].text+"",r,a,o,f,c,u,d,g,p,b,$=E,w,v,S,k=e[4].undo&&Sl(e);function T(){return e[3](e[4])}return{key:l,first:null,c(){t=h("div"),s=h("div"),n=h("div"),r=P(i),a=j(),k&&k.c(),o=j(),f=h("button"),c=h("i"),d=j(),m(n,"class","px-1 mr-auto"),m(c,"class","fa fa-times"),m(f,"type","button"),m(f,"class","btn px-2 py-0 ml-2"),m(f,"title",u=e[1].strings.close),m(s,"class","toast-body d-flex align-items-center p-2"),m(t,"class","toast mt-2 mb-0 show svelte-5dhscv"),m(t,"role","alert"),m(t,"aria-live","assertive"),m(t,"aria-atomic","true"),m(t,"data-autohide","false"),this.first=t},m(q,D){M(q,t,D),_(t,s),_(s,n),_(n,r),_(s,a),k&&k.m(s,null),_(s,o),_(s,f),_(f,c),_(t,d),w=!0,v||(S=W(f,"click",T),v=!0)},p(q,D){e=q,(!w||D&2)&&i!==(i=e[4].text+"")&&R(r,i),e[4].undo?k?k.p(e,D):(k=Sl(e),k.c(),k.m(s,o)):k&&(k.d(1),k=null),(!w||D&2&&u!==(u=e[1].strings.close))&&m(f,"title",u)},r(){b=t.getBoundingClientRect()},f(){xl(t),$(),vt(t,b)},a(){$(),$=Zl(t,b,un,{})},i(q){w||(Ie(()=>{w&&(p&&p.end(1),g=kt(t,ct,{y:50,delay:200}),g.start())}),w=!0)},o(q){g&&g.invalidate(),p=Kl(t,ct,{y:50,duration:400}),w=!1},d(q){q&&y(t),k&&k.d(),q&&p&&p.end(),v=!1,S()}}}function Aa(l){let e,t=[],s=new Map,n,i=ue(l[1].toasts);const r=a=>a[4];for(let a=0;a<i.length;a+=1){let o=Cl(l,i,a),f=r(o);s.set(f,t[a]=Dl(f,o))}return{c(){e=h("div");for(let a=0;a<t.length;a+=1)t[a].c();m(e,"aria-live","polite"),m(e,"aria-atomic","true"),m(e,"class","local-mail-toasts position-fixed d-flex flex-column-reverse p-3 svelte-5dhscv")},m(a,o){M(a,e,o);for(let f=0;f<t.length;f+=1)t[f]&&t[f].m(e,null);n=!0},p(a,[o]){if(o&3){i=ue(a[1].toasts),ne();for(let f=0;f<t.length;f+=1)t[f].r();t=je(t,o,r,1,a,i,s,e,Jl,Dl,null,Cl);for(let f=0;f<t.length;f+=1)t[f].a();ie()}},i(a){if(!n){for(let o=0;o<i.length;o+=1)C(t[o]);n=!0}},o(a){for(let o=0;o<t.length;o+=1)L(t[o]);n=!1},d(a){a&&y(e);for(let o=0;o<t.length;o+=1)t[o].d()}}}function Ba(l,e,t){let s,n=E,i=()=>(n(),n=ge(r,f=>t(1,s=f)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();const a=f=>r.undo(f),o=f=>r.hideToast(f);return l.$$set=f=>{"store"in f&&i(t(0,r=f.store))},[r,s,a,o]}class Pa extends ae{constructor(e){super(),oe(this,e,Ba,Aa,re,{store:0})}}function Ea(l){let e,t,s,n,i;return{c(){e=h("button"),t=h("i"),m(t,"class","fa fa fa-fw fa-arrow-left"),m(e,"type","button"),m(e,"class","local-mail-back-button btn btn-secondary svelte-h5ths1"),m(e,"title",s=l[1].strings.messagelist)},m(r,a){M(r,e,a),_(e,t),n||(i=W(e,"click",l[2]),n=!0)},p(r,[a]){a&2&&s!==(s=r[1].strings.messagelist)&&m(e,"title",s)},i:E,o:E,d(r){r&&y(e),n=!1,i()}}}function Ra(l,e,t){let s,n=E,i=()=>(n(),n=ge(r,o=>t(1,s=o)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();const a=()=>r.navigateToList();return l.$$set=o=>{"store"in o&&i(t(0,r=o.store))},[r,s,a]}class Fa extends ae{constructor(e){super(),oe(this,e,Ra,Ea,re,{store:0})}}function Tl(l){let e,t,s=l[1].strings.all+"",n,i,r,a=l[1].strings.none+"",o,f,c,u=l[1].strings.read+"",d,g,p,b=l[1].strings.unread+"",$,w,v,S=l[1].strings.starred+"",k,T,q,D=l[1].strings.unstarred+"",A,z,K;return{c(){e=h("div"),t=h("button"),n=P(s),i=j(),r=h("button"),o=P(a),f=j(),c=h("button"),d=P(u),g=j(),p=h("button"),$=P(b),w=j(),v=h("button"),k=P(S),T=j(),q=h("button"),A=P(D),m(t,"type","button"),m(t,"class","dropdown-item"),m(r,"type","button"),m(r,"class","dropdown-item"),m(c,"type","button"),m(c,"class","dropdown-item"),m(p,"type","button"),m(p,"class","dropdown-item"),m(v,"type","button"),m(v,"class","dropdown-item"),m(q,"type","button"),m(q,"class","dropdown-item"),m(e,"class","dropdown-menu show")},m(G,U){M(G,e,U),_(e,t),_(t,n),_(e,i),_(e,r),_(r,o),_(e,f),_(e,c),_(c,d),_(e,g),_(e,p),_(p,$),_(e,w),_(e,v),_(v,k),_(e,T),_(e,q),_(q,A),z||(K=[W(t,"click",l[7]),W(r,"click",l[8]),W(c,"click",l[9]),W(p,"click",l[10]),W(v,"click",l[11]),W(q,"click",l[12])],z=!0)},p(G,U){U&2&&s!==(s=G[1].strings.all+"")&&R(n,s),U&2&&a!==(a=G[1].strings.none+"")&&R(o,a),U&2&&u!==(u=G[1].strings.read+"")&&R(d,u),U&2&&b!==(b=G[1].strings.unread+"")&&R($,b),U&2&&S!==(S=G[1].strings.starred+"")&&R(k,S),U&2&&D!==(D=G[1].strings.unstarred+"")&&R(A,D)},d(G){G&&y(e),z=!1,Me(K)}}}function Ga(l){let e,t,s,n,i,r,a,o,f=l[2]&&Tl(l);return{c(){e=h("div"),t=h("button"),s=h("i"),r=j(),f&&f.c(),m(s,"class",n="fa fa-fw "+l[3]),m(t,"class","btn btn-secondary dropdown-toggle"),m(t,"aria-expanded",l[2]),m(t,"title",i=l[1].strings.select),m(e,"class","btn-group"),m(e,"role","group")},m(c,u){M(c,e,u),_(e,t),_(t,s),_(e,r),f&&f.m(e,null),a||(o=[W(t,"click",l[5]),ze(it.call(null,e,l[4]))],a=!0)},p(c,[u]){u&8&&n!==(n="fa fa-fw "+c[3])&&m(s,"class",n),u&4&&m(t,"aria-expanded",c[2]),u&2&&i!==(i=c[1].strings.select)&&m(t,"title",i),c[2]?f?f.p(c,u):(f=Tl(c),f.c(),f.m(e,null)):f&&(f.d(1),f=null)},i:E,o:E,d(c){c&&y(e),f&&f.d(),a=!1,Me(o)}}}function Ua(l,e,t){let s,n,i=E,r=()=>(i(),i=ge(a,v=>t(1,n=v)),a);l.$$.on_destroy.push(()=>i());let{store:a}=e;r();let o=!1;const f=()=>{t(2,o=!1)},c=()=>{t(2,o=!o)},u=v=>{f(),a.selectAll(v)},d=()=>u("all"),g=()=>u("none"),p=()=>u("read"),b=()=>u("unread"),$=()=>u("starred"),w=()=>u("unstarred");return l.$$set=v=>{"store"in v&&r(t(0,a=v.store))},l.$$.update=()=>{l.$$.dirty&2&&t(3,s=n.selectedMessages.size==0?"fa-square-o":n.selectedMessages.size<n.listMessages.length?"fa-minus-square-o":"fa-check-square-o")},[a,n,o,s,f,c,u,d,g,p,b,$,w]}class Ha extends ae{constructor(e){super(),oe(this,e,Ua,Ga,re,{store:0})}}function Oa(l){let e,t;return e=new Ha({props:{store:l[0]}}),{c(){J(e.$$.fragment)},m(s,n){O(e,s,n),t=!0},p(s,n){const i={};n&1&&(i.store=s[0]),e.$set(i)},i(s){t||(C(e.$$.fragment,s),t=!0)},o(s){L(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function Ja(l){let e,t;return e=new Fa({props:{store:l[0]}}),{c(){J(e.$$.fragment)},m(s,n){O(e,s,n),t=!0},p(s,n){const i={};n&1&&(i.store=s[0]),e.$set(i)},i(s){t||(C(e.$$.fragment,s),t=!0)},o(s){L(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function Ll(l){let e,t,s,n,i,r;const a=[Va,Ka],o=[];function f(c,u){return c[1].params.tray=="trash"?0:1}return t=f(l),s=o[t]=a[t](l),i=new an({props:{store:l[0]}}),{c(){e=h("div"),s.c(),n=j(),J(i.$$.fragment),m(e,"class","btn-group"),m(e,"role","group")},m(c,u){M(c,e,u),o[t].m(e,null),_(e,n),O(i,e,null),r=!0},p(c,u){let d=t;t=f(c),t===d?o[t].p(c,u):(ne(),L(o[d],1,1,()=>{o[d]=null}),ie(),s=o[t],s?s.p(c,u):(s=o[t]=a[t](c),s.c()),C(s,1),s.m(e,n));const g={};u&1&&(g.store=c[0]),i.$set(g)},i(c){r||(C(s),C(i.$$.fragment,c),r=!0)},o(c){L(s),L(i.$$.fragment,c),r=!1},d(c){c&&y(e),o[t].d(),H(i)}}}function Ka(l){let e,t,s,n;return e=new rn({props:{store:l[0]}}),s=new sn({props:{store:l[0]}}),{c(){J(e.$$.fragment),t=j(),J(s.$$.fragment)},m(i,r){O(e,i,r),M(i,t,r),O(s,i,r),n=!0},p(i,r){const a={};r&1&&(a.store=i[0]),e.$set(a);const o={};r&1&&(o.store=i[0]),s.$set(o)},i(i){n||(C(e.$$.fragment,i),C(s.$$.fragment,i),n=!0)},o(i){L(e.$$.fragment,i),L(s.$$.fragment,i),n=!1},d(i){i&&y(t),H(e,i),H(s,i)}}}function Va(l){let e,t,s,n;return e=new fn({props:{store:l[0]}}),s=new ln({props:{store:l[0]}}),{c(){J(e.$$.fragment),t=j(),J(s.$$.fragment)},m(i,r){O(e,i,r),M(i,t,r),O(s,i,r),n=!0},p(i,r){const a={};r&1&&(a.store=i[0]),e.$set(a);const o={};r&1&&(o.store=i[0]),s.$set(o)},i(i){n||(C(e.$$.fragment,i),C(s.$$.fragment,i),n=!0)},o(i){L(e.$$.fragment,i),L(s.$$.fragment,i),n=!1},d(i){i&&y(t),H(e,i),H(s,i)}}}function jl(l){let e,t,s;return t=new Xl({props:{settings:l[1].settings,strings:l[1].strings,courses:l[1].courses,label:l[1].strings.allcourses,selected:l[1].params.courseid,readonly:l[1].params.tray=="course",buttonClass:"alert alert-primary",dropdownAlign:l[1].viewportSize<fe.MD?"right":"left",onChange:l[2]}}),{c(){e=h("div"),J(t.$$.fragment),m(e,"class","d-flex flex-grow-1 ml-auto mr-0 ml-md-0 mr-md-auto"),he(e,"max-width","20rem"),he(e,"min-width","0")},m(n,i){M(n,e,i),O(t,e,null),s=!0},p(n,i){const r={};i&2&&(r.settings=n[1].settings),i&2&&(r.strings=n[1].strings),i&2&&(r.courses=n[1].courses),i&2&&(r.label=n[1].strings.allcourses),i&2&&(r.selected=n[1].params.courseid),i&2&&(r.readonly=n[1].params.tray=="course"),i&2&&(r.dropdownAlign=n[1].viewportSize<fe.MD?"right":"left"),i&1&&(r.onChange=n[2]),t.$set(r)},i(n){s||(C(t.$$.fragment,n),s=!0)},o(n){L(t.$$.fragment,n),s=!1},d(n){n&&y(e),H(t)}}}function Wa(l){let e,t;return e=new vn({props:{store:l[0]}}),{c(){J(e.$$.fragment)},m(s,n){O(e,s,n),t=!0},p(s,n){const i={};n&1&&(i.store=s[0]),e.$set(i)},i(s){t||(C(e.$$.fragment,s),t=!0)},o(s){L(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function Xa(l){let e,t;return e=new on({props:{store:l[0]}}),{c(){J(e.$$.fragment)},m(s,n){O(e,s,n),t=!0},p(s,n){const i={};n&1&&(i.store=s[0]),e.$set(i)},i(s){t||(C(e.$$.fragment,s),t=!0)},o(s){L(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function Ya(l){var S;let e,t,s,n,i,r=!((S=l[1].message)!=null&&S.draft)&&["shortname","fullname"].includes(l[1].settings.filterbycourse)&&l[1].viewportSize<fe.LG,a,o,f,c;const u=[Ja,Oa],d=[];function g(k,T){return k[1].message?0:1}t=g(l),s=d[t]=u[t](l);let p=l[1].viewportSize>=fe.MD&&Ll(l),b=r&&jl(l);const $=[Xa,Wa],w=[];function v(k,T){var q;return k[1].viewportSize>=fe.MD?0:(q=k[1].message)!=null&&q.draft?1:-1}return~(o=v(l))&&(f=w[o]=$[o](l)),{c(){e=h("div"),s.c(),n=j(),p&&p.c(),i=j(),b&&b.c(),a=j(),f&&f.c(),m(e,"role","toolbar"),m(e,"class","local-mail-toolbar d-flex w-100 svelte-kqp7rd")},m(k,T){M(k,e,T),d[t].m(e,null),_(e,n),p&&p.m(e,null),_(e,i),b&&b.m(e,null),_(e,a),~o&&w[o].m(e,null),c=!0},p(k,[T]){var A;let q=t;t=g(k),t===q?d[t].p(k,T):(ne(),L(d[q],1,1,()=>{d[q]=null}),ie(),s=d[t],s?s.p(k,T):(s=d[t]=u[t](k),s.c()),C(s,1),s.m(e,n)),k[1].viewportSize>=fe.MD?p?(p.p(k,T),T&2&&C(p,1)):(p=Ll(k),p.c(),C(p,1),p.m(e,i)):p&&(ne(),L(p,1,1,()=>{p=null}),ie()),T&2&&(r=!((A=k[1].message)!=null&&A.draft)&&["shortname","fullname"].includes(k[1].settings.filterbycourse)&&k[1].viewportSize<fe.LG),r?b?(b.p(k,T),T&2&&C(b,1)):(b=jl(k),b.c(),C(b,1),b.m(e,a)):b&&(ne(),L(b,1,1,()=>{b=null}),ie());let D=o;o=v(k),o===D?~o&&w[o].p(k,T):(f&&(ne(),L(w[D],1,1,()=>{w[D]=null}),ie()),~o?(f=w[o],f?f.p(k,T):(f=w[o]=$[o](k),f.c()),C(f,1),f.m(e,null)):f=null)},i(k){c||(C(s),C(p),C(b),C(f),c=!0)},o(k){L(s),L(p),L(b),L(f),c=!1},d(k){k&&y(e),d[t].d(),p&&p.d(),b&&b.d(),~o&&w[o].d()}}}function Qa(l,e,t){let s,n=E,i=()=>(n(),n=ge(r,o=>t(1,s=o)),r);l.$$.on_destroy.push(()=>n());let{store:r}=e;i();const a=o=>r.selectCourse(o);return l.$$set=o=>{"store"in o&&i(t(0,r=o.store))},[r,s,a]}class Za extends ae{constructor(e){super(),oe(this,e,Qa,Ya,re,{store:0})}}const{window:ot}=rt;function zl(l){let e,t;return e=new Rn({props:{store:l[0]}}),{c(){J(e.$$.fragment)},m(s,n){O(e,s,n),t=!0},p(s,n){const i={};n&1&&(i.store=s[0]),e.$set(i)},i(s){t||(C(e.$$.fragment,s),t=!0)},o(s){L(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function xa(l){let e,t=l[3].strings.pluginname+"",s,n,i=l[2]&&l[3].viewportSize<fe.LG&&Nl(l);return{c(){e=h("h1"),s=P(t),n=j(),i&&i.c(),m(e,"class","h2 local-mail-view-side-column text-truncate mb-3 mb-md-4 svelte-10og3q")},m(r,a){M(r,e,a),_(e,s),_(e,n),i&&i.m(e,null)},p(r,a){a&8&&t!==(t=r[3].strings.pluginname+"")&&R(s,t),r[2]&&r[3].viewportSize<fe.LG?i?i.p(r,a):(i=Nl(r),i.c(),i.m(e,null)):i&&(i.d(1),i=null)},d(r){r&&y(e),i&&i.d()}}}function eo(l){let e;return{c(){e=h("div"),m(e,"class","local-mail-view-side-column svelte-10og3q")},m(t,s){M(t,e,s)},p:E,d(t){t&&y(e)}}}function Nl(l){let e,t,s;return{c(){e=h("i"),t=j(),s=P(l[2]),m(e,"class","fa fa-angle-right mx-1"),m(e,"aria-hidden","true")},m(n,i){M(n,e,i),M(n,t,i),M(n,s,i)},p(n,i){i&4&&R(s,n[2])},d(n){n&&(y(e),y(t),y(s))}}}function ql(l){let e,t,s;return t=new Ia({props:{store:l[0]}}),{c(){e=h("div"),J(t.$$.fragment),m(e,"class","local-mail-view-search svelte-10og3q")},m(n,i){M(n,e,i),O(t,e,null),s=!0},p(n,i){const r={};i&1&&(r.store=n[0]),t.$set(r)},i(n){s||(C(t.$$.fragment,n),s=!0)},o(n){L(t.$$.fragment,n),s=!1},d(n){n&&y(e),H(t)}}}function Il(l){let e,t,s,n;e=new Yl({props:{strings:l[3].strings,iconOnly:l[1]&&l[3].viewportSize<fe.SM,onClick:l[16]}});let i=!l[1]&&Al(l);return{c(){J(e.$$.fragment),t=j(),i&&i.c(),s=_e()},m(r,a){O(e,r,a),M(r,t,a),i&&i.m(r,a),M(r,s,a),n=!0},p(r,a){const o={};a&8&&(o.strings=r[3].strings),a&10&&(o.iconOnly=r[1]&&r[3].viewportSize<fe.SM),a&9&&(o.onClick=r[16]),e.$set(o),r[1]?i&&(ne(),L(i,1,1,()=>{i=null}),ie()):i?(i.p(r,a),a&2&&C(i,1)):(i=Al(r),i.c(),C(i,1),i.m(s.parentNode,s))},i(r){n||(C(e.$$.fragment,r),C(i),n=!0)},o(r){L(e.$$.fragment,r),L(i),n=!1},d(r){r&&(y(t),y(s)),H(e,r),i&&i.d(r)}}}function Al(l){let e,t,s;return t=new Nn({props:{strings:l[3].strings,onClick:l[17]}}),{c(){e=h("div"),J(t.$$.fragment),m(e,"class","ml-auto")},m(n,i){M(n,e,i),O(t,e,null),s=!0},p(n,i){const r={};i&8&&(r.strings=n[3].strings),i&1&&(r.onClick=n[17]),t.$set(r)},i(n){s||(C(t.$$.fragment,n),s=!0)},o(n){L(t.$$.fragment,n),s=!1},d(n){n&&y(e),H(t)}}}function Bl(l){let e,t,s,n=l[3].viewportSize>=fe.LG&&Pl(l),i=l[1]&&El(l);return{c(){e=h("div"),n&&n.c(),t=j(),i&&i.c(),m(e,"class","row mb-3")},m(r,a){M(r,e,a),n&&n.m(e,null),_(e,t),i&&i.m(e,null),s=!0},p(r,a){r[3].viewportSize>=fe.LG?n?(n.p(r,a),a&8&&C(n,1)):(n=Pl(r),n.c(),C(n,1),n.m(e,t)):n&&(ne(),L(n,1,1,()=>{n=null}),ie()),r[1]?i?(i.p(r,a),a&2&&C(i,1)):(i=El(r),i.c(),C(i,1),i.m(e,null)):i&&(ne(),L(i,1,1,()=>{i=null}),ie())},i(r){s||(C(n),C(i),s=!0)},o(r){L(n),L(i),s=!1},d(r){r&&y(e),n&&n.d(),i&&i.d()}}}function Pl(l){let e,t,s;return t=new Yl({props:{strings:l[3].strings,onClick:l[18]}}),{c(){e=h("div"),J(t.$$.fragment),m(e,"class","local-mail-view-side-column svelte-10og3q")},m(n,i){M(n,e,i),O(t,e,null),s=!0},p(n,i){const r={};i&8&&(r.strings=n[3].strings),i&9&&(r.onClick=n[18]),t.$set(r)},i(n){s||(C(t.$$.fragment,n),s=!0)},o(n){L(t.$$.fragment,n),s=!1},d(n){n&&y(e),H(t)}}}function El(l){let e,t,s;return t=new Za({props:{store:l[0]}}),{c(){e=h("div"),J(t.$$.fragment),m(e,"class","local-mail-view-main-column d-flex svelte-10og3q")},m(n,i){M(n,e,i),O(t,e,null),s=!0},p(n,i){const r={};i&1&&(r.store=n[0]),t.$set(r)},i(n){s||(C(t.$$.fragment,n),s=!0)},o(n){L(t.$$.fragment,n),s=!1},d(n){n&&y(e),H(t)}}}function Rl(l){let e,t,s;return t=new zn({props:{settings:l[3].settings,strings:l[3].strings,courses:l[3].courses,labels:l[3].labels,params:l[3].params,onClick:l[0].navigate,onCourseChange:l[0].selectCourse}}),{c(){e=h("div"),J(t.$$.fragment),m(e,"class","local-mail-view-side-column svelte-10og3q")},m(n,i){M(n,e,i),O(t,e,null),s=!0},p(n,i){const r={};i&8&&(r.settings=n[3].settings),i&8&&(r.strings=n[3].strings),i&8&&(r.courses=n[3].courses),i&8&&(r.labels=n[3].labels),i&8&&(r.params=n[3].params),i&1&&(r.onClick=n[0].navigate),i&1&&(r.onCourseChange=n[0].selectCourse),t.$set(r)},i(n){s||(C(t.$$.fragment,n),s=!0)},o(n){L(t.$$.fragment,n),s=!1},d(n){n&&y(e),H(t)}}}function Fl(l){let e,t,s,n;const i=[lo,so,to],r=[];function a(o,f){var c;return(c=o[3].message)!=null&&c.draft&&o[3].draftForm?0:o[3].message?1:2}return t=a(l),s=r[t]=i[t](l),{c(){e=h("div"),s.c(),m(e,"class","local-mail-view-main-column svelte-10og3q")},m(o,f){M(o,e,f),r[t].m(e,null),n=!0},p(o,f){let c=t;t=a(o),t===c?r[t].p(o,f):(ne(),L(r[c],1,1,()=>{r[c]=null}),ie(),s=r[t],s?s.p(o,f):(s=r[t]=i[t](o),s.c()),C(s,1),s.m(e,null))},i(o){n||(C(s),n=!0)},o(o){L(s),n=!1},d(o){o&&y(e),r[t].d()}}}function to(l){let e,t,s,n;return e=new tr({props:{store:l[0]}}),s=new oa({props:{store:l[0]}}),{c(){J(e.$$.fragment),t=j(),J(s.$$.fragment)},m(i,r){O(e,i,r),M(i,t,r),O(s,i,r),n=!0},p(i,r){const a={};r&1&&(a.store=i[0]),e.$set(a);const o={};r&1&&(o.store=i[0]),s.$set(o)},i(i){n||(C(e.$$.fragment,i),C(s.$$.fragment,i),n=!0)},o(i){L(e.$$.fragment,i),L(s.$$.fragment,i),n=!1},d(i){i&&y(t),H(e,i),H(s,i)}}}function so(l){let e,t;return e=new qr({props:{store:l[0],message:l[3].message}}),{c(){J(e.$$.fragment)},m(s,n){O(e,s,n),t=!0},p(s,n){const i={};n&1&&(i.store=s[0]),n&8&&(i.message=s[3].message),e.$set(i)},i(s){t||(C(e.$$.fragment,s),t=!0)},o(s){L(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function lo(l){let e,t;return e=new ia({props:{store:l[0],message:l[3].message,form:l[3].draftForm}}),{c(){J(e.$$.fragment)},m(s,n){O(e,s,n),t=!0},p(s,n){const i={};n&1&&(i.store=s[0]),n&8&&(i.message=s[3].message),n&8&&(i.form=s[3].draftForm),e.$set(i)},i(s){t||(C(e.$$.fragment,s),t=!0)},o(s){L(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function Gl(l){let e,t;return e=new Li({props:{store:l[0]}}),{c(){J(e.$$.fragment)},m(s,n){O(e,s,n),t=!0},p(s,n){const i={};n&1&&(i.store=s[0]),e.$set(i)},i(s){t||(C(e.$$.fragment,s),t=!0)},o(s){L(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function Ul(l){let e,t;return e=new ma({props:{store:l[0],onCancel:l[20]}}),{c(){J(e.$$.fragment)},m(s,n){O(e,s,n),t=!0},p(s,n){const i={};n&1&&(i.store=s[0]),n&1&&(i.onCancel=s[20]),e.$set(i)},i(s){t||(C(e.$$.fragment,s),t=!0)},o(s){L(e.$$.fragment,s),t=!1},d(s){H(e,s)}}}function no(l){let e,t,s,n,i,r,a,o,f,c,u,d,g,p,b,$,w,v,S,k,T,q,D,A;document.title=t=l[5]+" - "+l[3].strings.pluginname;let z=!l[3].mobile&&zl(l);function K(I,N){return I[3].mobile&&I[3].viewportSize<fe.LG?eo:xa}let G=K(l),U=G(l),se=l[1]&&ql(l),le=l[3].viewportSize<fe.LG&&Il(l),Q=(l[1]||l[3].viewportSize>=fe.LG)&&Bl(l),ee=(!l[1]||l[3].viewportSize>=fe.LG)&&Rl(l),F=l[1]&&Fl(l),te=l[1]&&l[3].viewportSize<fe.MD&&Gl(l),x=l[3].params.dialog=="preferences"&&Ul(l);return S=new Pa({props:{store:l[0]}}),T=new Kn({props:{store:l[0]}}),{c(){e=j(),s=j(),n=h("div"),z&&z.c(),i=j(),r=h("div"),U.c(),a=j(),o=h("div"),se&&se.c(),f=j(),le&&le.c(),c=j(),Q&&Q.c(),u=j(),d=h("div"),ee&&ee.c(),g=j(),F&&F.c(),b=j(),$=h("div"),te&&te.c(),w=j(),x&&x.c(),v=j(),J(S.$$.fragment),k=j(),J(T.$$.fragment),m(o,"class","local-mail-view-main-column d-flex mb-3 svelte-10og3q"),V(o,"mb-4",l[3].viewportSize>=fe.LG),m(r,"class","row align-items-center"),m(d,"class","row mb-3"),m(n,"class","local-mail local-mail-view container-fluid d-flex flex-column pt-2 svelte-10og3q"),V(n,"pt-3",!l[3].mobile),V(n,"p-md-4",!l[3].mobile&&l[3].viewportSize>=fe.MD),V(n,"min-vh-100",l[3].viewportSize<fe.MD),m($,"class","local-mail"),he($,"display","contents")},m(I,N){M(I,e,N),M(I,s,N),M(I,n,N),z&&z.m(n,null),_(n,i),_(n,r),U.m(r,null),_(r,a),_(r,o),se&&se.m(o,null),_(o,f),le&&le.m(o,null),_(n,c),Q&&Q.m(n,null),_(n,u),_(n,d),ee&&ee.m(d,null),_(d,g),F&&F.m(d,null),l[19](n),M(I,b,N),M(I,$,N),te&&te.m($,null),_($,w),x&&x.m($,null),_($,v),O(S,$,null),_($,k),O(T,$,null),q=!0,D||(A=[W(ot,"resize",l[14]),W(ot,"popstate",l[15]),W(ot,"beforeunload",l[6]),W(ot,"message",l[7]),W(document,"click",function(){De(l[3].mobile?l[8]:void 0)&&(l[3].mobile?l[8]:void 0).apply(this,arguments)}),ze(p=jn.call(null,n,l[3].loading))],D=!0)},p(I,[N]){l=I,(!q||N&40)&&t!==(t=l[5]+" - "+l[3].strings.pluginname)&&(document.title=t),l[3].mobile?z&&(ne(),L(z,1,1,()=>{z=null}),ie()):z?(z.p(l,N),N&8&&C(z,1)):(z=zl(l),z.c(),C(z,1),z.m(n,i)),G===(G=K(l))&&U?U.p(l,N):(U.d(1),U=G(l),U&&(U.c(),U.m(r,a))),l[1]?se?(se.p(l,N),N&2&&C(se,1)):(se=ql(l),se.c(),C(se,1),se.m(o,f)):se&&(ne(),L(se,1,1,()=>{se=null}),ie()),l[3].viewportSize<fe.LG?le?(le.p(l,N),N&8&&C(le,1)):(le=Il(l),le.c(),C(le,1),le.m(o,null)):le&&(ne(),L(le,1,1,()=>{le=null}),ie()),(!q||N&8)&&V(o,"mb-4",l[3].viewportSize>=fe.LG),l[1]||l[3].viewportSize>=fe.LG?Q?(Q.p(l,N),N&10&&C(Q,1)):(Q=Bl(l),Q.c(),C(Q,1),Q.m(n,u)):Q&&(ne(),L(Q,1,1,()=>{Q=null}),ie()),!l[1]||l[3].viewportSize>=fe.LG?ee?(ee.p(l,N),N&10&&C(ee,1)):(ee=Rl(l),ee.c(),C(ee,1),ee.m(d,g)):ee&&(ne(),L(ee,1,1,()=>{ee=null}),ie()),l[1]?F?(F.p(l,N),N&2&&C(F,1)):(F=Fl(l),F.c(),C(F,1),F.m(d,null)):F&&(ne(),L(F,1,1,()=>{F=null}),ie()),p&&De(p.update)&&N&8&&p.update.call(null,l[3].loading),(!q||N&8)&&V(n,"pt-3",!l[3].mobile),(!q||N&8)&&V(n,"p-md-4",!l[3].mobile&&l[3].viewportSize>=fe.MD),(!q||N&8)&&V(n,"min-vh-100",l[3].viewportSize<fe.MD),l[1]&&l[3].viewportSize<fe.MD?te?(te.p(l,N),N&10&&C(te,1)):(te=Gl(l),te.c(),C(te,1),te.m($,w)):te&&(ne(),L(te,1,1,()=>{te=null}),ie()),l[3].params.dialog=="preferences"?x?(x.p(l,N),N&8&&C(x,1)):(x=Ul(l),x.c(),C(x,1),x.m($,v)):x&&(ne(),L(x,1,1,()=>{x=null}),ie());const X={};N&1&&(X.store=l[0]),S.$set(X);const B={};N&1&&(B.store=l[0]),T.$set(B)},i(I){q||(C(z),C(se),C(le),C(Q),C(ee),C(F),C(te),C(x),C(S.$$.fragment,I),C(T.$$.fragment,I),q=!0)},o(I){L(z),L(se),L(le),L(Q),L(ee),L(F),L(te),L(x),L(S.$$.fragment,I),L(T.$$.fragment,I),q=!1},d(I){I&&(y(e),y(s),y(n),y(b),y($)),z&&z.d(),U.d(),se&&se.d(),le&&le.d(),Q&&Q.d(),ee&&ee.d(),F&&F.d(),l[19](null),te&&te.d(),x&&x.d(),H(S),H(T),D=!1,Me(A)}}}function io(l,e,t){let s,n,i,r,a,o,f,c,u,d=E,g=()=>(d(),d=ge(p,G=>t(3,u=G)),p);l.$$.on_destroy.push(()=>d());let{store:p}=e;g();let b,$=0;mt(()=>{p.setViewportSize(window.innerWidth)}),Vl(()=>{if($!=u.navigationId){$=u.navigationId;let G=b.parentElement;for(;G;)G.scrollTop>0&&G.scrollTo({top:0}),G=G.parentElement}});const w=G=>{if(u.draftData)return G.preventDefault(),p.updateDraft(u.draftData,!0),""},v=G=>{u.mobile&&G.data.addon=="local_satsmail"&&G.data.backClicked&&p.navigateToMenu()},S=G=>{var U;if(u.mobile&&!G.defaultPrevented&&G.target instanceof HTMLElement){const se=G.target.closest("a");se&&((U=window.parent)==null||U.postMessage({addon:"local_satsmail",openUrl:se.href},"*")),G.defaultPrevented||G.preventDefault()}},k=()=>p.setViewportSize(window.innerWidth),T=()=>p.navigate(Ql()),q=()=>p.createMessage(u.params.courseid),D=()=>p.showDialog("preferences"),A=()=>p.createMessage(u.params.courseid);function z(G){Se[G?"unshift":"push"](()=>{b=G,t(4,b)})}const K=()=>p.hideDialog();return l.$$set=G=>{"store"in G&&g(t(0,p=G.store))},l.$$.update=()=>{var G,U,se;l.$$.dirty&8&&t(11,s=u.loading),l.$$.dirty&8&&t(1,n=u.params.tray),l.$$.dirty&8&&t(12,i=u.courses.find(le=>le.id==u.params.courseid)),l.$$.dirty&8&&t(13,r=u.labels.find(le=>le.id==u.params.labelid)),l.$$.dirty&12298&&t(2,a=n=="inbox"?u.strings.inbox:n=="starred"?u.strings.starredplural:n=="sent"?u.strings.sentplural:n=="drafts"?u.strings.drafts:n=="trash"?u.strings.trash:n=="label"?(r==null?void 0:r.name)||"":n=="course"?et(i,"fullname"):""),l.$$.dirty&12&&t(5,o=u.message?u.message.subject.trim()||u.strings.nosubject:a),l.$$.dirty&12&&t(10,f=u.viewportSize<fe.LG?a||u.strings.pluginname:""),l.$$.dirty&2&&t(9,c=n!=null),l.$$.dirty&2048&&((G=window.parent)==null||G.postMessage({addon:"local_satsmail",setLoading:s},"*")),l.$$.dirty&1024&&((U=window.parent)==null||U.postMessage({addon:"local_satsmail",setTitle:f},"*")),l.$$.dirty&512&&((se=window.parent)==null||se.postMessage({addon:"local_satsmail",captureBack:c},"*"))},[p,n,a,u,b,o,w,v,S,c,f,s,i,r,k,T,q,D,A,z,K]}class ro extends ae{constructor(e){super(),oe(this,e,io,no,re,{store:0})}}const xe=[];function ao(l,e=E){let t;const s=new Set;function n(a){if(qn(l,a)&&(l=a,t)){const o=!xe.length;for(const f of s)f[1](),xe.push(f,l);if(o){for(let f=0;f<xe.length;f+=2)xe[f][0](xe[f+1]);xe.length=0}}}function i(a){n(a(l))}function r(a,o=E){const f=[a,o];return s.add(f),s.size===1&&(t=e(n,i)||E),a(l),()=>{s.delete(f),s.size===0&&t&&(t(),t=null)}}return{set:n,update:i,subscribe:r}}async function oo(l){let e=0,t={userid:l.userid,settings:l.settings,preferences:l.preferences,strings:l.strings,mobile:l.mobile,params:{},unread:0,drafts:0,courses:[],labels:[],totalCount:0,listMessages:[],loading:!0,selectedMessages:new Map,toasts:[],navigationId:0,viewportSize:0};const{subscribe:s,set:n}=ao(t),i=I=>n({...t,...I});s(I=>{t=I});const r=async(I,N,X=!1)=>{var Qe,Ze,lt,Dt,Tt;const B=(Qe=t.message)==null?void 0:Qe.id,de=t.draftData,Z=N||t.params,ke=!X&&(Z.tray!=t.params.tray||Z.messageid!=t.params.messageid||Z.courseid!=t.params.courseid||Z.labelid!=t.params.labelid||Z.search!=t.params.search)?{...t.params,dialog:void 0}:t.prevParams,we=t.preferences.perpage;if(i({loading:!0,error:void 0}),_t(Z,X),B&&de&&(window.clearTimeout(e),e=0,I.unshift({methodname:"update_message",messageid:B,data:de})),I.push({methodname:"get_courses"}),I.push({methodname:"get_labels"}),Z.tray){const ye={courseid:Z.courseid,labelid:Z.tray=="label"?Z.labelid:void 0,draft:Z.tray=="drafts"?!0:Z.tray=="sent"?!1:void 0,roles:Z.tray=="inbox"?["to","cc","bcc"]:Z.tray=="sent"?["from"]:void 0,starred:Z.tray=="starred"?!0:void 0,deleted:Z.tray=="trash"};I.push({methodname:"count_messages",query:ye}),Z.messageid?(I.push({methodname:"get_message",messageid:Z.messageid}),I.push({methodname:"search_messages",query:{...ye,...Z.search,startid:Z.messageid,reverse:!1},limit:1}),I.push({methodname:"search_messages",query:{...ye,...Z.search,startid:Z.messageid,reverse:!0},limit:1}),Z.search||I.push({methodname:"count_messages",query:{...ye,startid:Z.messageid,reverse:!0}})):I.push({methodname:"search_messages",query:{...ye,...Z.search},offset:Z.search?void 0:Z.offset,limit:Z.search?we+1:we})}const ve=await a(I);if(ve==null)return null;let ce,Ce,Te,$e,be=[],pe=0;Z.tray&&(Z.messageid?(Z.search||(Ce=ve.pop()),$e=(Ze=ve.pop()[0])==null?void 0:Ze.id,Te=(lt=ve.pop()[0])==null?void 0:lt.id,ce=ve.pop()):(be=ve.pop(),Z.search&&(Z.search.reverse?($e=(Dt=be[we])==null?void 0:Dt.id,Te=Z.search.startid,be=be.slice(0,we).reverse()):($e=Z.search.startid,Te=(Tt=be[we])==null?void 0:Tt.id,be=be.slice(0,we)))),pe=ve.pop());const Y=ve.pop(),me=ve.pop();if(B&&de&&ve.shift(),Z.tray=="course"&&!me.find(ye=>ye.id==Z.courseid)||Z.tray=="label"&&!Y.find(ye=>ye.id==Z.labelid))return await b({tray:"inbox"},!0),ve;let st,Ye,Ne;if(ce!=null&&ce.draft){const ye=[{methodname:"get_roles",courseid:ce.course.id},{methodname:"get_groups",courseid:ce.course.id}];(ce==null?void 0:ce.id)!=B&&ye.push({methodname:"get_message_form",messageid:ce.id});const Re=await a(ye);if(Re==null)return null;(ce==null?void 0:ce.id)!=B&&(st=Re.pop()),Ne=Re.pop(),Ye=Re.pop()}return i({params:Z,prevParams:ke,unread:me.reduce((ye,Re)=>ye+Re.unread,0),drafts:me.reduce((ye,Re)=>ye+Re.drafts,0),courses:me,labels:Y,messageOffset:Ce,totalCount:pe,listMessages:be,message:ce,nextMessageId:Te,prevMessageId:$e,draftForm:(ce==null?void 0:ce.id)!=B?st:t.draftForm,draftRoles:Ye,draftGroups:Ne,draftData:void 0,draftSaved:(ce==null?void 0:ce.id)==B,selectedMessages:new Map(ce?[[ce.id,ce]]:t.message?[]:be.filter(ye=>t.selectedMessages.has(ye.id)).map(ye=>[ye.id,ye])),loading:!1,navigationId:X||Z.tray!=t.params.tray||Z.courseid!=t.params.courseid||Z.labelid!=t.params.labelid||Z.messageid!=t.params.messageid||Z.offset!=t.params.offset?t.navigationId+1:t.navigationId}),B&&de&&B!=(ce==null?void 0:ce.id)&&le({text:t.strings.draftsaved}),ve},a=async I=>{try{return await St(I)}catch(N){return A(N),null}},o=async(I,N)=>{const X={methodname:"create_label",name:I,color:N,messageids:Array.from(t.selectedMessages.keys())};await r([X])},f=async I=>{const N=t.params,X={methodname:"create_message",courseid:I||t.courses[0].id},B=await a([X]);B!=null&&await b({tray:"drafts",messageid:B.pop(),courseid:["shortname","fullname"].includes(t.settings.filterbycourse)&&N.courseid?I:void 0})},c=async I=>{await r([{methodname:"delete_label",labelid:I}],{tray:"inbox"})},u=async I=>{await r([{methodname:"empty_trash",courseid:I}])},d=async I=>{const N=t.params,X={methodname:"forward_message",messageid:I.id},B=await r([X]);B!=null&&await b({tray:"drafts",messageid:B.pop(),courseid:["shortname","fullname"].includes(t.settings.filterbycourse)&&N.courseid!=null?I.course.id:void 0})},g=()=>{const I={...t.params,dialog:void 0};i({params:I}),_t(I,!0)},p=I=>{i({toasts:t.toasts.filter(N=>N!=I)})},b=async(I,N=!1,X=!0)=>{var Z;const B=[];X&&t.settings.incrementalsearch&&B.push({methodname:"search_messages",query:{deleted:!1},offset:t.settings.incrementalsearchlimit,limit:1}),I!=null&&I.messageid&&B.push({methodname:"view_message",messageid:I.messageid});const de=await r(B,I,N);if(de!=null&&X&&t.settings.incrementalsearch){const ke=de[0];i({incrementalSearchStopId:(Z=ke[0])==null?void 0:Z.id})}},$=async(I=!1)=>{const N={...t.params,messageid:void 0,offset:Math.floor((t.params.offset||0)/t.preferences.perpage)*t.preferences.perpage||void 0};await r([],N,I)},w=async()=>{await r([],{})},v=async(I,N)=>{const X=t.params,B={methodname:"reply_message",messageid:I.id,all:N},de=await r([B]);de!=null&&await b({tray:"drafts",messageid:de.pop(),courseid:["shortname","fullname"].includes(t.settings.filterbycourse)&&X.courseid!=null?I.course.id:void 0})},S=async I=>{i({preferences:{...t.preferences,...I}});let N=t.params;I.perpage&&(N={...N,offset:t.params.offset?Math.trunc(t.params.offset/I.perpage)*I.perpage:void 0}),await r([{methodname:"set_preferences",preferences:I}],N,!0)},k=I=>{i({selectedMessages:new Map(t.listMessages.filter(N=>I=="all"||I=="read"&&!N.unread||I=="unread"&&N.unread||I=="starred"&&N.starred||I=="unstarred"&&!N.starred).map(N=>[N.id,N]))})},T=async I=>{await b({...t.params,courseid:I,offset:0,messageid:void 0,search:t.params.search?{...t.params.search,startid:void 0,reverse:void 0}:void 0})},q=async()=>{var B;if(!((B=t.message)!=null&&B.draft))return;const I={methodname:"send_message",messageid:t.message.id},N=t.prevParams?{...t.prevParams,messageid:void 0,offset:Math.floor((t.prevParams.offset||0)/t.preferences.perpage)*t.preferences.perpage||void 0}:["shortname","fullname"].includes(t.settings.filterbycourse)?{tray:"inbox",courseid:t.message.course.id}:{tray:"course",courseid:t.message.course.id};await r([I],N)!=null&&le({text:t.strings.messagesent})},D=async(I,N,X)=>{const B=I.map(ke=>({methodname:"set_deleted",messageid:ke,deleted:N})),de={...t.params,messageid:void 0};if(await r(B,de,!0)!=null&&N!=Ve.DeletedForever){const ke=N?I.length>1?"messagesmovedtotrash":"messagemovedtotrash":I.length>1?"messagesrestored":"messagerestored",we=qe(t.strings[ke],I.length);le({text:we,undo:X?()=>{D(I,N?Ve.NotDeleted:Ve.Deleted,!1)}:void 0})}},A=async I=>{i({loading:t.loading&&!I,error:I})},z=async(I,N)=>{x(B=>t.selectedMessages.has(B.id)?{...B,labels:t.labels.filter(de=>I.includes(de.id)?!0:N.includes(de.id)?!1:B.labels.findIndex(Z=>Z.id==de.id)>=0)}:B);const X=[];t.selectedMessages.forEach(B=>{X.push({methodname:"set_labels",messageid:B.id,labelids:B.labels.map(de=>de.id)})}),await r(X)},K=async(I,N)=>{x(B=>I.includes(B.id)?{...B,starred:N}:B);const X=I.map(B=>({methodname:"set_starred",messageid:B,starred:N}));await r(X)},G=async(I,N)=>{x(de=>I.includes(de.id)?{...de,unread:N}:de);const X=I.map(de=>({methodname:"set_unread",messageid:de,unread:N})),B={...t.params,messageid:void 0};await r(X,B)},U=I=>{i({viewportSize:I,navigationId:t.navigationId+1}),!t.params.tray&&I>=fe.LG&&!t.error&&b({tray:"inbox",dialog:t.params.dialog},!0)},se=async I=>{const N={...t.params,dialog:I};_t(N,t.params.dialog!=null),i({params:N})},le=async I=>{i({toasts:[I]}),I&&window.setTimeout(()=>p(I),1e4)},Q=I=>{i({selectedMessages:new Map(t.listMessages.filter(N=>N.id==I?!t.selectedMessages.has(N.id):t.selectedMessages.has(N.id)).map(N=>[N.id,N]))})},ee=async I=>{I.undo&&(p(I),I.undo())},F=(I,N)=>{if(!t.message)return;const X=t.message,B=async()=>{window.clearTimeout(e),e=0;const de=t.draftData;if(!de)return;const Z=[{methodname:"update_message",messageid:X.id,data:de},{methodname:"get_message",messageid:X.id}],ke=await a(Z);if(ke!=null&&de===t.draftData){const we=ke.pop();i({message:we,draftData:void 0,draftSaved:!0})}};i({draftData:I,draftSaved:!1}),N?B():!e&&t.settings.autosaveinterval>0&&(e=window.setTimeout(B,t.settings.autosaveinterval*1e3))},te=async(I,N,X)=>{await r([{methodname:"update_label",labelid:I,name:N,color:X}])},x=I=>{i({listMessages:t.listMessages.map(N=>I(N)),message:t.message?I(t.message):void 0,selectedMessages:new Map(Array.from(t.selectedMessages.entries()).map(([N,X])=>[N,I(X)]))})};return await b(Ql(),!0,!0),{createLabel:o,createMessage:f,deleteLabel:c,emptyTrash:u,forward:d,get:()=>t,hideDialog:g,hideToast:p,navigate:b,navigateToList:$,navigateToMenu:w,reply:v,savePreferences:S,selectAll:k,selectCourse:T,sendMessage:q,setDeleted:D,setError:A,setLabels:z,setStarred:K,setUnread:G,setViewportSize:U,showDialog:se,subscribe:s,toggleSelected:Q,undo:ee,updateDraft:F,updateLabel:te}}async function fo(){const l=document.getElementById("local-mail-view"),e=document.getElementById("local-mail-navbar"),t=window.local_satsmail_view_data;if(!t)return;const s=await oo({userid:t.userid,settings:t.settings,preferences:t.preferences,strings:t.strings,mobile:!!t.mobile});if(l&&new ro({target:l,props:{store:s}}),e){e.innerHTML="";const n=s.get(),i=new In({target:e,props:{settings:n.settings,strings:n.strings,courses:n.courses,labels:n.labels,params:n.params,loading:n.loading,onClick:s.navigate,onComposeClick:s.createMessage,onCourseChange:s.selectCourse}});s.subscribe(r=>{i.$set({settings:r.settings,strings:r.strings,courses:r.courses,labels:r.labels,params:r.params,loading:r.loading})})}}fo();
//# sourceMappingURL=view-DMzXmcM2.js.map

